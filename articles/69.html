<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>2022-08-21</title><meta name="next-head-count" content="3"/><link rel="preload" href="/diary/_next/static/css/d865616645a7b0fe.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/d865616645a7b0fe.css" data-n-g=""/><link rel="preload" href="/diary/_next/static/css/fc9624fd4a486ef2.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/fc9624fd4a486ef2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/diary/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/diary/_next/static/chunks/webpack-dc4034d98607b727.js" defer=""></script><script src="/diary/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/diary/_next/static/chunks/main-a03413948affdc5e.js" defer=""></script><script src="/diary/_next/static/chunks/pages/_app-5b4d6b2692b4593b.js" defer=""></script><script src="/diary/_next/static/chunks/582-d79da0492f1f9267.js" defer=""></script><script src="/diary/_next/static/chunks/pages/articles/%5BissueNumber%5D-4584e21e841751ac.js" defer=""></script><script src="/diary/_next/static/pI6kXhuws7KSwb9qiQWUa/_buildManifest.js" defer=""></script><script src="/diary/_next/static/pI6kXhuws7KSwb9qiQWUa/_ssgManifest.js" defer=""></script><script src="/diary/_next/static/pI6kXhuws7KSwb9qiQWUa/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><script>window.twttr=(function(f,b,g){var e,c=f.getElementsByTagName(b)[0],a=window.twttr||{};if(f.getElementById(g)){return a}e=f.createElement(b);e.id=g;e.src="https://platform.twitter.com/widgets.js";c.parentNode.insertBefore(e,c);a._e=[];a.ready=function(d){a._e.push(d)};return a}(document,"script","twitter-wjs"));</script><div class="min-h-screen flex flex-col"><header class="relative bg-gradient-to-r from-blue-700 via-blue-800 to-gray-900 md:mb-8"><div class="max-w-6xl mx-auto px-5"><nav class="py-12 md:mb-20 flex items-center justify-between md:px-12 px-2"><div><h1 class="text-white"><a class="text-2xl md:text-3xl tracking-wide font-bold" href="/diary">ikuma-t/diary</a></h1><p class="mt-4 text-sm text-slate-300">ikuma-tの作業ログです。</p></div><div><a class="text-white text-sm" href="https://github.com/IkumaTadokoro/diary/issues">Show on GitHub</a></div></nav></div><svg class="absolute w-full h-20 md:h-full top-32 left-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" preserveAspectRatio="none"><path d="M0 32L24 37.3C48 43 96 53 144 74.7C192 96 240 128 288 122.7C336 117 384 75 432 80C480 85 528 139 576 133.3C624 128 672 64 720 53.3C768 43 816 85 864 90.7C912 96 960 64 1008 48C1056 32 1104 32 1152 58.7C1200 85 1248 139 1296 133.3C1344 128 1392 64 1416 32L1440 0V171H1416C1392 171 1344 171 1296 171C1248 171 1200 171 1152 171C1104 171 1056 171 1008 171C960 171 912 171 864 171C816 171 768 171 720 171C672 171 624 171 576 171C528 171 480 171 432 171C384 171 336 171 288 171C240 171 192 171 144 171C96 171 48 171 24 171H0V32Z" fill="white"></path></svg></header><main class="z-10 flex-1 py-8"><div class="max-w-2xl mx-auto"><article class="znc markdown"><section class="block py-6 md:px-12 px-8 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-20T23:15:51Z" title="2022-08-20T23:15:51Z">2022-08-20 23:08:00</time><h1 class="font-bold text-slate-600">2022-08-21</h1></header><aside><p class="text-sm text-slate-400">Posted by <!-- --> at <!-- --><a href="https://github.com/IkumaTadokoro/diary/issues/69">#69</a>.<!-- --></p></aside><div></div></section><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T06:39:27Z" title="2022-08-21T06:39:27Z">2022-08-21 06:08:00</time></header><div><p>pdlgenの挙動をみていく。</p>
<p>まずは動かしてみて、どういうふうに動くかを確認する。</p>
<p>READMEをちゃんと読んでおこう。いそがば回れだ。</p>
<ul>
<li>cdproto-genはChrome DevTools Protocolのコマンド、イベント、型のためのGoコードを生成する。</li>
<li>cdproto-genはChromiumソースツリーから<code>browser_protocol.pdl</code>と<code>js_protocol.pdl</code>を取得する。これらは<code>$GOPATH/pkg/cdproto-gen</code>にキャッシュされ、定期的に更新される。</li>
<li>HAR定義は特別なHARドメインを生成するために使用される。
<ul>
<li>HAR定義ってなんだ？<br>
　- <a href="http://www.softwareishard.com/blog/har-12-spec/" rel="nofollow">http://www.softwareishard.com/blog/har-12-spec/</a> のことみたい</li>
<li>HTTP ARchive 1.2のことだそう。</li>
<li>Webブラウザーとサイトとのやりとりに関する詳細なパフォーマンスデータをエクスポートするためのHTTPトランザクションのアーカイブ形式を定義する仕様</li>
</ul>
</li>
<li>cdproto-gen は browser_protocol.pdl と js_protocol.pdl で定義された CDP ドメインをテンプレートから構成して動作するように調整する。
<ul>
<li>生成物はchromedp/cdprotoとchromedp/cdproto/&lt;domain&gt;サブパッケージ。循環依存性を持つCDPタイプは<code>chromedp/cdproto/cdp</code>パッケージに配置される。</li>
</ul>
</li>
</ul>
<p>全体構成がほんのりわかったくらい。動かしてみよう</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/chromedp/cdproto-gen
</code></pre></div><p>いまって<code>go get</code>使うんだっけ?あ〜少なくとも1.17の時点で非推奨になっているので、1.19を使っている自分としては<code>go install</code>を使うべき。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Ffuture-architect.github.io%2Farticles%2F20210818a%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://future-architect.github.io/articles/20210818a/" style="display: none" rel="nofollow">https://future-architect.github.io/articles/20210818a/</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fre-engines.com%2F2021%2F10%2F11%2Fgo-1-16%25E3%2581%25A7%25E3%2581%25AEgo-get%25E3%2581%25A8go-install%25E3%2581%25AE%25E5%25A4%2589%25E6%259B%25B4%25E7%2582%25B9%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://re-engines.com/2021/10/11/go-1-16%E3%81%A7%E3%81%AEgo-get%E3%81%A8go-install%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9/" style="display: none" rel="nofollow">https://re-engines.com/2021/10/11/go-1-16でのgo-getとgo-installの変更点/</a></p>
<p><code>go get</code>は<code>go.mod</code>を編集するためのコマンド、<code>go install</code>はバイナリのビルド、インストールのためのコマンドになったと。</p>
<p><code>-u</code>オプションはなんだ？</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Ftadaken%2Fitems%2F9f8fd9c8e7096b6bffde" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde" style="display: none" rel="nofollow">https://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde</a></p>
<blockquote>
<p>新しいマイナーリリースまたはパッチリリースが利用可能な場合に、パッケージとその依存パッケージをネットワークから更新する。</p>
</blockquote>
<p>なるほど、最新版を取ってくる感じにすればいいのか。Goの公式サイト行って、go installを確認するか。</p>
<p>Goのドキュメント、検索機能ついてないの辛すぎないですか？</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgo.dev%2Fdoc%2Fcmd" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://go.dev/doc/cmd" style="display: none" rel="nofollow">https://go.dev/doc/cmd</a></p>
<p>これがコマンドのドキュメントっぽい。<code>go install &lt;package&gt;@&lt;version&gt;</code></p>
<p>割と最近まで更新されているのに、何で<code>go get</code>がREADMEに残っているんだろう。全然Issueにも上がっていない。つまり、これはgo getでやれってことなのかな？</p>
<p>とりあえずやってみよう。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/chromedp/cdproto-gen
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">go: go.mod <span class="token function">file</span> not found <span class="token keyword">in</span> current directory or any parent directory.
	<span class="token string">'go get'</span> is no longer supported outside a module.
	To build and <span class="token function">install</span> a command, use <span class="token string">'go install'</span> with a version,
	like <span class="token string">'go install example.com/cmd@latest'</span>
	For <span class="token function">more</span> information, see https://golang.org/doc/go-get-install-deprecation
	or run <span class="token string">'go help get'</span> or <span class="token string">'go help install'</span><span class="token builtin class-name">.</span>
</code></pre></div><p>ダメじゃん。というかヘルプコマンドナいと思ったら、helpの引数にコマンドを渡す形式だったんか。go installしてみる。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ go <span class="token function">install</span> github.com/chromedp/cdproto-gen

go <span class="token function">install</span> github.com/chromedp/cdproto-gen
go: <span class="token string">'go install'</span> requires a version when current directory is not <span class="token keyword">in</span> a module
	Try <span class="token string">'go install github.com/chromedp/cdproto-gen@latest'</span> to <span class="token function">install</span> the latest version

$ go <span class="token function">install</span> github.com/chromedp/cdproto-gen@latest

go: downloading github.com/chromedp/cdproto-gen v0.0.0-20200709115207-99c9ca13bbae
go: downloading github.com/mailru/easyjson v0.7.2-0.20200524104011-8ba3c7bdceed
go: downloading github.com/ryanuber/go-glob v1.0.0
go: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a
go: downloading golang.org/x/tools v0.0.0-20200606014950-c42cb6316fb6
go: downloading github.com/valyala/quicktemplate v1.5.0
go: downloading github.com/client9/misspell v0.3.4
go: downloading github.com/knq/snaker v0.0.0-20181215144011-2bc8a4db4687
go: downloading github.com/Masterminds/semver v1.5.0
go: downloading github.com/PuerkitoBio/goquery v1.5.1
go: downloading golang.org/x/net v0.0.0-20200602114024-627f9648deb9
go: downloading github.com/andybalholm/cascadia v1.2.0
go: downloading github.com/valyala/bytebufferpool v1.0.0
go: downloading golang.org/x/mod v0.2.0
go: downloading golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543
</code></pre></div><p>これでダウンロード完了した。みたい。次にREADMEのUsingのセクション。</p>
<p><code>cdproto-gen</code>で動くそうな。これも動かしてみるか。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ cdproto-gen
zsh: <span class="token builtin class-name">command</span> not found: cdproto-gen
</code></pre></div><p>まあPATHが通ってないんでしょうね。一旦Goのファイルがどこに落ちているのか調べる。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-Compile_and_install_packages_and_dependencies" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies" style="display: none" rel="nofollow">https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies</a></p>
<blockquote>
<p>Executables are installed in the directory named by the GOBIN environment variable, which defaults to $GOPATH/bin or $HOME/go/bin if the GOPATH environment variable is not set. Executables in $GOROOT are installed in $GOROOT/bin or $GOTOOLDIR instead of $GOBIN.</p>
</blockquote>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token variable">$GOROOT</span> <span class="token variable">$GOBIN</span> <span class="token variable">$GOPATH</span>


$ <span class="token function">ls</span> ~/go/bin
cdproto-gen
</code></pre></div><p>なるほど、ここにあるけどPATHが通ってないので、ということなのか。これGOPATHとか設定した方がいいのかな？もう少し公式ドキュメントを読み進める。</p>
<p><code>go install</code>自体のドキュメントにはなさそうなので、環境年数のドキュメントに飛びたい。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-GOPATH_environment_variable" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable" style="display: none" rel="nofollow">https://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-GOPATH_and_Modules" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules" style="display: none" rel="nofollow">https://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-Legacy_GOPATH_go_get" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get" style="display: none" rel="nofollow">https://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get</a></p>
<p>Overviewをみる限りだとここら辺かな？</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ go <span class="token function">env</span> GOPATH
~/go
</code></pre></div><p>インストール先と挙動はあっていそうなので単純にGOPATHへのPATHを通せば良さそう。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash"><span class="token comment"># .zshrc</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/go
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOBIN</span><span class="token operator">=</span><span class="token variable">$GOPATH</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$GOBIN</span>
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">cdproto-gen <span class="token parameter variable">--help</span>
Usage of cdproto-gen:
  <span class="token parameter variable">-cache</span> string
    	protocol cache directory
  <span class="token parameter variable">-chromium</span> string
    	chromium protocol version
  <span class="token parameter variable">-debug</span>
    	toggle debug <span class="token punctuation">(</span>writes generated files to disk without post-processing<span class="token punctuation">)</span>
  -go-pkg string
    	go base package name <span class="token punctuation">(</span>default <span class="token string">"github.com/chromedp/cdproto"</span><span class="token punctuation">)</span>
  -go-wl string
    	comma-separated list of files to whitelist <span class="token punctuation">(</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">(</span>default <span class="token string">"LICENSE,README.md,*.pdl,go.mod,go.sum,easyjson.go"</span><span class="token punctuation">)</span>
  <span class="token parameter variable">-latest</span>
    	use latest protocol
  -no-clean
    	toggle not cleaning <span class="token punctuation">(</span>removing<span class="token punctuation">)</span> existing directories
  -no-dump
    	toggle not dumping generated protocol <span class="token function">file</span> to out directory
  <span class="token parameter variable">-out</span> string
    	package out directory
  <span class="token parameter variable">-pdl</span> string
    	path to pdl <span class="token function">file</span> to use
  <span class="token parameter variable">-ttl</span> duration
    	<span class="token function">file</span> retrieval caching ttl <span class="token punctuation">(</span>default 24h0m0s<span class="token punctuation">)</span>
  <span class="token parameter variable">-v8</span> string
    	v8 protocol version
</code></pre></div><p>認識されたようだ。一旦休憩</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T07:46:56Z" title="2022-08-21T07:46:56Z">2022-08-21 07:08:00</time></header><div><p>では実際に動かして、何をしているのかみてみるところから再開。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ cdproto-gen

<span class="token comment"># 一部だけ抜粋</span>
panic: could not resolve <span class="token builtin class-name">type</span> cdp.compatibilitymode <span class="token keyword">in</span> domain cdp
</code></pre></div><p>なんかとりあえずpanicになってそう笑</p>
<p>コマンドの実行履歴的に、<code>~/Library/Caches/cdproto-gen</code>あたりに何かを生成していそうなのでみてみる。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">Library/Caches/cdproto-gen
❯ la
total <span class="token number">0</span>
drwxr-xr-x    <span class="token number">6</span> ikuma  staff   <span class="token number">192</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 <span class="token builtin class-name">.</span>
drwx------+ <span class="token number">129</span> ikuma  staff  <span class="token number">4128</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 <span class="token punctuation">..</span>
drwxr-xr-x    <span class="token number">3</span> ikuma  staff    <span class="token number">96</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 deps
drwxr-xr-x    <span class="token number">3</span> ikuma  staff    <span class="token number">96</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 html
drwxr-xr-x    <span class="token number">5</span> ikuma  staff   <span class="token number">160</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 pdl
drwxr-xr-x    <span class="token number">3</span> ikuma  staff    <span class="token number">96</span>  <span class="token number">8</span> <span class="token number">21</span> <span class="token number">16</span>:02 refs
</code></pre></div><p>お〜！できてる。</p>
<p>無難にhtmlから開いてみるか。</p>
<p>内容はREADMEにあるとおり、以下のサイトのものっぽい。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fchromium.googlesource.com%2Fchromium%2Fsrc.git" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://chromium.googlesource.com/chromium/src.git" style="display: none" rel="nofollow">https://chromium.googlesource.com/chromium/src.git</a></p>
<p>このサイト自体は、gitliesというツールで作られているようです。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgerrit.googlesource.com%2Fgitiles%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://gerrit.googlesource.com/gitiles/" style="display: none" rel="nofollow">https://gerrit.googlesource.com/gitiles/</a></p>
<p>そのほかもみてみるか。次にpdl。</p>
<p>chromium/107.0.5252.1.pdl と同じように、combinedとv8のpdlが格納されている。</p>
<p>ここまでの動作から、grab.goでこの取得処理をしていることがわかる。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F73b2ad0f16066348aa47151b49d11ec51c7e531a%2Fgrab.go" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go" style="display: none" rel="nofollow">https://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go</a></p>
<p>たぶん情報の取得処理自体は完了していて、そこから何か仕様にもなにかがよくなくてエラーになっている。エラーメッセージに戻る。</p>
<p>Panic自体はGoにおける例外処理的な仕組みなのかな？</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fmoneyforward.com%2Fengineers_blog%2F2020%2F09%2F09%2Fgoroutine-panic-handling%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/" style="display: none" rel="nofollow">https://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/</a></p>
<p>公式読まないでごめんだけど、雰囲気掴むために日本語ブログ読む。</p>
<blockquote>
<p>panicは、コールされるとプログラムが終了するビルトイン関数の事です。</p>
</blockquote>
<p>なるほど。で、実際にpanicを呼び出しているのはここだ。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F5017836d2c839513555503c7fbbd884daafdf467%2Fgen%2Fgotpl%2Futil.go%23L143" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143" style="display: none" rel="nofollow">https://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143</a></p>
<p>大元はここ</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F99c9ca13bbaef6b33dec6d46e232ce22367fc1a7%2Fmain.go%23L233" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233" style="display: none" rel="nofollow">https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233</a></p>
<p>めちゃくちゃ一つの関数長いじゃんか...。でも読まなきゃわからんので読む。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T08:09:07Z" title="2022-08-21T08:09:07Z">2022-08-21 08:08:00</time></header><div><p>え〜と、<code>*</code>はポインタを指しているでいいんだよね。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>
    flagCache <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"cache"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"protocol cache directory"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>最初にここで宣言している。flagは標準のpackageで、コマンドラインで渡されるフラグをパースできるやつだそう。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fflag" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/flag" style="display: none" rel="nofollow">https://pkg.go.dev/flag</a></p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ cdproto-gen <span class="token parameter variable">--help</span>

Usage of cdproto-gen:
  <span class="token parameter variable">-cache</span> string
        protocol cache directory
</code></pre></div><p>OptionParserみたいなものか。指定がなければ、osのUserCacheDirを使うみたい。osはGo本体に含まれているみたい。</p>
<p>続いて、取得対象のChromiumのバージョンを取得しているんだけど、これどういう意味かぱっと見でわからんな。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">if</span> <span class="token operator">*</span>flagChromium<span class="token punctuation">,</span> err <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">GetLatestVersion</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>Cache<span class="token punctuation">{</span>
    URL<span class="token punctuation">:</span>  util<span class="token punctuation">.</span>ChromiumBase<span class="token punctuation">,</span>
    Path<span class="token punctuation">:</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token operator">*</span>flagCache<span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token string">"chromium.html"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TTL<span class="token punctuation">:</span>  <span class="token operator">*</span>flagTTL<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre></div><p>if文の条件のところで定義できるってやるだと思うんだけど...</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token operator">*</span>flagChromium<span class="token punctuation">,</span> err <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">GetLatestVersion</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>Cache<span class="token punctuation">{</span>
    URL<span class="token punctuation">:</span>  util<span class="token punctuation">.</span>ChromiumBase<span class="token punctuation">,</span>
    Path<span class="token punctuation">:</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token operator">*</span>flagCache<span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token string">"chromium.html"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TTL<span class="token punctuation">:</span>  <span class="token operator">*</span>flagTTL<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ここまでがたぶん代入のところだよね。ようはutilityとして定義した関数がerrを返さなければOKということでしょう。</p>
<p>同様にパラメータの定義が進んでいき、続いてプロトコル定義のロードっぽいです。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T11:29:29Z" title="2022-08-21T11:29:29Z">2022-08-21 11:08:00</time></header><div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F99c9ca13bbaef6b33dec6d46e232ce22367fc1a7%2Fmain.go%23L133" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133" style="display: none" rel="nofollow">https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133</a></p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">loadProtoDefs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>PDL<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>

	<span class="token keyword">if</span> <span class="token operator">*</span>flagPdl <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>
		util<span class="token punctuation">.</span><span class="token function">Logf</span><span class="token punctuation">(</span><span class="token string">"PROTOCOL: %s"</span><span class="token punctuation">,</span> <span class="token operator">*</span>flagPdl<span class="token punctuation">)</span>
		buf<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token operator">*</span>flagPdl<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> pdl<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> protoDefs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>PDL
	load <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>urlstr<span class="token punctuation">,</span> typ<span class="token punctuation">,</span> ver <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		buf<span class="token punctuation">,</span> err <span class="token operator">:=</span> util<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>Cache<span class="token punctuation">{</span>
			URL<span class="token punctuation">:</span>    fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>urlstr<span class="token operator">+</span><span class="token string">"?format=TEXT"</span><span class="token punctuation">,</span> ver<span class="token punctuation">)</span><span class="token punctuation">,</span>
			Path<span class="token punctuation">:</span>   filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token operator">*</span>flagCache<span class="token punctuation">,</span> <span class="token string">"pdl"</span><span class="token punctuation">,</span> typ<span class="token punctuation">,</span> ver<span class="token operator">+</span><span class="token string">".pdl"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			TTL<span class="token punctuation">:</span>    <span class="token operator">*</span>flagTTL<span class="token punctuation">,</span>
			Decode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>

		<span class="token comment">// parse</span>
		protoDef<span class="token punctuation">,</span> err <span class="token operator">:=</span> pdl<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		protoDefs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>protoDefs<span class="token punctuation">,</span> protoDef<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// grab browser + js definition</span>
	<span class="token keyword">if</span> err <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>ChromiumURL<span class="token punctuation">,</span> <span class="token string">"chromium"</span><span class="token punctuation">,</span> <span class="token operator">*</span>flagChromium<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>V8URL<span class="token punctuation">,</span> <span class="token string">"v8"</span><span class="token punctuation">,</span> <span class="token operator">*</span>flagV8<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// grab har definition</span>
	har<span class="token punctuation">,</span> err <span class="token operator">:=</span> pdl<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>pdl<span class="token punctuation">.</span>HAR<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> pdl<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span><span class="token function">append</span><span class="token punctuation">(</span>protoDefs<span class="token punctuation">,</span> har<span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Goには組み込みのerror型がある</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> <span class="token builtin">error</span> <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>pdlを引数として渡した場合は、渡したpdlをパースして終了。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">var</span> protoDefs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>PDL
</code></pre></div><p>こういうのもスラスラ読めないの辛いな。え〜と、<code>var</code>で変数宣言なので、<code>protoDefs</code>という変数を宣言している。後ろにあるのが型なので、<code>[]*pdl.PDL</code>型ってことかな。</p>
<p>で、<code>[]</code>はスライスで、<code>*pdl.PDL</code>はポインタなので、この長さを持ったスライス？</p>
<p>長さは関係なかった。<code>pdl.PDL</code>は次の定義となっている</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> PDL <span class="token keyword">struct</span> <span class="token punctuation">{</span> 
    <span class="token comment">// Copyright is the file copyright.</span>
    Copyright <span class="token builtin">string</span>

    <span class="token comment">// Version is the file version information.</span>
    Version <span class="token operator">*</span>Version

    <span class="token comment">// Domains are the available domains.</span>
    Domains <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Domain
<span class="token punctuation">}</span>
</code></pre></div><p>あれ、関数の宣言で引数の型を省略したらGoではどうなるの？あ〜、2つ以上の引数の型が同じ梅は、最後の型を省略して記述できる。</p>
<hr>
<p>処理の大枠の流れとしては、</p>
<ol>
<li>取得したPDLファイルを読み込む</li>
<li>読み込んだPDLをParseして、protoDefという変数に突っ込んであげる</li>
</ol>
<p>って感じ。ポインタが謎すぎる。で、関数はファーストクラスファンクションなので、この処理を<code>load</code>として動的に定義してあげる。そっか、ここで関数として切り出さないんだな。<code>protoDef</code>をこの関数全体のコンテキストで共有していて、それに依存するし、関数化したい思ったのは、あくまで2回出てくるからくらいなので、ここで定義しているって感じか。</p>
<p>ソースをみている感じ、PDLの中にHARの定義も書いてあって、これも読み取っている。</p>
<p>で、最終的に</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">return</span> pdl<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span><span class="token function">append</span><span class="token punctuation">(</span>protoDefs<span class="token punctuation">,</span> har<span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</code></pre></div><p>ってやっているんだけど、これ何？特に<code>...</code></p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T11:50:38Z" title="2022-08-21T11:50:38Z">2022-08-21 11:08:00</time></header><div><p>一旦調査に時間がかかりすぎる部分は置いておいて、残りをみてみることにする。</p>
<p>また<code>main.run</code>に戻って来た。</p>
<p><code>loadProtoDefs</code>を用いて、PDLの情報を<code>protoDefs</code>に代入する。</p>
<p><code>sort.Slice</code>: これは標準っぽい。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2FSekky0905%2Fitems%2F2d5ccd6d076106e9d21c" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://qiita.com/Sekky0905/items/2d5ccd6d076106e9d21c" style="display: none" rel="nofollow">https://qiita.com/Sekky0905/items/2d5ccd6d076106e9d21c</a></p>
<ul>
<li>ソートには安定ソートという概念がある。</li>
<li>sort packageのSliceは安定ソートを保証せず、SliceStableは安定ソートを保する</li>
</ul>
<p>第2引数に関数を渡しているけど、一般的にいえばこの関数で比較してソートしてそう。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go">sort<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span>protoDefs<span class="token punctuation">.</span>Domains<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>protoDefs<span class="token punctuation">.</span>Domains<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Domain<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> protoDefs<span class="token punctuation">.</span>Domains<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Domain<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>で、この後にフォルダを作成して、どんどん書き込んでいく。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">if</span> d<span class="token punctuation">.</span>Deprecated <span class="token punctuation">{</span>
	<span class="token keyword">var</span> extra <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	extra <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>extra<span class="token punctuation">,</span> <span class="token string">"deprecated"</span><span class="token punctuation">)</span>
	util<span class="token punctuation">.</span><span class="token function">Logf</span><span class="token punctuation">(</span><span class="token string">"SKIPPING(%s): %s %v"</span><span class="token punctuation">,</span> <span class="token function">pad</span><span class="token punctuation">(</span><span class="token string">"domain"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>Domain<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> extra<span class="token punctuation">)</span>
	<span class="token keyword">continue</span>
<span class="token punctuation">}</span>
</code></pre></div><p>で、どうもDeprecatedなものがあれば、スキップされているみたい。</p>
<p>このあとREADMEにもあった、<code>fixup</code>処理をやっているんだけど、これはなに？</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// fixup</span>
fixup<span class="token punctuation">.</span><span class="token function">FixDomains</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span>
</code></pre></div><p>pdlgen/fixup/fixup.goに飛んだ。コメントには何が書いてある？</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// FixDomains modifies, updates, alters, fixes, and adds to the types defined</span>
<span class="token comment">// in the domains, so that the generated Chrome DevTools Protocol domain code</span>
<span class="token comment">// is more Go-like and easier to use.</span>
<span class="token comment">//</span>
<span class="token comment">// Please see package-level documentation for the list of changes made to the</span>
<span class="token comment">// various domains.</span>
<span class="token keyword">func</span> <span class="token function">FixDomains</span><span class="token punctuation">(</span>domains <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>Domain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>ってことで、Packageのドキュメントをみてみる。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// Package fixup modifies/alters/fixes and adds to the low level type</span>
<span class="token comment">// definitions for the Chrome DevTools Protocol domains, as generated from</span>
<span class="token comment">// protocol.json.</span>
<span class="token comment">//</span>
<span class="token comment">// The goal of package fixup is to fix the issues associated with generating Go</span>
<span class="token comment">// code from the existing Chrome domain definitions, and is wrapped up in one</span>
<span class="token comment">// high-level func, FixDomains.</span>
<span class="token comment">//</span>
<span class="token comment">// Currently, FixDomains does the following:</span>
<span class="token comment">//  - add `Inspector.DetachReason` type and change `Inspector.detached.reason`</span>
<span class="token comment">//    type to `Inspector.DetachReason`.</span>
<span class="token comment">//  - change `Network.TimeSinceEpoch`, `Network.MonotonicTime`, and</span>
<span class="token comment">//    `Runtime.Timestamp` types to `TimestampTypeSecond` and</span>
<span class="token comment">//    `TimestampTypeMonotonic`.</span>
<span class="token comment">//  - convert all object properties and event/command parameters that are enums</span>
<span class="token comment">//    into separate types.</span>
<span class="token comment">//  - change any object property named `modifiers` to type `Input.Modifier`.</span>
<span class="token comment">//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to</span>
<span class="token comment">//    `DOM.NodeType`.</span>
<span class="token comment">//  - change `Page.Frame.{id,parentID}` property named `modifiers` to type `Input.Modifier`.</span>
<span class="token comment">//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to</span>
<span class="token comment">//    `DOM.NodeType`.</span>
<span class="token comment">//  - change `Page.Frame.{id,parentID}` properties to `FrameID` type.</span>
<span class="token comment">//  - add additional properties to `Page.Frame` and `DOM.Node` for use by</span>
<span class="token comment">//    higher level packages.</span>
<span class="token comment">//  - add special unmarshaler to `Page.{NodeId,BackendNodeId,FrameId}` types to</span>
<span class="token comment">//    handle unquoted values from older (v1.1) protocol versions. NOTE: it may</span>
<span class="token comment">//    be necessary in the future to apply this to more types, such as</span>
<span class="token comment">//    `Network.LoaderId`.</span>
<span class="token comment">//  - rename `Input.GestureSourceType` to `Input.GestureType`.</span>
<span class="token comment">//  - fix type/name stuttering by stripping the package name from any type</span>
<span class="token comment">//    where the package name is a prefix (ie, `CSS` domain).</span>
<span class="token comment">//  - add Error() method to `Runtime.ExceptionDetails` so that it can be used</span>
<span class="token comment">//    as error.</span>
<span class="token comment">//  - change `Network.Headers` type to map[string]interface{}.</span>
<span class="token comment">//</span>
<span class="token comment">// Please note that the above is not an exhaustive list of all modifications</span>
<span class="token comment">// applied to the domains, however it does attempt </span>
</code></pre></div><p>細かいことは「Currently, ...」以下にまとめられているけど、CDPのプロトコルから、GoLikeな感じでコードを生成するために必要な情報を付与している。<br>
あと備忘として、ここにある情報だけがやっていることの全てではないことに注意。</p>
<p>これRubyでやるときにどうするかなあ。RBSでやってもいいけど、実装時間が足りないかんじするよな。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T12:14:46Z" title="2022-08-21T12:14:46Z">2022-08-21 12:08:00</time></header><div><p>で、次にgeneratorの生成をやっている。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go">generator <span class="token operator">:=</span> gen<span class="token punctuation">.</span><span class="token function">Generators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"go"</span><span class="token punctuation">]</span>
<span class="token keyword">if</span> generator <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"no generator"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>gen.Generators()</code>の中身はこうなっている。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Generator <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Emitter<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

<span class="token comment">// Generators returns all the various Chrome DevTools Protocol generators.</span>
<span class="token keyword">func</span> <span class="token function">Generators</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Generator <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Generator<span class="token punctuation">{</span>
		<span class="token string">"go"</span><span class="token punctuation">:</span> NewGoGenerator<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>いまいちこの<code>type</code>による関数定義が何をしているのかよくわかっていない。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Ftenntenn%2Fitems%2F45c568d43e950292bc31" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://qiita.com/tenntenn/items/45c568d43e950292bc31" style="display: none" rel="nofollow">https://qiita.com/tenntenn/items/45c568d43e950292bc31</a></p>
<blockquote>
<p>typeという予約語を用いると、既存の型や型リテラルに別名をつけることができます</p>
</blockquote>
<p>あ〜、この記事で一番大事なのはここだ</p>
<blockquote>
<p>typeやメソッドが構造体ありきで学習していくと、後々、http.HandlerFuncなどに出くわしたときに、きちんと理解できず、「おまじない」になってしまいがちです。言語仕様をきちんと読み、普段なんとなく書いている記述が文法上どのように定義されているのか理解することで、今まできちんと理解してなかった概念や知らなかった概念を知る機会になります。Goの言語仕様は、そんなに長くなく、少しずつ読んでいけばちゃんと読める量なので、ぜひ読んでみることをオススメします。英語が厳しい方は、文法を定義したBNFを斜め読みするだけでも十分効果はあると思います。</p>
</blockquote>
<p>とりあえずこの部分については、<code>([]*pdl.Domain, string)</code>を引数に取り、<code>(Emitter, error)</code>を戻り値として返す関数を<code>Generator</code>という名前の型として定義しますよ、ってことだ。</p>
<p>で、このEmitterについては直後に定義があって、</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Emitter <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer
<span class="token punctuation">}</span>
</code></pre></div><p>で、元に戻って、<code>NewGoGenerator</code>は何かという話。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Generators</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Generator <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Generator<span class="token punctuation">{</span>
		<span class="token string">"go"</span><span class="token punctuation">:</span> NewGoGenerator<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは<code>pdlgen/gen/gogen.go</code>に定義されている。ここが核であり、おそらくこの生成結果によって、後ちょっとでpanicになる。`</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-21T13:03:15Z" title="2022-08-21T13:03:15Z">2022-08-21 13:08:00</time></header><div><div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// NewGoGenerator creates a Go source code generator for the Chrome DevTools</span>
<span class="token comment">// Protocol domain definitions.</span>
<span class="token keyword">func</span> <span class="token function">NewGoGenerator</span><span class="token punctuation">(</span>domains <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>pdl<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span> basePkg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Emitter<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> w <span class="token operator">*</span>qtpl<span class="token punctuation">.</span>Writer
</code></pre></div><p>冒頭に<code>qtpl</code>という意味のわからない文字列が出てくるけど、これは<code>quicktemplate</code>というGoのテンプレートエンジンだそう。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fvalyala%2Fquicktemplate" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/valyala/quicktemplate" style="display: none" rel="nofollow">https://github.com/valyala/quicktemplate</a></p>
<blockquote>
<p>A fast, powerful, yet easy to use template engine for Go. Inspired by the Mako templates philosophy.</p>
</blockquote>
<p>で、このquicktemplateはPythonの<code>Mako templates</code>の哲学に影響を受けているんだと。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fwww.makotemplates.org%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://www.makotemplates.org/" style="display: none" rel="nofollow">https://www.makotemplates.org/</a></p>
<p>なんかerbみたいな感じがするな。というわけでRubyに戻る</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fmagazine.rubyist.net%2Farticles%2F0024%2F0024-TemplateSystem.html" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://magazine.rubyist.net/articles/0024/0024-TemplateSystem.html" style="display: none" rel="nofollow">https://magazine.rubyist.net/articles/0024/0024-TemplateSystem.html</a></p>
<p>この感じだとどうもHTML（というかそれに近いもの）を出力しそうな感じだけど、最終成果物はどうなるんだろう？<br>
Goに戻ろう。</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// generate individual domains</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> d <span class="token operator">:=</span> <span class="token keyword">range</span> domains <span class="token punctuation">{</span>
	pkgName <span class="token operator">:=</span> genutil<span class="token punctuation">.</span><span class="token function">PackageName</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
	pkgOut <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>pkgName<span class="token punctuation">,</span> pkgName<span class="token operator">+</span><span class="token string">".go"</span><span class="token punctuation">)</span>

	<span class="token comment">// do command template</span>
	w <span class="token operator">=</span> fb<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pkgOut<span class="token punctuation">,</span> pkgName<span class="token punctuation">,</span> d<span class="token punctuation">,</span> domains<span class="token punctuation">,</span> basePkg<span class="token punctuation">)</span>
	gotpl<span class="token punctuation">.</span><span class="token function">StreamDomainTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> d<span class="token punctuation">,</span> domains<span class="token punctuation">)</span>
	fb<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>

	<span class="token comment">// generate domain types</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Types<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		fb<span class="token punctuation">.</span><span class="token function">generateTypes</span><span class="token punctuation">(</span>
			filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>pkgName<span class="token punctuation">,</span> <span class="token string">"types.go"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			d<span class="token punctuation">.</span>Types<span class="token punctuation">,</span> gotpl<span class="token punctuation">.</span>TypePrefix<span class="token punctuation">,</span> gotpl<span class="token punctuation">.</span>TypeSuffix<span class="token punctuation">,</span>
			d<span class="token punctuation">,</span> domains<span class="token punctuation">,</span>
			basePkg<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// generate domain event types</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Events<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		fb<span class="token punctuation">.</span><span class="token function">generateTypes</span><span class="token punctuation">(</span>
			filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>pkgName<span class="token punctuation">,</span> <span class="token string">"events.go"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			d<span class="token punctuation">.</span>Events<span class="token punctuation">,</span> gotpl<span class="token punctuation">.</span>EventTypePrefix<span class="token punctuation">,</span> gotpl<span class="token punctuation">.</span>EventTypeSuffix<span class="token punctuation">,</span>
			d<span class="token punctuation">,</span> domains<span class="token punctuation">,</span>
			basePkg<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>次はここみるところから。</p>
</div></section></article></article></div></main><footer class="font-bold border-t-2 border-slate-100"><div class="max-w-6xl mx-auto px-5"><nav class="py-12"><ul class="flex justify-around text-white"><li><a href="/diary">Home</a></li><li><a href="https://ikuma-t.work">Blog</a></li></ul></nav></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"body":"","bodyHTML":"","active_lock_reason":null,"assignee":null,"assignees":[],"author_association":"OWNER","closed_at":null,"comments":0,"comments_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69/comments","created_at":"2022-08-20T23:15:51Z","events_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69/events","html_url":"https://github.com/IkumaTadokoro/diary/issues/69","id":1345328710,"labels":[],"labels_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69/labels{/name}","locked":false,"milestone":null,"node_id":"I_kwDOHWTPVs5QMBZG","number":69,"performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69/reactions"},"repository_url":"https://api.github.com/repos/IkumaTadokoro/diary","state":"open","state_reason":null,"timeline_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69/timeline","title":"2022-08-21","updated_at":"2022-08-20T23:15:51Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},"issueComments":[{"body":"pdlgenの挙動をみていく。\n\nまずは動かしてみて、どういうふうに動くかを確認する。\n\nREADMEをちゃんと読んでおこう。いそがば回れだ。\n\n- cdproto-genはChrome DevTools Protocolのコマンド、イベント、型のためのGoコードを生成する。\n- cdproto-genはChromiumソースツリーから`browser_protocol.pdl`と`js_protocol.pdl`を取得する。これらは`$GOPATH/pkg/cdproto-gen`にキャッシュされ、定期的に更新される。\n- HAR定義は特別なHARドメインを生成するために使用される。\n  - HAR定義ってなんだ？\n　- http://www.softwareishard.com/blog/har-12-spec/ のことみたい\n  - HTTP ARchive 1.2のことだそう。\n  - Webブラウザーとサイトとのやりとりに関する詳細なパフォーマンスデータをエクスポートするためのHTTPトランザクションのアーカイブ形式を定義する仕様\n- cdproto-gen は browser_protocol.pdl と js_protocol.pdl で定義された CDP ドメインをテンプレートから構成して動作するように調整する。\n  - 生成物はchromedp/cdprotoとchromedp/cdproto/\u003cdomain\u003eサブパッケージ。循環依存性を持つCDPタイプは`chromedp/cdproto/cdp`パッケージに配置される。\n\n全体構成がほんのりわかったくらい。動かしてみよう\n\n```bash\ngo get -u github.com/chromedp/cdproto-gen\n```\n\nいまって`go get`使うんだっけ?あ〜少なくとも1.17の時点で非推奨になっているので、1.19を使っている自分としては`go install`を使うべき。\n\nhttps://future-architect.github.io/articles/20210818a/\n\nhttps://re-engines.com/2021/10/11/go-1-16%E3%81%A7%E3%81%AEgo-get%E3%81%A8go-install%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9/\n\n`go get`は`go.mod`を編集するためのコマンド、`go install`はバイナリのビルド、インストールのためのコマンドになったと。\n\n\n`-u`オプションはなんだ？\n\nhttps://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde\n\n\u003e 新しいマイナーリリースまたはパッチリリースが利用可能な場合に、パッケージとその依存パッケージをネットワークから更新する。\n\nなるほど、最新版を取ってくる感じにすればいいのか。Goの公式サイト行って、go installを確認するか。\n\nGoのドキュメント、検索機能ついてないの辛すぎないですか？\n\nhttps://go.dev/doc/cmd\n\nこれがコマンドのドキュメントっぽい。`go install \u003cpackage\u003e@\u003cversion\u003e`\n\n割と最近まで更新されているのに、何で`go get`がREADMEに残っているんだろう。全然Issueにも上がっていない。つまり、これはgo getでやれってことなのかな？\n\nとりあえずやってみよう。\n\n```bash\ngo get -u github.com/chromedp/cdproto-gen\n```\n\n```bash\ngo: go.mod file not found in current directory or any parent directory.\n\t'go get' is no longer supported outside a module.\n\tTo build and install a command, use 'go install' with a version,\n\tlike 'go install example.com/cmd@latest'\n\tFor more information, see https://golang.org/doc/go-get-install-deprecation\n\tor run 'go help get' or 'go help install'.\n```\n\nダメじゃん。というかヘルプコマンドナいと思ったら、helpの引数にコマンドを渡す形式だったんか。go installしてみる。\n\n\n```bash\n$ go install github.com/chromedp/cdproto-gen\n\ngo install github.com/chromedp/cdproto-gen\ngo: 'go install' requires a version when current directory is not in a module\n\tTry 'go install github.com/chromedp/cdproto-gen@latest' to install the latest version\n\n$ go install github.com/chromedp/cdproto-gen@latest\n\ngo: downloading github.com/chromedp/cdproto-gen v0.0.0-20200709115207-99c9ca13bbae\ngo: downloading github.com/mailru/easyjson v0.7.2-0.20200524104011-8ba3c7bdceed\ngo: downloading github.com/ryanuber/go-glob v1.0.0\ngo: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a\ngo: downloading golang.org/x/tools v0.0.0-20200606014950-c42cb6316fb6\ngo: downloading github.com/valyala/quicktemplate v1.5.0\ngo: downloading github.com/client9/misspell v0.3.4\ngo: downloading github.com/knq/snaker v0.0.0-20181215144011-2bc8a4db4687\ngo: downloading github.com/Masterminds/semver v1.5.0\ngo: downloading github.com/PuerkitoBio/goquery v1.5.1\ngo: downloading golang.org/x/net v0.0.0-20200602114024-627f9648deb9\ngo: downloading github.com/andybalholm/cascadia v1.2.0\ngo: downloading github.com/valyala/bytebufferpool v1.0.0\ngo: downloading golang.org/x/mod v0.2.0\ngo: downloading golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543\n```\n\nこれでダウンロード完了した。みたい。次にREADMEのUsingのセクション。\n\n`cdproto-gen`で動くそうな。これも動かしてみるか。\n\n```bash\n$ cdproto-gen\nzsh: command not found: cdproto-gen\n```\n\nまあPATHが通ってないんでしょうね。一旦Goのファイルがどこに落ちているのか調べる。\n\nhttps://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies\n\n\u003e Executables are installed in the directory named by the GOBIN environment variable, which defaults to $GOPATH/bin or $HOME/go/bin if the GOPATH environment variable is not set. Executables in $GOROOT are installed in $GOROOT/bin or $GOTOOLDIR instead of $GOBIN.\n\n```bash\n$ echo $GOROOT $GOBIN $GOPATH\n\n\n$ ls ~/go/bin\ncdproto-gen\n```\n\nなるほど、ここにあるけどPATHが通ってないので、ということなのか。これGOPATHとか設定した方がいいのかな？もう少し公式ドキュメントを読み進める。\n\n`go install`自体のドキュメントにはなさそうなので、環境年数のドキュメントに飛びたい。\n\nhttps://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable\n\nhttps://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules\n\nhttps://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get\n\nOverviewをみる限りだとここら辺かな？\n\n```bash\n$ go env GOPATH\n~/go\n```\n\nインストール先と挙動はあっていそうなので単純にGOPATHへのPATHを通せば良さそう。\n\n```bash\n# .zshrc\nexport GOPATH=$HOME/go\nexport GOBIN=$GOPATH/bin\nexport PATH=$PATH:$GOBIN\n```\n\n```bash\ncdproto-gen --help\nUsage of cdproto-gen:\n  -cache string\n    \tprotocol cache directory\n  -chromium string\n    \tchromium protocol version\n  -debug\n    \ttoggle debug (writes generated files to disk without post-processing)\n  -go-pkg string\n    \tgo base package name (default \"github.com/chromedp/cdproto\")\n  -go-wl string\n    \tcomma-separated list of files to whitelist (ignore) (default \"LICENSE,README.md,*.pdl,go.mod,go.sum,easyjson.go\")\n  -latest\n    \tuse latest protocol\n  -no-clean\n    \ttoggle not cleaning (removing) existing directories\n  -no-dump\n    \ttoggle not dumping generated protocol file to out directory\n  -out string\n    \tpackage out directory\n  -pdl string\n    \tpath to pdl file to use\n  -ttl duration\n    \tfile retrieval caching ttl (default 24h0m0s)\n  -v8 string\n    \tv8 protocol version\n```\n\n認識されたようだ。一旦休憩\n","bodyHTML":"\u003cp\u003epdlgenの挙動をみていく。\u003c/p\u003e\n\u003cp\u003eまずは動かしてみて、どういうふうに動くかを確認する。\u003c/p\u003e\n\u003cp\u003eREADMEをちゃんと読んでおこう。いそがば回れだ。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecdproto-genはChrome DevTools Protocolのコマンド、イベント、型のためのGoコードを生成する。\u003c/li\u003e\n\u003cli\u003ecdproto-genはChromiumソースツリーから\u003ccode\u003ebrowser_protocol.pdl\u003c/code\u003eと\u003ccode\u003ejs_protocol.pdl\u003c/code\u003eを取得する。これらは\u003ccode\u003e$GOPATH/pkg/cdproto-gen\u003c/code\u003eにキャッシュされ、定期的に更新される。\u003c/li\u003e\n\u003cli\u003eHAR定義は特別なHARドメインを生成するために使用される。\n\u003cul\u003e\n\u003cli\u003eHAR定義ってなんだ？\u003cbr\u003e\n　- \u003ca href=\"http://www.softwareishard.com/blog/har-12-spec/\" rel=\"nofollow\"\u003ehttp://www.softwareishard.com/blog/har-12-spec/\u003c/a\u003e のことみたい\u003c/li\u003e\n\u003cli\u003eHTTP ARchive 1.2のことだそう。\u003c/li\u003e\n\u003cli\u003eWebブラウザーとサイトとのやりとりに関する詳細なパフォーマンスデータをエクスポートするためのHTTPトランザクションのアーカイブ形式を定義する仕様\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ecdproto-gen は browser_protocol.pdl と js_protocol.pdl で定義された CDP ドメインをテンプレートから構成して動作するように調整する。\n\u003cul\u003e\n\u003cli\u003e生成物はchromedp/cdprotoとchromedp/cdproto/\u0026lt;domain\u0026gt;サブパッケージ。循環依存性を持つCDPタイプは\u003ccode\u003echromedp/cdproto/cdp\u003c/code\u003eパッケージに配置される。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e全体構成がほんのりわかったくらい。動かしてみよう\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ego get \u003cspan class=\"token parameter variable\"\u003e-u\u003c/span\u003e github.com/chromedp/cdproto-gen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eいまって\u003ccode\u003ego get\u003c/code\u003e使うんだっけ?あ〜少なくとも1.17の時点で非推奨になっているので、1.19を使っている自分としては\u003ccode\u003ego install\u003c/code\u003eを使うべき。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Ffuture-architect.github.io%2Farticles%2F20210818a%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://future-architect.github.io/articles/20210818a/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://future-architect.github.io/articles/20210818a/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fre-engines.com%2F2021%2F10%2F11%2Fgo-1-16%25E3%2581%25A7%25E3%2581%25AEgo-get%25E3%2581%25A8go-install%25E3%2581%25AE%25E5%25A4%2589%25E6%259B%25B4%25E7%2582%25B9%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://re-engines.com/2021/10/11/go-1-16%E3%81%A7%E3%81%AEgo-get%E3%81%A8go-install%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://re-engines.com/2021/10/11/go-1-16でのgo-getとgo-installの変更点/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego get\u003c/code\u003eは\u003ccode\u003ego.mod\u003c/code\u003eを編集するためのコマンド、\u003ccode\u003ego install\u003c/code\u003eはバイナリのビルド、インストールのためのコマンドになったと。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e-u\u003c/code\u003eオプションはなんだ？\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Ftadaken%2Fitems%2F9f8fd9c8e7096b6bffde\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e新しいマイナーリリースまたはパッチリリースが利用可能な場合に、パッケージとその依存パッケージをネットワークから更新する。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eなるほど、最新版を取ってくる感じにすればいいのか。Goの公式サイト行って、go installを確認するか。\u003c/p\u003e\n\u003cp\u003eGoのドキュメント、検索機能ついてないの辛すぎないですか？\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgo.dev%2Fdoc%2Fcmd\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://go.dev/doc/cmd\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://go.dev/doc/cmd\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこれがコマンドのドキュメントっぽい。\u003ccode\u003ego install \u0026lt;package\u0026gt;@\u0026lt;version\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e割と最近まで更新されているのに、何で\u003ccode\u003ego get\u003c/code\u003eがREADMEに残っているんだろう。全然Issueにも上がっていない。つまり、これはgo getでやれってことなのかな？\u003c/p\u003e\n\u003cp\u003eとりあえずやってみよう。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ego get \u003cspan class=\"token parameter variable\"\u003e-u\u003c/span\u003e github.com/chromedp/cdproto-gen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ego: go.mod \u003cspan class=\"token function\"\u003efile\u003c/span\u003e not found \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e current directory or any parent directory.\n\t\u003cspan class=\"token string\"\u003e'go get'\u003c/span\u003e is no longer supported outside a module.\n\tTo build and \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e a command, use \u003cspan class=\"token string\"\u003e'go install'\u003c/span\u003e with a version,\n\tlike \u003cspan class=\"token string\"\u003e'go install example.com/cmd@latest'\u003c/span\u003e\n\tFor \u003cspan class=\"token function\"\u003emore\u003c/span\u003e information, see https://golang.org/doc/go-get-install-deprecation\n\tor run \u003cspan class=\"token string\"\u003e'go help get'\u003c/span\u003e or \u003cspan class=\"token string\"\u003e'go help install'\u003c/span\u003e\u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eダメじゃん。というかヘルプコマンドナいと思ったら、helpの引数にコマンドを渡す形式だったんか。go installしてみる。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ go \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e github.com/chromedp/cdproto-gen\n\ngo \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e github.com/chromedp/cdproto-gen\ngo: \u003cspan class=\"token string\"\u003e'go install'\u003c/span\u003e requires a version when current directory is not \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e a module\n\tTry \u003cspan class=\"token string\"\u003e'go install github.com/chromedp/cdproto-gen@latest'\u003c/span\u003e to \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e the latest version\n\n$ go \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e github.com/chromedp/cdproto-gen@latest\n\ngo: downloading github.com/chromedp/cdproto-gen v0.0.0-20200709115207-99c9ca13bbae\ngo: downloading github.com/mailru/easyjson v0.7.2-0.20200524104011-8ba3c7bdceed\ngo: downloading github.com/ryanuber/go-glob v1.0.0\ngo: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a\ngo: downloading golang.org/x/tools v0.0.0-20200606014950-c42cb6316fb6\ngo: downloading github.com/valyala/quicktemplate v1.5.0\ngo: downloading github.com/client9/misspell v0.3.4\ngo: downloading github.com/knq/snaker v0.0.0-20181215144011-2bc8a4db4687\ngo: downloading github.com/Masterminds/semver v1.5.0\ngo: downloading github.com/PuerkitoBio/goquery v1.5.1\ngo: downloading golang.org/x/net v0.0.0-20200602114024-627f9648deb9\ngo: downloading github.com/andybalholm/cascadia v1.2.0\ngo: downloading github.com/valyala/bytebufferpool v1.0.0\ngo: downloading golang.org/x/mod v0.2.0\ngo: downloading golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこれでダウンロード完了した。みたい。次にREADMEのUsingのセクション。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecdproto-gen\u003c/code\u003eで動くそうな。これも動かしてみるか。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ cdproto-gen\nzsh: \u003cspan class=\"token builtin class-name\"\u003ecommand\u003c/span\u003e not found: cdproto-gen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eまあPATHが通ってないんでしょうね。一旦Goのファイルがどこに落ちているのか調べる。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-Compile_and_install_packages_and_dependencies\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eExecutables are installed in the directory named by the GOBIN environment variable, which defaults to $GOPATH/bin or $HOME/go/bin if the GOPATH environment variable is not set. Executables in $GOROOT are installed in $GOROOT/bin or $GOTOOLDIR instead of $GOBIN.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$GOROOT\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$GOBIN\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$GOPATH\u003c/span\u003e\n\n\n$ \u003cspan class=\"token function\"\u003els\u003c/span\u003e ~/go/bin\ncdproto-gen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eなるほど、ここにあるけどPATHが通ってないので、ということなのか。これGOPATHとか設定した方がいいのかな？もう少し公式ドキュメントを読み進める。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ego install\u003c/code\u003e自体のドキュメントにはなさそうなので、環境年数のドキュメントに飛びたい。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-GOPATH_environment_variable\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-GOPATH_and_Modules\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fcmd%2Fgo%23hdr-Legacy_GOPATH_go_get\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eOverviewをみる限りだとここら辺かな？\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ go \u003cspan class=\"token function\"\u003eenv\u003c/span\u003e GOPATH\n~/go\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eインストール先と挙動はあっていそうなので単純にGOPATHへのPATHを通せば良さそう。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# .zshrc\u003c/span\u003e\n\u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003eGOPATH\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token environment constant\"\u003e$HOME\u003c/span\u003e/go\n\u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003eGOBIN\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$GOPATH\u003c/span\u003e/bin\n\u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e \u003cspan class=\"token assign-left variable\"\u003e\u003cspan class=\"token environment constant\"\u003ePATH\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token environment constant\"\u003e$PATH\u003c/span\u003e\u003cspan class=\"token builtin class-name\"\u003e:\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$GOBIN\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ecdproto-gen \u003cspan class=\"token parameter variable\"\u003e--help\u003c/span\u003e\nUsage of cdproto-gen:\n  \u003cspan class=\"token parameter variable\"\u003e-cache\u003c/span\u003e string\n    \tprotocol cache directory\n  \u003cspan class=\"token parameter variable\"\u003e-chromium\u003c/span\u003e string\n    \tchromium protocol version\n  \u003cspan class=\"token parameter variable\"\u003e-debug\u003c/span\u003e\n    \ttoggle debug \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewrites generated files to disk without post-processing\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  -go-pkg string\n    \tgo base package name \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edefault \u003cspan class=\"token string\"\u003e\"github.com/chromedp/cdproto\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  -go-wl string\n    \tcomma-separated list of files to whitelist \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eignore\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edefault \u003cspan class=\"token string\"\u003e\"LICENSE,README.md,*.pdl,go.mod,go.sum,easyjson.go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token parameter variable\"\u003e-latest\u003c/span\u003e\n    \tuse latest protocol\n  -no-clean\n    \ttoggle not cleaning \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eremoving\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e existing directories\n  -no-dump\n    \ttoggle not dumping generated protocol \u003cspan class=\"token function\"\u003efile\u003c/span\u003e to out directory\n  \u003cspan class=\"token parameter variable\"\u003e-out\u003c/span\u003e string\n    \tpackage out directory\n  \u003cspan class=\"token parameter variable\"\u003e-pdl\u003c/span\u003e string\n    \tpath to pdl \u003cspan class=\"token function\"\u003efile\u003c/span\u003e to use\n  \u003cspan class=\"token parameter variable\"\u003e-ttl\u003c/span\u003e duration\n    \t\u003cspan class=\"token function\"\u003efile\u003c/span\u003e retrieval caching ttl \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edefault 24h0m0s\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token parameter variable\"\u003e-v8\u003c/span\u003e string\n    \tv8 protocol version\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e認識されたようだ。一旦休憩\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T06:39:27Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221479502","id":1221479502,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5IzkxO","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221479502/reactions"},"updated_at":"2022-08-21T06:39:27Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221479502","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"では実際に動かして、何をしているのかみてみるところから再開。\n\n```bash\n$ cdproto-gen\n\n# 一部だけ抜粋\npanic: could not resolve type cdp.compatibilitymode in domain cdp\n```\n\nなんかとりあえずpanicになってそう笑\n\nコマンドの実行履歴的に、`~/Library/Caches/cdproto-gen`あたりに何かを生成していそうなのでみてみる。\n\n```bash\nLibrary/Caches/cdproto-gen\n❯ la\ntotal 0\ndrwxr-xr-x    6 ikuma  staff   192  8 21 16:02 .\ndrwx------+ 129 ikuma  staff  4128  8 21 16:02 ..\ndrwxr-xr-x    3 ikuma  staff    96  8 21 16:02 deps\ndrwxr-xr-x    3 ikuma  staff    96  8 21 16:02 html\ndrwxr-xr-x    5 ikuma  staff   160  8 21 16:02 pdl\ndrwxr-xr-x    3 ikuma  staff    96  8 21 16:02 refs\n```\n\nお〜！できてる。\n\n無難にhtmlから開いてみるか。\n\n内容はREADMEにあるとおり、以下のサイトのものっぽい。\n\nhttps://chromium.googlesource.com/chromium/src.git\n\nこのサイト自体は、gitliesというツールで作られているようです。\n\nhttps://gerrit.googlesource.com/gitiles/\n\nそのほかもみてみるか。次にpdl。\n\nchromium/107.0.5252.1.pdl と同じように、combinedとv8のpdlが格納されている。\n\nここまでの動作から、grab.goでこの取得処理をしていることがわかる。\n\nhttps://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go\n\nたぶん情報の取得処理自体は完了していて、そこから何か仕様にもなにかがよくなくてエラーになっている。エラーメッセージに戻る。\n\nPanic自体はGoにおける例外処理的な仕組みなのかな？\n\nhttps://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/\n\n公式読まないでごめんだけど、雰囲気掴むために日本語ブログ読む。\n\n\u003e panicは、コールされるとプログラムが終了するビルトイン関数の事です。\n\nなるほど。で、実際にpanicを呼び出しているのはここだ。\n\nhttps://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143\n\n大元はここ\n\nhttps://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233\n\nめちゃくちゃ一つの関数長いじゃんか...。でも読まなきゃわからんので読む。\n","bodyHTML":"\u003cp\u003eでは実際に動かして、何をしているのかみてみるところから再開。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ cdproto-gen\n\n\u003cspan class=\"token comment\"\u003e# 一部だけ抜粋\u003c/span\u003e\npanic: could not resolve \u003cspan class=\"token builtin class-name\"\u003etype\u003c/span\u003e cdp.compatibilitymode \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e domain cdp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eなんかとりあえずpanicになってそう笑\u003c/p\u003e\n\u003cp\u003eコマンドの実行履歴的に、\u003ccode\u003e~/Library/Caches/cdproto-gen\u003c/code\u003eあたりに何かを生成していそうなのでみてみる。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eLibrary/Caches/cdproto-gen\n❯ la\ntotal \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\ndrwxr-xr-x    \u003cspan class=\"token number\"\u003e6\u003c/span\u003e ikuma  staff   \u003cspan class=\"token number\"\u003e192\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 \u003cspan class=\"token builtin class-name\"\u003e.\u003c/span\u003e\ndrwx------+ \u003cspan class=\"token number\"\u003e129\u003c/span\u003e ikuma  staff  \u003cspan class=\"token number\"\u003e4128\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 \u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e\ndrwxr-xr-x    \u003cspan class=\"token number\"\u003e3\u003c/span\u003e ikuma  staff    \u003cspan class=\"token number\"\u003e96\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 deps\ndrwxr-xr-x    \u003cspan class=\"token number\"\u003e3\u003c/span\u003e ikuma  staff    \u003cspan class=\"token number\"\u003e96\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 html\ndrwxr-xr-x    \u003cspan class=\"token number\"\u003e5\u003c/span\u003e ikuma  staff   \u003cspan class=\"token number\"\u003e160\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 pdl\ndrwxr-xr-x    \u003cspan class=\"token number\"\u003e3\u003c/span\u003e ikuma  staff    \u003cspan class=\"token number\"\u003e96\u003c/span\u003e  \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token number\"\u003e21\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e:02 refs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eお〜！できてる。\u003c/p\u003e\n\u003cp\u003e無難にhtmlから開いてみるか。\u003c/p\u003e\n\u003cp\u003e内容はREADMEにあるとおり、以下のサイトのものっぽい。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fchromium.googlesource.com%2Fchromium%2Fsrc.git\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://chromium.googlesource.com/chromium/src.git\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://chromium.googlesource.com/chromium/src.git\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこのサイト自体は、gitliesというツールで作られているようです。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgerrit.googlesource.com%2Fgitiles%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://gerrit.googlesource.com/gitiles/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://gerrit.googlesource.com/gitiles/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eそのほかもみてみるか。次にpdl。\u003c/p\u003e\n\u003cp\u003echromium/107.0.5252.1.pdl と同じように、combinedとv8のpdlが格納されている。\u003c/p\u003e\n\u003cp\u003eここまでの動作から、grab.goでこの取得処理をしていることがわかる。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F73b2ad0f16066348aa47151b49d11ec51c7e531a%2Fgrab.go\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eたぶん情報の取得処理自体は完了していて、そこから何か仕様にもなにかがよくなくてエラーになっている。エラーメッセージに戻る。\u003c/p\u003e\n\u003cp\u003ePanic自体はGoにおける例外処理的な仕組みなのかな？\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fmoneyforward.com%2Fengineers_blog%2F2020%2F09%2F09%2Fgoroutine-panic-handling%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e公式読まないでごめんだけど、雰囲気掴むために日本語ブログ読む。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003epanicは、コールされるとプログラムが終了するビルトイン関数の事です。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eなるほど。で、実際にpanicを呼び出しているのはここだ。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F5017836d2c839513555503c7fbbd884daafdf467%2Fgen%2Fgotpl%2Futil.go%23L143\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e大元はここ\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F99c9ca13bbaef6b33dec6d46e232ce22367fc1a7%2Fmain.go%23L233\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eめちゃくちゃ一つの関数長いじゃんか...。でも読まなきゃわからんので読む。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T07:46:56Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221491767","id":1221491767,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5Iznw3","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221491767/reactions"},"updated_at":"2022-08-21T07:46:56Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221491767","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"え〜と、`*`はポインタを指しているでいいんだよね。\n\n```go\nvar (\n    flagCache = flag.String(\"cache\", \"\", \"protocol cache directory\")\n)\n```\n\n最初にここで宣言している。flagは標準のpackageで、コマンドラインで渡されるフラグをパースできるやつだそう。\n\nhttps://pkg.go.dev/flag\n\n```bash\n$ cdproto-gen --help\n\nUsage of cdproto-gen:\n  -cache string\n        protocol cache directory\n```\n\nOptionParserみたいなものか。指定がなければ、osのUserCacheDirを使うみたい。osはGo本体に含まれているみたい。\n\n続いて、取得対象のChromiumのバージョンを取得しているんだけど、これどういう意味かぱっと見でわからんな。\n\n```go\nif *flagChromium, err = util.GetLatestVersion(util.Cache{\n    URL:  util.ChromiumBase,\n    Path: filepath.Join(*flagCache, \"html\", \"chromium.html\"),\n    TTL:  *flagTTL,\n}); err != nil {\n    return err\n}\n```\n\nif文の条件のところで定義できるってやるだと思うんだけど...\n\n```go\n*flagChromium, err = util.GetLatestVersion(util.Cache{\n    URL:  util.ChromiumBase,\n    Path: filepath.Join(*flagCache, \"html\", \"chromium.html\"),\n    TTL:  *flagTTL,\n});\n```\n\nここまでがたぶん代入のところだよね。ようはutilityとして定義した関数がerrを返さなければOKということでしょう。\n\n同様にパラメータの定義が進んでいき、続いてプロトコル定義のロードっぽいです。\n","bodyHTML":"\u003cp\u003eえ〜と、\u003ccode\u003e*\u003c/code\u003eはポインタを指しているでいいんだよね。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    flagCache \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e flag\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"cache\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"protocol cache directory\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e最初にここで宣言している。flagは標準のpackageで、コマンドラインで渡されるフラグをパースできるやつだそう。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Fflag\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/flag\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/flag\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ cdproto-gen \u003cspan class=\"token parameter variable\"\u003e--help\u003c/span\u003e\n\nUsage of cdproto-gen:\n  \u003cspan class=\"token parameter variable\"\u003e-cache\u003c/span\u003e string\n        protocol cache directory\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOptionParserみたいなものか。指定がなければ、osのUserCacheDirを使うみたい。osはGo本体に含まれているみたい。\u003c/p\u003e\n\u003cp\u003e続いて、取得対象のChromiumのバージョンを取得しているんだけど、これどういう意味かぱっと見でわからんな。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagChromium\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e util\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetLatestVersion\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCache\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    URL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e  util\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eChromiumBase\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    Path\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e filepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagCache\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"chromium.html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    TTL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e  \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagTTL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e err\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eif文の条件のところで定義できるってやるだと思うんだけど...\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagChromium\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e util\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetLatestVersion\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCache\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    URL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e  util\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eChromiumBase\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    Path\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e filepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagCache\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"chromium.html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    TTL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e  \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagTTL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eここまでがたぶん代入のところだよね。ようはutilityとして定義した関数がerrを返さなければOKということでしょう。\u003c/p\u003e\n\u003cp\u003e同様にパラメータの定義が進んでいき、続いてプロトコル定義のロードっぽいです。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T08:09:07Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221495140","id":1221495140,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5Izolk","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221495140/reactions"},"updated_at":"2022-08-21T08:09:07Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221495140","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133\n\n```go\nfunc loadProtoDefs() (*pdl.PDL, error) {\n\tvar err error\n\n\tif *flagPdl != \"\" {\n\t\tutil.Logf(\"PROTOCOL: %s\", *flagPdl)\n\t\tbuf, err := ioutil.ReadFile(*flagPdl)\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\treturn pdl.Parse(buf)\n\t}\n\n\tvar protoDefs []*pdl.PDL\n\tload := func(urlstr, typ, ver string) error {\n\t\tbuf, err := util.Get(util.Cache{\n\t\t\tURL:    fmt.Sprintf(urlstr+\"?format=TEXT\", ver),\n\t\t\tPath:   filepath.Join(*flagCache, \"pdl\", typ, ver+\".pdl\"),\n\t\t\tTTL:    *flagTTL,\n\t\t\tDecode: true,\n\t\t})\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\t// parse\n\t\tprotoDef, err := pdl.Parse(buf)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tprotoDefs = append(protoDefs, protoDef)\n\t\treturn nil\n\t}\n\n\t// grab browser + js definition\n\tif err = load(util.ChromiumURL, \"chromium\", *flagChromium); err != nil {\n\t\treturn nil, err\n\t}\n\tif err = load(util.V8URL, \"v8\", *flagV8); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// grab har definition\n\thar, err := pdl.Parse([]byte(pdl.HAR))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn pdl.Combine(append(protoDefs, har)...), nil\n}\n```\n\nGoには組み込みのerror型がある\n\n```go\ntype error interface {\n    Error() string\n}\n```\n\npdlを引数として渡した場合は、渡したpdlをパースして終了。\n\n```go\nvar protoDefs []*pdl.PDL\n```\n\nこういうのもスラスラ読めないの辛いな。え〜と、`var`で変数宣言なので、`protoDefs`という変数を宣言している。後ろにあるのが型なので、`[]*pdl.PDL`型ってことかな。\n\nで、`[]`はスライスで、`*pdl.PDL`はポインタなので、この長さを持ったスライス？\n\n長さは関係なかった。`pdl.PDL`は次の定義となっている\n\n```go\ntype PDL struct { \n    // Copyright is the file copyright.\n    Copyright string\n\n    // Version is the file version information.\n    Version *Version\n\n    // Domains are the available domains.\n    Domains []*Domain\n}\n```\n\nあれ、関数の宣言で引数の型を省略したらGoではどうなるの？あ〜、2つ以上の引数の型が同じ梅は、最後の型を省略して記述できる。\n\n---\n\n処理の大枠の流れとしては、\n\n1. 取得したPDLファイルを読み込む\n2. 読み込んだPDLをParseして、protoDefという変数に突っ込んであげる\n\nって感じ。ポインタが謎すぎる。で、関数はファーストクラスファンクションなので、この処理を`load`として動的に定義してあげる。そっか、ここで関数として切り出さないんだな。`protoDef`をこの関数全体のコンテキストで共有していて、それに依存するし、関数化したい思ったのは、あくまで2回出てくるからくらいなので、ここで定義しているって感じか。\n\nソースをみている感じ、PDLの中にHARの定義も書いてあって、これも読み取っている。\n\nで、最終的に\n\n```go\nreturn pdl.Combine(append(protoDefs, har)...), nil\n```\n\nってやっているんだけど、これ何？特に`...`\n","bodyHTML":"\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2F99c9ca13bbaef6b33dec6d46e232ce22367fc1a7%2Fmain.go%23L133\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003eloadProtoDefs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePDL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e err \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e\n\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagPdl \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\tutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLogf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"PROTOCOL: %s\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagPdl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\tbuf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e ioutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eReadFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagPdl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e pdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e protoDefs \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePDL\n\tload \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurlstr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e typ\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ver \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\tbuf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e util\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGet\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCache\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\tURL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e    fmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSprintf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurlstr\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"?format=TEXT\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ver\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\tPath\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e   filepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagCache\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pdl\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e typ\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ver\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".pdl\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\tTTL\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e    \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagTTL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\tDecode\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e err\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\t\u003cspan class=\"token comment\"\u003e// parse\u003c/span\u003e\n\t\tprotoDef\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e pdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e err\n\t\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\tprotoDefs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotoDefs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e protoDef\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// grab browser + js definition\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eload\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eChromiumURL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"chromium\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagChromium\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eload\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eV8URL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"v8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eflagV8\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// grab har definition\u003c/span\u003e\n\thar\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e pdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token function\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eHAR\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e err\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e pdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCombine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotoDefs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e har\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eGoには組み込みのerror型がある\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epdlを引数として渡した場合は、渡したpdlをパースして終了。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e protoDefs \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePDL\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこういうのもスラスラ読めないの辛いな。え〜と、\u003ccode\u003evar\u003c/code\u003eで変数宣言なので、\u003ccode\u003eprotoDefs\u003c/code\u003eという変数を宣言している。後ろにあるのが型なので、\u003ccode\u003e[]*pdl.PDL\u003c/code\u003e型ってことかな。\u003c/p\u003e\n\u003cp\u003eで、\u003ccode\u003e[]\u003c/code\u003eはスライスで、\u003ccode\u003e*pdl.PDL\u003c/code\u003eはポインタなので、この長さを持ったスライス？\u003c/p\u003e\n\u003cp\u003e長さは関係なかった。\u003ccode\u003epdl.PDL\u003c/code\u003eは次の定義となっている\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e PDL \u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"token comment\"\u003e// Copyright is the file copyright.\u003c/span\u003e\n    Copyright \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// Version is the file version information.\u003c/span\u003e\n    Version \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eVersion\n\n    \u003cspan class=\"token comment\"\u003e// Domains are the available domains.\u003c/span\u003e\n    Domains \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eDomain\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eあれ、関数の宣言で引数の型を省略したらGoではどうなるの？あ〜、2つ以上の引数の型が同じ梅は、最後の型を省略して記述できる。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e処理の大枠の流れとしては、\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e取得したPDLファイルを読み込む\u003c/li\u003e\n\u003cli\u003e読み込んだPDLをParseして、protoDefという変数に突っ込んであげる\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eって感じ。ポインタが謎すぎる。で、関数はファーストクラスファンクションなので、この処理を\u003ccode\u003eload\u003c/code\u003eとして動的に定義してあげる。そっか、ここで関数として切り出さないんだな。\u003ccode\u003eprotoDef\u003c/code\u003eをこの関数全体のコンテキストで共有していて、それに依存するし、関数化したい思ったのは、あくまで2回出てくるからくらいなので、ここで定義しているって感じか。\u003c/p\u003e\n\u003cp\u003eソースをみている感じ、PDLの中にHARの定義も書いてあって、これも読み取っている。\u003c/p\u003e\n\u003cp\u003eで、最終的に\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e pdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCombine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotoDefs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e har\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eってやっているんだけど、これ何？特に\u003ccode\u003e...\u003c/code\u003e\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T11:29:29Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221526862","id":1221526862,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5IzwVO","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221526862/reactions"},"updated_at":"2022-08-21T11:29:29Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221526862","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"一旦調査に時間がかかりすぎる部分は置いておいて、残りをみてみることにする。\n\nまた`main.run`に戻って来た。\n\n`loadProtoDefs`を用いて、PDLの情報を`protoDefs`に代入する。\n\n`sort.Slice`: これは標準っぽい。\n\nhttps://qiita.com/Sekky0905/items/2d5ccd6d076106e9d21c\n\n- ソートには安定ソートという概念がある。\n- sort packageのSliceは安定ソートを保証せず、SliceStableは安定ソートを保する\n\n第2引数に関数を渡しているけど、一般的にいえばこの関数で比較してソートしてそう。\n\n```go\nsort.Slice(protoDefs.Domains, func(i, j int) bool {\nreturn strings.Compare(protoDefs.Domains[i].Domain.String(), protoDefs.Domains[j].Domain.String()) \u003c= 0\n})\n```\n\nで、この後にフォルダを作成して、どんどん書き込んでいく。\n\n```go\nif d.Deprecated {\n\tvar extra []string\n\textra = append(extra, \"deprecated\")\n\tutil.Logf(\"SKIPPING(%s): %s %v\", pad(\"domain\", 7), d.Domain.String(), extra)\n\tcontinue\n}\n```\n\nで、どうもDeprecatedなものがあれば、スキップされているみたい。\n\nこのあとREADMEにもあった、`fixup`処理をやっているんだけど、これはなに？\n\n```go\n// fixup\nfixup.FixDomains(processed)\n```\n\npdlgen/fixup/fixup.goに飛んだ。コメントには何が書いてある？\n\n```go\n// FixDomains modifies, updates, alters, fixes, and adds to the types defined\n// in the domains, so that the generated Chrome DevTools Protocol domain code\n// is more Go-like and easier to use.\n//\n// Please see package-level documentation for the list of changes made to the\n// various domains.\nfunc FixDomains(domains []*pdl.Domain) {\n```\n\nってことで、Packageのドキュメントをみてみる。\n\n```go\n// Package fixup modifies/alters/fixes and adds to the low level type\n// definitions for the Chrome DevTools Protocol domains, as generated from\n// protocol.json.\n//\n// The goal of package fixup is to fix the issues associated with generating Go\n// code from the existing Chrome domain definitions, and is wrapped up in one\n// high-level func, FixDomains.\n//\n// Currently, FixDomains does the following:\n//  - add `Inspector.DetachReason` type and change `Inspector.detached.reason`\n//    type to `Inspector.DetachReason`.\n//  - change `Network.TimeSinceEpoch`, `Network.MonotonicTime`, and\n//    `Runtime.Timestamp` types to `TimestampTypeSecond` and\n//    `TimestampTypeMonotonic`.\n//  - convert all object properties and event/command parameters that are enums\n//    into separate types.\n//  - change any object property named `modifiers` to type `Input.Modifier`.\n//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to\n//    `DOM.NodeType`.\n//  - change `Page.Frame.{id,parentID}` property named `modifiers` to type `Input.Modifier`.\n//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to\n//    `DOM.NodeType`.\n//  - change `Page.Frame.{id,parentID}` properties to `FrameID` type.\n//  - add additional properties to `Page.Frame` and `DOM.Node` for use by\n//    higher level packages.\n//  - add special unmarshaler to `Page.{NodeId,BackendNodeId,FrameId}` types to\n//    handle unquoted values from older (v1.1) protocol versions. NOTE: it may\n//    be necessary in the future to apply this to more types, such as\n//    `Network.LoaderId`.\n//  - rename `Input.GestureSourceType` to `Input.GestureType`.\n//  - fix type/name stuttering by stripping the package name from any type\n//    where the package name is a prefix (ie, `CSS` domain).\n//  - add Error() method to `Runtime.ExceptionDetails` so that it can be used\n//    as error.\n//  - change `Network.Headers` type to map[string]interface{}.\n//\n// Please note that the above is not an exhaustive list of all modifications\n// applied to the domains, however it does attempt \n```\n\n細かいことは「Currently, ...」以下にまとめられているけど、CDPのプロトコルから、GoLikeな感じでコードを生成するために必要な情報を付与している。\nあと備忘として、ここにある情報だけがやっていることの全てではないことに注意。\n\nこれRubyでやるときにどうするかなあ。RBSでやってもいいけど、実装時間が足りないかんじするよな。\n\n","bodyHTML":"\u003cp\u003e一旦調査に時間がかかりすぎる部分は置いておいて、残りをみてみることにする。\u003c/p\u003e\n\u003cp\u003eまた\u003ccode\u003emain.run\u003c/code\u003eに戻って来た。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eloadProtoDefs\u003c/code\u003eを用いて、PDLの情報を\u003ccode\u003eprotoDefs\u003c/code\u003eに代入する。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003esort.Slice\u003c/code\u003e: これは標準っぽい。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2FSekky0905%2Fitems%2F2d5ccd6d076106e9d21c\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://qiita.com/Sekky0905/items/2d5ccd6d076106e9d21c\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://qiita.com/Sekky0905/items/2d5ccd6d076106e9d21c\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eソートには安定ソートという概念がある。\u003c/li\u003e\n\u003cli\u003esort packageのSliceは安定ソートを保証せず、SliceStableは安定ソートを保する\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e第2引数に関数を渡しているけど、一般的にいえばこの関数で比較してソートしてそう。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003esort\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSlice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotoDefs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomains\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e j \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebool\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e strings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCompare\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotoDefs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomains\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e protoDefs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomains\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ej\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eで、この後にフォルダを作成して、どんどん書き込んでいく。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDeprecated \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e extra \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\n\textra \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eextra\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"deprecated\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLogf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SKIPPING(%s): %s %v\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003epad\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"domain\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e7\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e extra\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003econtinue\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eで、どうもDeprecatedなものがあれば、スキップされているみたい。\u003c/p\u003e\n\u003cp\u003eこのあとREADMEにもあった、\u003ccode\u003efixup\u003c/code\u003e処理をやっているんだけど、これはなに？\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// fixup\u003c/span\u003e\nfixup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFixDomains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprocessed\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epdlgen/fixup/fixup.goに飛んだ。コメントには何が書いてある？\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// FixDomains modifies, updates, alters, fixes, and adds to the types defined\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// in the domains, so that the generated Chrome DevTools Protocol domain code\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// is more Go-like and easier to use.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Please see package-level documentation for the list of changes made to the\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// various domains.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003eFixDomains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edomains \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eってことで、Packageのドキュメントをみてみる。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// Package fixup modifies/alters/fixes and adds to the low level type\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// definitions for the Chrome DevTools Protocol domains, as generated from\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// protocol.json.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// The goal of package fixup is to fix the issues associated with generating Go\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// code from the existing Chrome domain definitions, and is wrapped up in one\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// high-level func, FixDomains.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Currently, FixDomains does the following:\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add `Inspector.DetachReason` type and change `Inspector.detached.reason`\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    type to `Inspector.DetachReason`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - change `Network.TimeSinceEpoch`, `Network.MonotonicTime`, and\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    `Runtime.Timestamp` types to `TimestampTypeSecond` and\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    `TimestampTypeMonotonic`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - convert all object properties and event/command parameters that are enums\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    into separate types.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - change any object property named `modifiers` to type `Input.Modifier`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    `DOM.NodeType`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - change `Page.Frame.{id,parentID}` property named `modifiers` to type `Input.Modifier`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add `DOM.NodeType` type and set any parameter named `nodeType`'s type to\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    `DOM.NodeType`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - change `Page.Frame.{id,parentID}` properties to `FrameID` type.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add additional properties to `Page.Frame` and `DOM.Node` for use by\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    higher level packages.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add special unmarshaler to `Page.{NodeId,BackendNodeId,FrameId}` types to\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    handle unquoted values from older (v1.1) protocol versions. NOTE: it may\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    be necessary in the future to apply this to more types, such as\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    `Network.LoaderId`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - rename `Input.GestureSourceType` to `Input.GestureType`.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - fix type/name stuttering by stripping the package name from any type\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    where the package name is a prefix (ie, `CSS` domain).\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - add Error() method to `Runtime.ExceptionDetails` so that it can be used\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//    as error.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//  - change `Network.Headers` type to map[string]interface{}.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Please note that the above is not an exhaustive list of all modifications\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// applied to the domains, however it does attempt \u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e細かいことは「Currently, ...」以下にまとめられているけど、CDPのプロトコルから、GoLikeな感じでコードを生成するために必要な情報を付与している。\u003cbr\u003e\nあと備忘として、ここにある情報だけがやっていることの全てではないことに注意。\u003c/p\u003e\n\u003cp\u003eこれRubyでやるときにどうするかなあ。RBSでやってもいいけど、実装時間が足りないかんじするよな。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T11:50:38Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221530113","id":1221530113,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5IzxIB","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221530113/reactions"},"updated_at":"2022-08-21T11:50:38Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221530113","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"で、次にgeneratorの生成をやっている。\n\n```go\ngenerator := gen.Generators()[\"go\"]\nif generator == nil {\n\treturn errors.New(\"no generator\")\n}\n```\n\n`gen.Generators()`の中身はこうなっている。\n\n```go\ntype Generator func([]*pdl.Domain, string) (Emitter, error)\n\n// Generators returns all the various Chrome DevTools Protocol generators.\nfunc Generators() map[string]Generator {\n\treturn map[string]Generator{\n\t\t\"go\": NewGoGenerator,\n\t}\n}\n```\n\nいまいちこの`type`による関数定義が何をしているのかよくわかっていない。\n\nhttps://qiita.com/tenntenn/items/45c568d43e950292bc31\n\n\u003e typeという予約語を用いると、既存の型や型リテラルに別名をつけることができます\n\nあ〜、この記事で一番大事なのはここだ\n\n\u003e typeやメソッドが構造体ありきで学習していくと、後々、http.HandlerFuncなどに出くわしたときに、きちんと理解できず、「おまじない」になってしまいがちです。言語仕様をきちんと読み、普段なんとなく書いている記述が文法上どのように定義されているのか理解することで、今まできちんと理解してなかった概念や知らなかった概念を知る機会になります。Goの言語仕様は、そんなに長くなく、少しずつ読んでいけばちゃんと読める量なので、ぜひ読んでみることをオススメします。英語が厳しい方は、文法を定義したBNFを斜め読みするだけでも十分効果はあると思います。\n\nとりあえずこの部分については、`([]*pdl.Domain, string)`を引数に取り、`(Emitter, error)`を戻り値として返す関数を`Generator`という名前の型として定義しますよ、ってことだ。\n\nで、このEmitterについては直後に定義があって、\n\n```go\ntype Emitter interface {\n\tEmit() map[string]*bytes.Buffer\n}\n```\n\nで、元に戻って、`NewGoGenerator`は何かという話。\n\n```go\nfunc Generators() map[string]Generator {\n\treturn map[string]Generator{\n\t\t\"go\": NewGoGenerator,\n\t}\n}\n```\n\nこれは`pdlgen/gen/gogen.go`に定義されている。ここが核であり、おそらくこの生成結果によって、後ちょっとでpanicになる。`\n","bodyHTML":"\u003cp\u003eで、次にgeneratorの生成をやっている。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003egenerator \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e gen\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGenerators\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e generator \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e errors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"no generator\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003egen.Generators()\u003c/code\u003eの中身はこうなっている。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e Generator \u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEmitter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Generators returns all the various Chrome DevTools Protocol generators.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003eGenerators\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003eGenerator \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003eGenerator\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token string\"\u003e\"go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e NewGoGenerator\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eいまいちこの\u003ccode\u003etype\u003c/code\u003eによる関数定義が何をしているのかよくわかっていない。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Ftenntenn%2Fitems%2F45c568d43e950292bc31\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://qiita.com/tenntenn/items/45c568d43e950292bc31\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://qiita.com/tenntenn/items/45c568d43e950292bc31\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etypeという予約語を用いると、既存の型や型リテラルに別名をつけることができます\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eあ〜、この記事で一番大事なのはここだ\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etypeやメソッドが構造体ありきで学習していくと、後々、http.HandlerFuncなどに出くわしたときに、きちんと理解できず、「おまじない」になってしまいがちです。言語仕様をきちんと読み、普段なんとなく書いている記述が文法上どのように定義されているのか理解することで、今まできちんと理解してなかった概念や知らなかった概念を知る機会になります。Goの言語仕様は、そんなに長くなく、少しずつ読んでいけばちゃんと読める量なので、ぜひ読んでみることをオススメします。英語が厳しい方は、文法を定義したBNFを斜め読みするだけでも十分効果はあると思います。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eとりあえずこの部分については、\u003ccode\u003e([]*pdl.Domain, string)\u003c/code\u003eを引数に取り、\u003ccode\u003e(Emitter, error)\u003c/code\u003eを戻り値として返す関数を\u003ccode\u003eGenerator\u003c/code\u003eという名前の型として定義しますよ、ってことだ。\u003c/p\u003e\n\u003cp\u003eで、このEmitterについては直後に定義があって、\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e Emitter \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003eEmit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003ebytes\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBuffer\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eで、元に戻って、\u003ccode\u003eNewGoGenerator\u003c/code\u003eは何かという話。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003eGenerators\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003eGenerator \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003eGenerator\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token string\"\u003e\"go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e NewGoGenerator\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこれは\u003ccode\u003epdlgen/gen/gogen.go\u003c/code\u003eに定義されている。ここが核であり、おそらくこの生成結果によって、後ちょっとでpanicになる。`\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T12:14:46Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221533990","id":1221533990,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5IzyEm","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221533990/reactions"},"updated_at":"2022-08-21T12:14:46Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221533990","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"```go\n// NewGoGenerator creates a Go source code generator for the Chrome DevTools\n// Protocol domain definitions.\nfunc NewGoGenerator(domains []*pdl.Domain, basePkg string) (Emitter, error) {\n\tvar w *qtpl.Writer\n```\n\n冒頭に`qtpl`という意味のわからない文字列が出てくるけど、これは`quicktemplate`というGoのテンプレートエンジンだそう。\n\nhttps://github.com/valyala/quicktemplate\n\n\u003e A fast, powerful, yet easy to use template engine for Go. Inspired by the Mako templates philosophy.\n\nで、このquicktemplateはPythonの`Mako templates`の哲学に影響を受けているんだと。\n\nhttps://www.makotemplates.org/\n\nなんかerbみたいな感じがするな。というわけでRubyに戻る\n\nhttps://magazine.rubyist.net/articles/0024/0024-TemplateSystem.html\n\nこの感じだとどうもHTML（というかそれに近いもの）を出力しそうな感じだけど、最終成果物はどうなるんだろう？\nGoに戻ろう。\n\n```go\n// generate individual domains\nfor _, d := range domains {\n\tpkgName := genutil.PackageName(d)\n\tpkgOut := filepath.Join(pkgName, pkgName+\".go\")\n\n\t// do command template\n\tw = fb.get(pkgOut, pkgName, d, domains, basePkg)\n\tgotpl.StreamDomainTemplate(w, d, domains)\n\tfb.release(w)\n\n\t// generate domain types\n\tif len(d.Types) != 0 {\n\t\tfb.generateTypes(\n\t\t\tfilepath.Join(pkgName, \"types.go\"),\n\t\t\td.Types, gotpl.TypePrefix, gotpl.TypeSuffix,\n\t\t\td, domains,\n\t\t\tbasePkg,\n\t\t)\n\t}\n\n\t// generate domain event types\n\tif len(d.Events) != 0 {\n\t\tfb.generateTypes(\n\t\t\tfilepath.Join(pkgName, \"events.go\"),\n\t\t\td.Events, gotpl.EventTypePrefix, gotpl.EventTypeSuffix,\n\t\t\td, domains,\n\t\t\tbasePkg,\n\t\t)\n\t}\n}\n```\n\n次はここみるところから。\n","bodyHTML":"\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// NewGoGenerator creates a Go source code generator for the Chrome DevTools\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Protocol domain definitions.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003eNewGoGenerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edomains \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epdl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDomain\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e basePkg \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEmitter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e w \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eqtpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWriter\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e冒頭に\u003ccode\u003eqtpl\u003c/code\u003eという意味のわからない文字列が出てくるけど、これは\u003ccode\u003equicktemplate\u003c/code\u003eというGoのテンプレートエンジンだそう。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fvalyala%2Fquicktemplate\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/valyala/quicktemplate\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/valyala/quicktemplate\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eA fast, powerful, yet easy to use template engine for Go. Inspired by the Mako templates philosophy.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eで、このquicktemplateはPythonの\u003ccode\u003eMako templates\u003c/code\u003eの哲学に影響を受けているんだと。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fwww.makotemplates.org%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://www.makotemplates.org/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://www.makotemplates.org/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eなんかerbみたいな感じがするな。というわけでRubyに戻る\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fmagazine.rubyist.net%2Farticles%2F0024%2F0024-TemplateSystem.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://magazine.rubyist.net/articles/0024/0024-TemplateSystem.html\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://magazine.rubyist.net/articles/0024/0024-TemplateSystem.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこの感じだとどうもHTML（というかそれに近いもの）を出力しそうな感じだけど、最終成果物はどうなるんだろう？\u003cbr\u003e\nGoに戻ろう。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// generate individual domains\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"token boolean\"\u003e_\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e d \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erange\u003c/span\u003e domains \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\tpkgName \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e genutil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePackageName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ed\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tpkgOut \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e filepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epkgName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pkgName\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// do command template\u003c/span\u003e\n\tw \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e fb\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epkgOut\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pkgName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e domains\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e basePkg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tgotpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eStreamDomainTemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e domains\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tfb\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erelease\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// generate domain types\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token function\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ed\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTypes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\tfb\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egenerateTypes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\t\t\tfilepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epkgName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"types.go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\td\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTypes\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e gotpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTypePrefix\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e gotpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTypeSuffix\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\td\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e domains\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\tbasePkg\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// generate domain event types\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token function\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ed\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eEvents\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\tfb\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egenerateTypes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\t\t\tfilepath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eJoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epkgName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"events.go\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\td\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eEvents\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e gotpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eEventTypePrefix\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e gotpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eEventTypeSuffix\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\td\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e domains\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\tbasePkg\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e次はここみるところから。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-21T13:03:15Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221541868","id":1221541868,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/69","node_id":"IC_kwDOHWTPVs5Izz_s","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221541868/reactions"},"updated_at":"2022-08-21T13:03:15Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221541868","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}}]},"__N_SSG":true},"page":"/articles/[issueNumber]","query":{"issueNumber":"69"},"buildId":"pI6kXhuws7KSwb9qiQWUa","assetPrefix":"/diary","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>