<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>2022-07-01</title><meta name="next-head-count" content="3"/><link rel="preload" href="/diary/_next/static/css/d865616645a7b0fe.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/d865616645a7b0fe.css" data-n-g=""/><link rel="preload" href="/diary/_next/static/css/fc9624fd4a486ef2.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/fc9624fd4a486ef2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/diary/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/diary/_next/static/chunks/webpack-dc4034d98607b727.js" defer=""></script><script src="/diary/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/diary/_next/static/chunks/main-a03413948affdc5e.js" defer=""></script><script src="/diary/_next/static/chunks/pages/_app-5b4d6b2692b4593b.js" defer=""></script><script src="/diary/_next/static/chunks/582-d79da0492f1f9267.js" defer=""></script><script src="/diary/_next/static/chunks/pages/articles/%5BissueNumber%5D-4584e21e841751ac.js" defer=""></script><script src="/diary/_next/static/BmX7TgggyfCHQPWxpUwR3/_buildManifest.js" defer=""></script><script src="/diary/_next/static/BmX7TgggyfCHQPWxpUwR3/_ssgManifest.js" defer=""></script><script src="/diary/_next/static/BmX7TgggyfCHQPWxpUwR3/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><script>window.twttr=(function(f,b,g){var e,c=f.getElementsByTagName(b)[0],a=window.twttr||{};if(f.getElementById(g)){return a}e=f.createElement(b);e.id=g;e.src="https://platform.twitter.com/widgets.js";c.parentNode.insertBefore(e,c);a._e=[];a.ready=function(d){a._e.push(d)};return a}(document,"script","twitter-wjs"));</script><div class="min-h-screen flex flex-col"><header class="relative bg-gradient-to-r from-blue-700 via-blue-800 to-gray-900 md:mb-8"><div class="max-w-6xl mx-auto px-5"><nav class="py-12 md:mb-20 flex items-center justify-between md:px-12 px-2"><div><h1 class="text-white"><a class="text-2xl md:text-3xl tracking-wide font-bold" href="/diary">ikuma-t/diary</a></h1><p class="mt-4 text-sm text-slate-300">ikuma-tの作業ログです。</p></div><div><a class="text-white text-sm" href="https://github.com/IkumaTadokoro/diary/issues">Show on GitHub</a></div></nav></div><svg class="absolute w-full h-20 md:h-full top-32 left-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" preserveAspectRatio="none"><path d="M0 32L24 37.3C48 43 96 53 144 74.7C192 96 240 128 288 122.7C336 117 384 75 432 80C480 85 528 139 576 133.3C624 128 672 64 720 53.3C768 43 816 85 864 90.7C912 96 960 64 1008 48C1056 32 1104 32 1152 58.7C1200 85 1248 139 1296 133.3C1344 128 1392 64 1416 32L1440 0V171H1416C1392 171 1344 171 1296 171C1248 171 1200 171 1152 171C1104 171 1056 171 1008 171C960 171 912 171 864 171C816 171 768 171 720 171C672 171 624 171 576 171C528 171 480 171 432 171C384 171 336 171 288 171C240 171 192 171 144 171C96 171 48 171 24 171H0V32Z" fill="white"></path></svg></header><main class="z-10 flex-1 py-8"><div class="max-w-2xl mx-auto"><article class="znc markdown"><section class="block py-6 md:px-12 px-8 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-01T11:15:13Z" title="2022-07-01T11:15:13Z">2022-07-01 11:07:00</time><h1 class="font-bold text-slate-600">2022-07-01</h1></header><aside><p class="text-sm text-slate-400">Posted by <!-- --> at <!-- --><a href="https://github.com/IkumaTadokoro/diary/issues/48">#48</a>.<!-- --></p></aside><div></div></section><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-01T12:29:12Z" title="2022-07-01T12:29:12Z">2022-07-01 12:07:00</time></header><div><h1 id="typescript%E3%81%A7google-apps-script%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86%EF%BC%81"><a class="header-anchor-link" href="#typescript%E3%81%A7google-apps-script%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86%EF%BC%81" aria-hidden="true" rel="nofollow"></a> TypeScriptでGoogle Apps Scriptを書こう！</h1>
<h2 id="%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%83%E3%83%97"><a class="header-anchor-link" href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%83%E3%83%97" aria-hidden="true" rel="nofollow"></a> とりあえずスクラップ</h2>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkyo9bo%2Farticles%2Fffc0d8b8076052" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/kyo9bo/articles/ffc0d8b8076052" style="display: none">https://zenn.dev/kyo9bo/articles/ffc0d8b8076052</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Ffillz_noh%2Farticles%2Fc6a3a504b0cefc" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/fillz_noh/articles/c6a3a504b0cefc" style="display: none">https://zenn.dev/fillz_noh/articles/c6a3a504b0cefc</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fphi%2Farticles%2Fgoogle-apps-script-snippets" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/phi/articles/google-apps-script-snippets" style="display: none">https://zenn.dev/phi/articles/google-apps-script-snippets</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Foffers%2Farticles%2F20220616-google-app-script-technique" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/offers/articles/20220616-google-app-script-technique" style="display: none">https://zenn.dev/offers/articles/20220616-google-app-script-technique</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fdaria_nicht%2Farticles%2F41c39bb4413db8" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/daria_nicht/articles/41c39bb4413db8" style="display: none">https://zenn.dev/daria_nicht/articles/41c39bb4413db8</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkkenjii%2Farticles%2Fgas-clasp-usage" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/kkenjii/articles/gas-clasp-usage" style="display: none">https://zenn.dev/kkenjii/articles/gas-clasp-usage</a></p>
<p>claspを使って、TypeScriptでGASを書くのが良さそう。</p>
<ul>
<li>自動化の選択肢を広げられると良い。</li>
<li>TypeScriptの練習に使えると良さそう</li>
</ul>
<h2 id="clasp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><a class="header-anchor-link" href="#clasp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B" aria-hidden="true" rel="nofollow"></a> claspを使ってみる</h2>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fgoogle%2Fclasp" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/google/clasp" style="display: none" rel="nofollow">https://github.com/google/clasp</a></p>
<h3 id="%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><a class="header-anchor-link" href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-hidden="true" rel="nofollow"></a> インストール</h3>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i @google/clasp -g
</code></pre></div><h3 id="%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B"><a class="header-anchor-link" href="#%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B" aria-hidden="true" rel="nofollow"></a> ログインする</h3>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ clasp login
Logging <span class="token keyword">in</span> globally…
🔑 Authorize clasp by visiting this url:
https://accounts.google.com/o/oauth2/v2/auth?access_type<span class="token operator">=</span>offline<span class="token operator">&amp;</span><span class="token assign-left variable">scope</span><span class="token operator">=</span>https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.deployments%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.projects%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.webapp.deploy%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.metadata.readonly%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.file%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fservice.management%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Flogging.read%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform<span class="token operator">&amp;</span><span class="token assign-left variable">response_type</span><span class="token operator">=</span>code<span class="token operator">&amp;</span><span class="token assign-left variable">client_id</span><span class="token operator">=</span><span class="token number">1072944905499</span>-vm2v2i5dvn0a0d2o4ca36i1vge8cvbn0.apps.googleusercontent.com<span class="token operator">&amp;</span><span class="token assign-left variable">redirect_uri</span><span class="token operator">=</span>http%3A%2F%2Flocalhost%3A65472

Authorization successful.

Default credentials saved to: /Users/tadokoroikuma/.clasprc.json.
</code></pre></div><h3 id="clasp%E3%81%A7typescript%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><a class="header-anchor-link" href="#clasp%E3%81%A7typescript%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B" aria-hidden="true" rel="nofollow"></a> claspでTypeScriptを使えるようにする</h3>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fgoogle%2Fclasp%2Fblob%2Fmaster%2Fdocs%2Ftypescript.md" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/google/clasp/blob/master/docs/typescript.md" style="display: none" rel="nofollow">https://github.com/google/clasp/blob/master/docs/typescript.md</a></p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> hello-world-clasp
$ <span class="token builtin class-name">cd</span> hello-world-clasp
$ <span class="token function">npm</span> i @types/google-apps-script
$ <span class="token function">vim</span> tsconfig.json
</code></pre></div><div class="code-block-container"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"es2022"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"experimentalDecorators"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><a class="header-anchor-link" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90" aria-hidden="true" rel="nofollow"></a> プロジェクトの作成</h3>
<div class="code-block-container"><pre class=""><code class="">❯ clasp create --help
Usage: clasp create [options]

Create a script

Options:
  --type &lt;type&gt;        Creates a new Apps Script project attached to a new Document, Spreadsheet, Presentation, Form, or as a standalone script, web app, or API.
  --title &lt;title&gt;      The project title.
  --parentId &lt;id&gt;      A project parent Id.
  --rootDir &lt;rootDir&gt;  Local root directory in which clasp will store your project files.
  -h, --help           display help for command

$ clasp create --title &quot;Hello World&quot; --type standalone

$ ls -la
# appscript.jsonが作成される
</code></pre></div><p>TimezoneがAmerica/NewYorkなので、Asia/Tokyoに変更する</p>
<div class="code-block-container"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"timeZone"</span><span class="token operator">:</span> <span class="token string">"Asia/Tokyo"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"exceptionLogging"</span><span class="token operator">:</span> <span class="token string">"STACKDRIVER"</span><span class="token punctuation">,</span>
  <span class="token property">"runtimeVersion"</span><span class="token operator">:</span> <span class="token string">"V8"</span>
<span class="token punctuation">}</span>
~
</code></pre></div><h3 id="hello-world"><a class="header-anchor-link" href="#hello-world" aria-hidden="true" rel="nofollow"></a> Hello World</h3>
<div class="code-block-container"><div class="code-block-filename-container"><span class="code-block-filename">hello.ts</span></div><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">greeter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>person<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function">testGreeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token string">'ikuma'</span><span class="token punctuation">;</span>
  Logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">greeter</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>デプロイする</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">❯ clasp push
? Manifest <span class="token function">file</span> has been updated. Do you want to push and
overwrite? Yes
└─ appsscript.json
└─ hello.ts
Pushed <span class="token number">2</span> files.
</code></pre></div><p>正直何を上書きしたのかはわからない</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ clasp <span class="token function">open</span>
</code></pre></div><p>これでウェブのエディタが開く。<code>hello.gs</code>が表示された。</p>
<div class="code-block-container"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Compiled using hello-world-clasp 1.0.0 (TypeScript 4.7.4)</span>
<span class="token keyword">var</span> <span class="token function-variable function">greeter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Hello, "</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> testGreeter<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token string">'ikuma'</span><span class="token punctuation">;</span>
    Logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">greeter</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>TypeScriptも最新っぽいね</p>
<p>Logger.logが表示されない→testGreeterが関数じゃなかった</p>
<div class="code-block-container"><div class="code-block-filename-container"><span class="code-block-filename">hello.ts</span></div><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">greeter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>person<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> testGreeter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token string">'ikuma'</span><span class="token punctuation">;</span>
  Logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">greeter</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-01T13:49:08Z" title="2022-07-01T13:49:08Z">2022-07-01 13:07:00</time></header><div><ul>
<li>テンプレートリポジトリが作成できると良さそう</li>
<li>CodeSpacesでできるともっと良さそう</li>
</ul>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fryo_kawamata%2Farticles%2F2c6cc4e7c27210" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/ryo_kawamata/articles/2c6cc4e7c27210" style="display: none">https://zenn.dev/ryo_kawamata/articles/2c6cc4e7c27210</a></p>
<p>webpackでできるならViteもできる？</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fgas-webpack-plugin" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://www.npmjs.com/package/gas-webpack-plugin" style="display: none" rel="nofollow">https://www.npmjs.com/package/gas-webpack-plugin</a></p>
<p>これが必要みたい。GASで実行可能な関数がトップレベル関数だけなので、このプラグインがバンドルするタイミングで実行対象の関数をトップレベルに配置するという仕組み。</p>
<p>実行可能というのはGASのエディタで実行の選択肢に出てくる関数っぽいので、private的な役割だったら大丈夫みたい。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Fmahaker%2Fitems%2F7beb8aaf357fb3c32144" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://qiita.com/mahaker/items/7beb8aaf357fb3c32144" style="display: none" rel="nofollow">https://qiita.com/mahaker/items/7beb8aaf357fb3c32144</a></p>
<p>こんなの見つけた。これはesbuildの例。<br>
結局のところ、グローバルオブジェクトに関数宣言文で関数を定義できればwebpack縛りである必要はない。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Ffossamagna%2Fgas-entry-generator" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/fossamagna/gas-entry-generator" style="display: none" rel="nofollow">https://github.com/fossamagna/gas-entry-generator</a></p>
<p>これを使えばどうも関数宣言文を作成できるみたいで、これを組み込んだプラグインを作ればViteでもチャンスはあるみたい。</p>
<p>仕組み的にはgas-entry-generatorを動かして、その生成物 + ビルド結果を単純に合成しているみたい。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-01T13:59:05Z" title="2022-07-01T13:59:05Z">2022-07-01 13:07:00</time></header><div><p>まずはwebpackのテンプレートリポジトリをコピーして使ってみて、使い勝手を確かめる</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2FIkumaTadokoro%2Fgas-webpack-sample" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/IkumaTadokoro/gas-webpack-sample" style="display: none" rel="nofollow">https://github.com/IkumaTadokoro/gas-webpack-sample</a></p>
<p>う〜ん、build落ちちゃうな。これは自分で一から作っていった方が良さそう。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-01T15:07:57Z" title="2022-07-01T15:07:57Z">2022-07-01 15:07:00</time></header><div><p>esbuildを使ってpjを作成してみる</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fengineering.mercari.com%2Fblog%2Fentry%2F20211215-operation-tool-coupon%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/" style="display: none" rel="nofollow">https://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/</a></p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Faloerina01.github.io%2Fblog%2F2021-09-15-1" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://aloerina01.github.io/blog/2021-09-15-1" style="display: none" rel="nofollow">https://aloerina01.github.io/blog/2021-09-15-1</a></p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> esbuild-gas-sample
$ <span class="token function">npm</span> <span class="token function">install</span> -D esbuild
$ <span class="token function">npm</span> <span class="token function">install</span> -D esbuild-gas-plugin
</code></pre></div><p>たぶんなんか適当に作ればGASっぽい感じになると思われるので、やっている。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> src
$ <span class="token function">mkdir</span> dist
$ <span class="token function">touch</span> src/index.ts
$ <span class="token function">touch</span> bin/build

<span class="token comment"># index.tsとbin/buildを修正</span>

$ <span class="token function">chmod</span> u+x bin/build
$ bin/build
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">✘ <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Expected <span class="token string">";"</span> but found <span class="token string">"add"</span>

    src/utils.ts:1:5:
      <span class="token number">1</span> │ onst <span class="token function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1: number, n2: number<span class="token punctuation">)</span>: number <span class="token operator">=</span><span class="token punctuation">..</span>.
        │      ~~~
        ╵      <span class="token punctuation">;</span>

<span class="token number">1</span> error
✘ <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>plugin gas-plugin<span class="token punctuation">]</span> ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'dist/bundle.js'</span>

    /Users/tadokoroikuma/src/github.com/IkumaTadokoro/esbuild-gas-sample/node_modules/esbuild-gas-plugin/dist/index.js:7:25:
      <span class="token number">7</span> │ <span class="token punctuation">..</span>.  const outfile <span class="token operator">=</span> fs.readFileSync<span class="token punctuation">(</span>build.in<span class="token punctuation">..</span>.
        ╵                         ^
</code></pre></div><p>ちょっと修正する。<code>onst</code>になってた。</p>
<div class="code-block-container"><pre class=""><code class="">$ bin/build
</code></pre></div><p>え！早すぎでは！！</p>
<hr>
<p>ここからclaspを使ってpushできるようにしていく。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token function">touch</span> .clasp.json
</code></pre></div><div class="code-block-container"><pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"bin/build"</span><span class="token punctuation">,</span>
  <span class="token property">"deploy"</span><span class="token operator">:</span> <span class="token string">"bin/build &amp;&amp; clasp push"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>あ、appscripts.jsonがないって言われている。これどこに追加すればいいのかな？とりあえずsrcにおいてみる、多分ダメ。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'dist/appsscript.json'</span>
</code></pre></div><p>一旦、直接distに配置するappsscript.json。m名前間違いやすい</p>
<div class="code-block-container"><pre class=""><code class="">Could not find script.
Did you provide the correct scriptId?
Are you logged in to the correct account with the script?
</code></pre></div><p>あれ、もしかして.clasp.jsonも移動する必要がある？<br>
そういうことじゃないみたい。移動してもだめだった。</p>
<p>なんかIDが違ったみたい。修正したらとりあえずdeployはできたけど、エディタでみると何もなかった...。</p>
<p>う〜ん、何もデプロイされていないなあ</p>
<p>とりあえずできた。</p>
<ul>
<li>global登録は自分でやらないとダメ。グローバルに実行するべき関数がトップにないとエラーになる</li>
<li>clasp pushしてみても、エディタは変わっていない。でも実行結果は変わっている。更新しても同じで、実行するとローカルのコードを読んでいる。</li>
<li>クラシックエディタに一度切り替えたら、ちゃんと反映された。どうもpushがオンラインエディタに反映されないのは既知の問題らしい。</li>
</ul>
</div></section></article></article></div></main><footer class="font-bold border-t-2 border-slate-100"><div class="max-w-6xl mx-auto px-5"><nav class="py-12"><ul class="flex justify-around text-white"><li><a href="/diary">Home</a></li><li><a href="https://ikuma-t.work">Blog</a></li></ul></nav></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"body":"","bodyHTML":"","active_lock_reason":null,"assignee":null,"assignees":[],"author_association":"OWNER","closed_at":null,"comments":0,"comments_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48/comments","created_at":"2022-07-01T11:15:13Z","events_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48/events","html_url":"https://github.com/IkumaTadokoro/diary/issues/48","id":1291273280,"labels":[],"labels_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48/labels{/name}","locked":false,"milestone":null,"node_id":"I_kwDOHWTPVs5M90RA","number":48,"performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48/reactions"},"repository_url":"https://api.github.com/repos/IkumaTadokoro/diary","state":"open","state_reason":null,"timeline_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48/timeline","title":"2022-07-01","updated_at":"2022-07-01T11:15:13Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},"issueComments":[{"body":"# TypeScriptでGoogle Apps Scriptを書こう！\n\n## とりあえずスクラップ\n\nhttps://zenn.dev/kyo9bo/articles/ffc0d8b8076052\n\nhttps://zenn.dev/fillz_noh/articles/c6a3a504b0cefc\n\nhttps://zenn.dev/phi/articles/google-apps-script-snippets\n\nhttps://zenn.dev/offers/articles/20220616-google-app-script-technique\n\nhttps://zenn.dev/daria_nicht/articles/41c39bb4413db8\n\nhttps://zenn.dev/kkenjii/articles/gas-clasp-usage\n\nclaspを使って、TypeScriptでGASを書くのが良さそう。\n- 自動化の選択肢を広げられると良い。\n- TypeScriptの練習に使えると良さそう\n\n## claspを使ってみる\n\nhttps://github.com/google/clasp\n\n### インストール\n\n```bash\n$ npm i @google/clasp -g\n```\n\n### ログインする\n\n```bash\n$ clasp login\nLogging in globally…\n🔑 Authorize clasp by visiting this url:\nhttps://accounts.google.com/o/oauth2/v2/auth?access_type=offline\u0026scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.deployments%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.projects%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.webapp.deploy%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.metadata.readonly%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.file%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fservice.management%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Flogging.read%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\u0026response_type=code\u0026client_id=1072944905499-vm2v2i5dvn0a0d2o4ca36i1vge8cvbn0.apps.googleusercontent.com\u0026redirect_uri=http%3A%2F%2Flocalhost%3A65472\n\nAuthorization successful.\n\nDefault credentials saved to: /Users/tadokoroikuma/.clasprc.json.\n```\n\n### claspでTypeScriptを使えるようにする\n\nhttps://github.com/google/clasp/blob/master/docs/typescript.md\n\n```bash\n$ mkdir hello-world-clasp\n$ cd hello-world-clasp\n$ npm i @types/google-apps-script\n$ vim tsconfig.json\n````\n\n```json\n{\n  \"compilerOptions\": {\n    \"lib\": [\"es2022\"],\n    \"experimentalDecorators\": true\n  }\n}\n```\n\n### プロジェクトの作成\n\n```\n❯ clasp create --help\nUsage: clasp create [options]\n\nCreate a script\n\nOptions:\n  --type \u003ctype\u003e        Creates a new Apps Script project attached to a new Document, Spreadsheet, Presentation, Form, or as a standalone script, web app, or API.\n  --title \u003ctitle\u003e      The project title.\n  --parentId \u003cid\u003e      A project parent Id.\n  --rootDir \u003crootDir\u003e  Local root directory in which clasp will store your project files.\n  -h, --help           display help for command\n\n$ clasp create --title \"Hello World\" --type standalone\n\n$ ls -la\n# appscript.jsonが作成される\n```\n\nTimezoneがAmerica/NewYorkなので、Asia/Tokyoに変更する\n\n```json\n{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}\n~\n```\n\n### Hello World\n\n```typescript:hello.ts\nconst greeter = (person: string) =\u003e {\n  return `Hello, ${person}!`;\n}\n\nconst testGreeter() {\n  const user = 'ikuma';\n  Logger.log(greeter(user))\n}\n```\n\nデプロイする\n\n```bash\n❯ clasp push\n? Manifest file has been updated. Do you want to push and\noverwrite? Yes\n└─ appsscript.json\n└─ hello.ts\nPushed 2 files.\n```\n\n正直何を上書きしたのかはわからない\n\n\n```bash\n$ clasp open\n```\n\nこれでウェブのエディタが開く。`hello.gs`が表示された。\n\n```javascript\n// Compiled using hello-world-clasp 1.0.0 (TypeScript 4.7.4)\nvar greeter = function (person) {\n    return \"Hello, \".concat(person, \"!\");\n};\nvar testGreeter;\n(function () {\n    var user = 'ikuma';\n    Logger.log(greeter(user));\n});\n```\n\nTypeScriptも最新っぽいね\n\nLogger.logが表示されない→testGreeterが関数じゃなかった\n\n```typescript:hello.ts\nconst greeter = (person: string) =\u003e {\n  return `Hello, ${person}!`;\n}\n\nconst testGreeter = ():void =\u003e {\n  const user = 'ikuma';\n  Logger.log(greeter(user))\n}\n```\n\n","bodyHTML":"\u003ch1 id=\"typescript%E3%81%A7google-apps-script%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86%EF%BC%81\"\u003e\u003ca class=\"header-anchor-link\" href=\"#typescript%E3%81%A7google-apps-script%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86%EF%BC%81\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e TypeScriptでGoogle Apps Scriptを書こう！\u003c/h1\u003e\n\u003ch2 id=\"%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%83%E3%83%97\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%A9%E3%83%83%E3%83%97\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e とりあえずスクラップ\u003c/h2\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkyo9bo%2Farticles%2Fffc0d8b8076052\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/kyo9bo/articles/ffc0d8b8076052\" style=\"display: none\"\u003ehttps://zenn.dev/kyo9bo/articles/ffc0d8b8076052\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Ffillz_noh%2Farticles%2Fc6a3a504b0cefc\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/fillz_noh/articles/c6a3a504b0cefc\" style=\"display: none\"\u003ehttps://zenn.dev/fillz_noh/articles/c6a3a504b0cefc\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fphi%2Farticles%2Fgoogle-apps-script-snippets\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/phi/articles/google-apps-script-snippets\" style=\"display: none\"\u003ehttps://zenn.dev/phi/articles/google-apps-script-snippets\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Foffers%2Farticles%2F20220616-google-app-script-technique\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/offers/articles/20220616-google-app-script-technique\" style=\"display: none\"\u003ehttps://zenn.dev/offers/articles/20220616-google-app-script-technique\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fdaria_nicht%2Farticles%2F41c39bb4413db8\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/daria_nicht/articles/41c39bb4413db8\" style=\"display: none\"\u003ehttps://zenn.dev/daria_nicht/articles/41c39bb4413db8\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkkenjii%2Farticles%2Fgas-clasp-usage\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/kkenjii/articles/gas-clasp-usage\" style=\"display: none\"\u003ehttps://zenn.dev/kkenjii/articles/gas-clasp-usage\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eclaspを使って、TypeScriptでGASを書くのが良さそう。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自動化の選択肢を広げられると良い。\u003c/li\u003e\n\u003cli\u003eTypeScriptの練習に使えると良さそう\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"clasp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ca class=\"header-anchor-link\" href=\"#clasp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e claspを使ってみる\u003c/h2\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fgoogle%2Fclasp\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/google/clasp\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/google/clasp\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e インストール\u003c/h3\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e i @google/clasp -g\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e ログインする\u003c/h3\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ clasp login\nLogging \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e globally…\n🔑 Authorize clasp by visiting this url:\nhttps://accounts.google.com/o/oauth2/v2/auth?access_type\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eoffline\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"token assign-left variable\"\u003escope\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ehttps%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.deployments%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.projects%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fscript.webapp.deploy%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.metadata.readonly%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.file%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fservice.management%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Flogging.read%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"token assign-left variable\"\u003eresponse_type\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ecode\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"token assign-left variable\"\u003eclient_id\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1072944905499\u003c/span\u003e-vm2v2i5dvn0a0d2o4ca36i1vge8cvbn0.apps.googleusercontent.com\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"token assign-left variable\"\u003eredirect_uri\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ehttp%3A%2F%2Flocalhost%3A65472\n\nAuthorization successful.\n\nDefault credentials saved to: /Users/tadokoroikuma/.clasprc.json.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"clasp%E3%81%A7typescript%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ca class=\"header-anchor-link\" href=\"#clasp%E3%81%A7typescript%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e claspでTypeScriptを使えるようにする\u003c/h3\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fgoogle%2Fclasp%2Fblob%2Fmaster%2Fdocs%2Ftypescript.md\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/google/clasp/blob/master/docs/typescript.md\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/google/clasp/blob/master/docs/typescript.md\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e hello-world-clasp\n$ \u003cspan class=\"token builtin class-name\"\u003ecd\u003c/span\u003e hello-world-clasp\n$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e i @types/google-apps-script\n$ \u003cspan class=\"token function\"\u003evim\u003c/span\u003e tsconfig.json\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"compilerOptions\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"lib\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"es2022\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"experimentalDecorators\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e プロジェクトの作成\u003c/h3\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003e❯ clasp create --help\nUsage: clasp create [options]\n\nCreate a script\n\nOptions:\n  --type \u0026lt;type\u0026gt;        Creates a new Apps Script project attached to a new Document, Spreadsheet, Presentation, Form, or as a standalone script, web app, or API.\n  --title \u0026lt;title\u0026gt;      The project title.\n  --parentId \u0026lt;id\u0026gt;      A project parent Id.\n  --rootDir \u0026lt;rootDir\u0026gt;  Local root directory in which clasp will store your project files.\n  -h, --help           display help for command\n\n$ clasp create --title \u0026quot;Hello World\u0026quot; --type standalone\n\n$ ls -la\n# appscript.jsonが作成される\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTimezoneがAmerica/NewYorkなので、Asia/Tokyoに変更する\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"timeZone\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Asia/Tokyo\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"exceptionLogging\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"STACKDRIVER\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"runtimeVersion\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"V8\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n~\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"hello-world\"\u003e\u003ca class=\"header-anchor-link\" href=\"#hello-world\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e Hello World\u003c/h3\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cdiv class=\"code-block-filename-container\"\u003e\u003cspan class=\"code-block-filename\"\u003ehello.ts\u003c/span\u003e\u003c/div\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003egreeter\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eperson\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eHello, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eperson\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e!\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function\"\u003etestGreeter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e user \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'ikuma'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  Logger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003egreeter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eデプロイする\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e❯ clasp push\n? Manifest \u003cspan class=\"token function\"\u003efile\u003c/span\u003e has been updated. Do you want to push and\noverwrite? Yes\n└─ appsscript.json\n└─ hello.ts\nPushed \u003cspan class=\"token number\"\u003e2\u003c/span\u003e files.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e正直何を上書きしたのかはわからない\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ clasp \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこれでウェブのエディタが開く。\u003ccode\u003ehello.gs\u003c/code\u003eが表示された。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// Compiled using hello-world-clasp 1.0.0 (TypeScript 4.7.4)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003egreeter\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eperson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Hello, \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econcat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eperson\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e testGreeter\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e user \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'ikuma'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    Logger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003egreeter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTypeScriptも最新っぽいね\u003c/p\u003e\n\u003cp\u003eLogger.logが表示されない→testGreeterが関数じゃなかった\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cdiv class=\"code-block-filename-container\"\u003e\u003cspan class=\"code-block-filename\"\u003ehello.ts\u003c/span\u003e\u003c/div\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003egreeter\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eperson\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eHello, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eperson\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e!\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e testGreeter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e user \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'ikuma'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  Logger\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003egreeter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","author_association":"OWNER","created_at":"2022-07-01T12:29:12Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/48#issuecomment-1172294948","id":1172294948,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48","node_id":"IC_kwDOHWTPVs5F380k","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172294948/reactions"},"updated_at":"2022-07-01T12:29:12Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172294948","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"- テンプレートリポジトリが作成できると良さそう\n- CodeSpacesでできるともっと良さそう\n\nhttps://zenn.dev/ryo_kawamata/articles/2c6cc4e7c27210\n\nwebpackでできるならViteもできる？\n\nhttps://www.npmjs.com/package/gas-webpack-plugin\n\nこれが必要みたい。GASで実行可能な関数がトップレベル関数だけなので、このプラグインがバンドルするタイミングで実行対象の関数をトップレベルに配置するという仕組み。\n\n実行可能というのはGASのエディタで実行の選択肢に出てくる関数っぽいので、private的な役割だったら大丈夫みたい。\n\nhttps://qiita.com/mahaker/items/7beb8aaf357fb3c32144\n\nこんなの見つけた。これはesbuildの例。\n結局のところ、グローバルオブジェクトに関数宣言文で関数を定義できればwebpack縛りである必要はない。\n\nhttps://github.com/fossamagna/gas-entry-generator\n\nこれを使えばどうも関数宣言文を作成できるみたいで、これを組み込んだプラグインを作ればViteでもチャンスはあるみたい。\n\n仕組み的にはgas-entry-generatorを動かして、その生成物 + ビルド結果を単純に合成しているみたい。\n","bodyHTML":"\u003cul\u003e\n\u003cli\u003eテンプレートリポジトリが作成できると良さそう\u003c/li\u003e\n\u003cli\u003eCodeSpacesでできるともっと良さそう\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fryo_kawamata%2Farticles%2F2c6cc4e7c27210\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/ryo_kawamata/articles/2c6cc4e7c27210\" style=\"display: none\"\u003ehttps://zenn.dev/ryo_kawamata/articles/2c6cc4e7c27210\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ewebpackでできるならViteもできる？\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fgas-webpack-plugin\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://www.npmjs.com/package/gas-webpack-plugin\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://www.npmjs.com/package/gas-webpack-plugin\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこれが必要みたい。GASで実行可能な関数がトップレベル関数だけなので、このプラグインがバンドルするタイミングで実行対象の関数をトップレベルに配置するという仕組み。\u003c/p\u003e\n\u003cp\u003e実行可能というのはGASのエディタで実行の選択肢に出てくる関数っぽいので、private的な役割だったら大丈夫みたい。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fqiita.com%2Fmahaker%2Fitems%2F7beb8aaf357fb3c32144\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://qiita.com/mahaker/items/7beb8aaf357fb3c32144\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://qiita.com/mahaker/items/7beb8aaf357fb3c32144\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこんなの見つけた。これはesbuildの例。\u003cbr\u003e\n結局のところ、グローバルオブジェクトに関数宣言文で関数を定義できればwebpack縛りである必要はない。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Ffossamagna%2Fgas-entry-generator\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/fossamagna/gas-entry-generator\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/fossamagna/gas-entry-generator\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこれを使えばどうも関数宣言文を作成できるみたいで、これを組み込んだプラグインを作ればViteでもチャンスはあるみたい。\u003c/p\u003e\n\u003cp\u003e仕組み的にはgas-entry-generatorを動かして、その生成物 + ビルド結果を単純に合成しているみたい。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-01T13:49:08Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/48#issuecomment-1172370110","id":1172370110,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48","node_id":"IC_kwDOHWTPVs5F4PK-","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172370110/reactions"},"updated_at":"2022-07-01T13:49:08Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172370110","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"まずはwebpackのテンプレートリポジトリをコピーして使ってみて、使い勝手を確かめる\n\nhttps://github.com/IkumaTadokoro/gas-webpack-sample\n\nう〜ん、build落ちちゃうな。これは自分で一から作っていった方が良さそう。\n","bodyHTML":"\u003cp\u003eまずはwebpackのテンプレートリポジトリをコピーして使ってみて、使い勝手を確かめる\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2FIkumaTadokoro%2Fgas-webpack-sample\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/IkumaTadokoro/gas-webpack-sample\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/IkumaTadokoro/gas-webpack-sample\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eう〜ん、build落ちちゃうな。これは自分で一から作っていった方が良さそう。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-01T13:59:05Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/48#issuecomment-1172379544","id":1172379544,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48","node_id":"IC_kwDOHWTPVs5F4ReY","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172379544/reactions"},"updated_at":"2022-07-01T13:59:05Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172379544","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"esbuildを使ってpjを作成してみる\n\nhttps://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/\n\nhttps://aloerina01.github.io/blog/2021-09-15-1\n\n```bash\n$ mkdir esbuild-gas-sample\n$ npm install -D esbuild\n$ npm install -D esbuild-gas-plugin\n```\n\nたぶんなんか適当に作ればGASっぽい感じになると思われるので、やっている。\n\n```bash\n$ mkdir src\n$ mkdir dist\n$ touch src/index.ts\n$ touch bin/build\n\n# index.tsとbin/buildを修正\n\n$ chmod u+x bin/build\n$ bin/build\n```\n\n```bash\n✘ [ERROR] Expected \";\" but found \"add\"\n\n    src/utils.ts:1:5:\n      1 │ onst add = (n1: number, n2: number): number =...\n        │      ~~~\n        ╵      ;\n\n1 error\n✘ [ERROR] [plugin gas-plugin] ENOENT: no such file or directory, open 'dist/bundle.js'\n\n    /Users/tadokoroikuma/src/github.com/IkumaTadokoro/esbuild-gas-sample/node_modules/esbuild-gas-plugin/dist/index.js:7:25:\n      7 │ ...  const outfile = fs.readFileSync(build.in...\n        ╵                         ^\n```\n\nちょっと修正する。`onst`になってた。\n\n```\n$ bin/build\n```\n\nえ！早すぎでは！！\n\n---\n\nここからclaspを使ってpushできるようにしていく。\n\n```bash\n$ touch .clasp.json\n```\n\n```json\n\"scripts\": {\n  \"build\": \"bin/build\",\n  \"deploy\": \"bin/build \u0026\u0026 clasp push\",\n}\n```\n\nあ、appscripts.jsonがないって言われている。これどこに追加すればいいのかな？とりあえずsrcにおいてみる、多分ダメ。\n\n```bash\nENOENT: no such file or directory, open 'dist/appsscript.json'\n```\n\n一旦、直接distに配置するappsscript.json。m名前間違いやすい\n\n```\nCould not find script.\nDid you provide the correct scriptId?\nAre you logged in to the correct account with the script?\n```\n\nあれ、もしかして.clasp.jsonも移動する必要がある？\nそういうことじゃないみたい。移動してもだめだった。\n\nなんかIDが違ったみたい。修正したらとりあえずdeployはできたけど、エディタでみると何もなかった...。\n\nう〜ん、何もデプロイされていないなあ\n\nとりあえずできた。\n\n- global登録は自分でやらないとダメ。グローバルに実行するべき関数がトップにないとエラーになる\n- clasp pushしてみても、エディタは変わっていない。でも実行結果は変わっている。更新しても同じで、実行するとローカルのコードを読んでいる。\n- クラシックエディタに一度切り替えたら、ちゃんと反映された。どうもpushがオンラインエディタに反映されないのは既知の問題らしい。\n\n\n","bodyHTML":"\u003cp\u003eesbuildを使ってpjを作成してみる\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fengineering.mercari.com%2Fblog%2Fentry%2F20211215-operation-tool-coupon%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Faloerina01.github.io%2Fblog%2F2021-09-15-1\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://aloerina01.github.io/blog/2021-09-15-1\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://aloerina01.github.io/blog/2021-09-15-1\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e esbuild-gas-sample\n$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e -D esbuild\n$ \u003cspan class=\"token function\"\u003enpm\u003c/span\u003e \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e -D esbuild-gas-plugin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eたぶんなんか適当に作ればGASっぽい感じになると思われるので、やっている。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e src\n$ \u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e dist\n$ \u003cspan class=\"token function\"\u003etouch\u003c/span\u003e src/index.ts\n$ \u003cspan class=\"token function\"\u003etouch\u003c/span\u003e bin/build\n\n\u003cspan class=\"token comment\"\u003e# index.tsとbin/buildを修正\u003c/span\u003e\n\n$ \u003cspan class=\"token function\"\u003echmod\u003c/span\u003e u+x bin/build\n$ bin/build\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e✘ \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eERROR\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e Expected \u003cspan class=\"token string\"\u003e\";\"\u003c/span\u003e but found \u003cspan class=\"token string\"\u003e\"add\"\u003c/span\u003e\n\n    src/utils.ts:1:5:\n      \u003cspan class=\"token number\"\u003e1\u003c/span\u003e │ onst \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en1: number, n2: number\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e: number \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n        │      ~~~\n        ╵      \u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token number\"\u003e1\u003c/span\u003e error\n✘ \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eERROR\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eplugin gas-plugin\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e ENOENT: no such \u003cspan class=\"token function\"\u003efile\u003c/span\u003e or directory, \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'dist/bundle.js'\u003c/span\u003e\n\n    /Users/tadokoroikuma/src/github.com/IkumaTadokoro/esbuild-gas-sample/node_modules/esbuild-gas-plugin/dist/index.js:7:25:\n      \u003cspan class=\"token number\"\u003e7\u003c/span\u003e │ \u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.  const outfile \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e fs.readFileSync\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuild.in\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n        ╵                         ^\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eちょっと修正する。\u003ccode\u003eonst\u003c/code\u003eになってた。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003e$ bin/build\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eえ！早すぎでは！！\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eここからclaspを使ってpushできるようにしていく。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token function\"\u003etouch\u003c/span\u003e .clasp.json\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"bin/build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"deploy\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"bin/build \u0026amp;\u0026amp; clasp push\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eあ、appscripts.jsonがないって言われている。これどこに追加すればいいのかな？とりあえずsrcにおいてみる、多分ダメ。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eENOENT: no such \u003cspan class=\"token function\"\u003efile\u003c/span\u003e or directory, \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e \u003cspan class=\"token string\"\u003e'dist/appsscript.json'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一旦、直接distに配置するappsscript.json。m名前間違いやすい\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003eCould not find script.\nDid you provide the correct scriptId?\nAre you logged in to the correct account with the script?\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eあれ、もしかして.clasp.jsonも移動する必要がある？\u003cbr\u003e\nそういうことじゃないみたい。移動してもだめだった。\u003c/p\u003e\n\u003cp\u003eなんかIDが違ったみたい。修正したらとりあえずdeployはできたけど、エディタでみると何もなかった...。\u003c/p\u003e\n\u003cp\u003eう〜ん、何もデプロイされていないなあ\u003c/p\u003e\n\u003cp\u003eとりあえずできた。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eglobal登録は自分でやらないとダメ。グローバルに実行するべき関数がトップにないとエラーになる\u003c/li\u003e\n\u003cli\u003eclasp pushしてみても、エディタは変わっていない。でも実行結果は変わっている。更新しても同じで、実行するとローカルのコードを読んでいる。\u003c/li\u003e\n\u003cli\u003eクラシックエディタに一度切り替えたら、ちゃんと反映された。どうもpushがオンラインエディタに反映されないのは既知の問題らしい。\u003c/li\u003e\n\u003c/ul\u003e\n","author_association":"OWNER","created_at":"2022-07-01T15:07:57Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/48#issuecomment-1172445688","id":1172445688,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/48","node_id":"IC_kwDOHWTPVs5F4hn4","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172445688/reactions"},"updated_at":"2022-07-01T15:07:57Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172445688","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}}]},"__N_SSG":true},"page":"/articles/[issueNumber]","query":{"issueNumber":"48"},"buildId":"BmX7TgggyfCHQPWxpUwR3","assetPrefix":"/diary","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>