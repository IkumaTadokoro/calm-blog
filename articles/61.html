<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>2022-07-31</title><meta name="next-head-count" content="3"/><link rel="preload" href="/diary/_next/static/css/d865616645a7b0fe.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/d865616645a7b0fe.css" data-n-g=""/><link rel="preload" href="/diary/_next/static/css/fc9624fd4a486ef2.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/fc9624fd4a486ef2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/diary/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/diary/_next/static/chunks/webpack-dc4034d98607b727.js" defer=""></script><script src="/diary/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/diary/_next/static/chunks/main-a03413948affdc5e.js" defer=""></script><script src="/diary/_next/static/chunks/pages/_app-5b4d6b2692b4593b.js" defer=""></script><script src="/diary/_next/static/chunks/582-d79da0492f1f9267.js" defer=""></script><script src="/diary/_next/static/chunks/pages/articles/%5BissueNumber%5D-4584e21e841751ac.js" defer=""></script><script src="/diary/_next/static/wULaLBvgKBtqjdNAwYO_2/_buildManifest.js" defer=""></script><script src="/diary/_next/static/wULaLBvgKBtqjdNAwYO_2/_ssgManifest.js" defer=""></script><script src="/diary/_next/static/wULaLBvgKBtqjdNAwYO_2/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><script>window.twttr=(function(f,b,g){var e,c=f.getElementsByTagName(b)[0],a=window.twttr||{};if(f.getElementById(g)){return a}e=f.createElement(b);e.id=g;e.src="https://platform.twitter.com/widgets.js";c.parentNode.insertBefore(e,c);a._e=[];a.ready=function(d){a._e.push(d)};return a}(document,"script","twitter-wjs"));</script><div class="min-h-screen flex flex-col"><header class="relative bg-gradient-to-r from-blue-700 via-blue-800 to-gray-900 md:mb-8"><div class="max-w-6xl mx-auto px-5"><nav class="py-12 md:mb-20 flex items-center justify-between md:px-12 px-2"><div><h1 class="text-white"><a class="text-2xl md:text-3xl tracking-wide font-bold" href="/diary">ikuma-t/diary</a></h1><p class="mt-4 text-sm text-slate-300">ikuma-tの作業ログです。</p></div><div><a class="text-white text-sm" href="https://github.com/IkumaTadokoro/diary/issues">Show on GitHub</a></div></nav></div><svg class="absolute w-full h-20 md:h-full top-32 left-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" preserveAspectRatio="none"><path d="M0 32L24 37.3C48 43 96 53 144 74.7C192 96 240 128 288 122.7C336 117 384 75 432 80C480 85 528 139 576 133.3C624 128 672 64 720 53.3C768 43 816 85 864 90.7C912 96 960 64 1008 48C1056 32 1104 32 1152 58.7C1200 85 1248 139 1296 133.3C1344 128 1392 64 1416 32L1440 0V171H1416C1392 171 1344 171 1296 171C1248 171 1200 171 1152 171C1104 171 1056 171 1008 171C960 171 912 171 864 171C816 171 768 171 720 171C672 171 624 171 576 171C528 171 480 171 432 171C384 171 336 171 288 171C240 171 192 171 144 171C96 171 48 171 24 171H0V32Z" fill="white"></path></svg></header><main class="z-10 flex-1 py-8"><div class="max-w-2xl mx-auto"><article class="znc markdown"><section class="block py-6 md:px-12 px-8 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T02:22:18Z" title="2022-07-31T02:22:18Z">2022-07-31 02:07:00</time><h1 class="font-bold text-slate-600">2022-07-31</h1></header><aside><p class="text-sm text-slate-400">Posted by <!-- --> at <!-- --><a href="https://github.com/IkumaTadokoro/diary/issues/61">#61</a>.<!-- --></p></aside><div></div></section><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T02:23:06Z" title="2022-07-31T02:23:06Z">2022-07-31 02:07:00</time></header><div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Flerna.js.org%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://lerna.js.org/" style="display: none" rel="nofollow">https://lerna.js.org/</a></p>
<ul>
<li>monorepoのためのパッケージ管理ツール</li>
</ul>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fnx.dev%2F%3Futm_source%3Dlerna.js.org" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://nx.dev/?utm_source=lerna.js.org" style="display: none" rel="nofollow">https://nx.dev/?utm_source=lerna.js.org</a></p>
<ul>
<li>これはなんでしょう</li>
</ul>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T02:31:24Z" title="2022-07-31T02:31:24Z">2022-07-31 02:07:00</time></header><div><p>esbuildでGASのテンプレートを作るまでは良かったけど、GAS単体でリポジトリ1個作るは重いのと、GASを使う場合は大体同じことをやりたいと思うので、モノレポでのテンプレートを作るべきだったと反省している</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T03:18:17Z" title="2022-07-31T03:18:17Z">2022-07-31 03:07:00</time></header><div><p>monorepoで管理する要件</p>
<ul>
<li>clasp.jsonをスクリプトごとに保持する</li>
<li>package.jsonをスクリプトごとに保持する（共通部分は共通にできるといいと思うけど）</li>
<li>共通ライブラリ部分を1つにする</li>
</ul>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkatsumanarisawa%2Farticles%2Fb98ba340a218af" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://zenn.dev/katsumanarisawa/articles/b98ba340a218af" style="display: none">https://zenn.dev/katsumanarisawa/articles/b98ba340a218af</a></p>
<ul>
<li>lintやformatterの設定を1つに行えるようにする</li>
</ul>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fdev.classmethod.jp%2Farticles%2Fturborepo-superfast-monorepo-ci%2F" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://dev.classmethod.jp/articles/turborepo-superfast-monorepo-ci/" style="display: none" rel="nofollow">https://dev.classmethod.jp/articles/turborepo-superfast-monorepo-ci/</a></p>
<p>npm workspaces対応するのが一番早い気がするな。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fworkspaces" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://docs.npmjs.com/cli/v8/using-npm/workspaces" style="display: none" rel="nofollow">https://docs.npmjs.com/cli/v8/using-npm/workspaces</a></p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T04:37:40Z" title="2022-07-31T04:37:40Z">2022-07-31 04:07:00</time></header><div><p>食べ過ぎで死んでたけど体調戻った。esbuild-gas-templateをmonorepo対応するぞ</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T04:50:00Z" title="2022-07-31T04:50:00Z">2022-07-31 04:07:00</time></header><div><p>monorepo対応のために、まずはnpm workspacesを入れていきたい</p>
<p>ディレクトリ構成的には</p>
<ul>
<li>app</li>
<li>lib</li>
</ul>
<p>の2つに分けて、共通的な定義についてはlib配下に配置するようにしたい。lintとかはこれまで同様にルートに配置する構成。</p>
<p>appについては以下のような構成かな？templateの中にはコピー元となるディレクトリを1つ持っておいて、それをコピーする感じにするのが最小コストでいいかもしれない。</p>
<div class="code-block-container"><pre class=""><code class="">- app
  - projectA
    - package.json
    - package-lock.json
    - node_modules/
    - .clasp.json
    - appsscript.json
    - README.md
    - src/
    - test/
  - projectB
</code></pre></div><p>あと問題はbuildコマンドで、今はsrc/index.tsをエントリポイントにしているけど、各ディレクトリごとに対応できるようにしないといけない。</p>
<p>それからtestがなんかうまくいかないのも既知の問題なのでどうにかしたいけど。とりあえずは大丈夫そう。</p>
<p>とりあえずディレクトリを作ったので、ここからはnpm workspacesを学習していく。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T05:00:46Z" title="2022-07-31T05:00:46Z">2022-07-31 05:07:00</time></header><div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fworkspaces" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://docs.npmjs.com/cli/v8/using-npm/workspaces" style="display: none" rel="nofollow">https://docs.npmjs.com/cli/v8/using-npm/workspaces</a></p>
<blockquote>
<p>ワークスペースとは、npm cliの機能の総称で、ローカルファイルシステムから複数のパッケージを単一のトップレベル、ルートパッケージの中で管理するためのサポートを提供するものである。</p>
</blockquote>
<p>こうやって定義するみたい</p>
<div class="code-block-container"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my-workspaces-powered-project"</span><span class="token punctuation">,</span>
  <span class="token property">"workspaces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"packages/a"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>こういうディレクトリ構成だそう。</p>
<div class="code-block-container"><pre class=""><code class="">.
+-- package.json
`-- packages
   +-- a
   |   `-- package.json
</code></pre></div><p>トップレベルのpackage.jsonで<code>name</code>: プロジェクト名を定義し、<code>workspaces</code>で各ディレクトリを定義していく。</p>
<h3 id="%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"><a class="header-anchor-link" href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90" aria-hidden="true" rel="nofollow"></a> ワークスペースの作成</h3>
<div class="code-block-container"><pre class=""><code class="">npm init -w ./packages/a
</code></pre></div><ul>
<li>ディレクトリとpackage.jsonが作成される。</li>
</ul>
<h3 id="%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AEdependencies%E3%81%AE%E8%BF%BD%E5%8A%A0"><a class="header-anchor-link" href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AEdependencies%E3%81%AE%E8%BF%BD%E5%8A%A0" aria-hidden="true" rel="nofollow"></a> ワークスペースへのdependenciesの追加</h3>
<p><code>-w &lt;workspace&gt;</code>で対象を指定して、いつものコマンドを叩くみたい。</p>
<h3 id="%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C"><a class="header-anchor-link" href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C" aria-hidden="true" rel="nofollow"></a> コマンドの実行</h3>
<ul>
<li><code>npm run hoge --workspace=a</code>みたいな感じで、特定のワークスペースのコマンドを実行できる</li>
<li>ワークスペースのディレクトリで実行すれば、そのワークスペースのコマンドが実行される</li>
<li><code>npm run hoge --workspaces</code>で各ワークスペースにあるhogeコマンドを同時に実行する
<ul>
<li>この時、トップレベルのpackage.jsonで定義された順にコマンドが実行される。</li>
<li><code>npm run hoge --workspaces --if-present</code>とすると、hogeスクリプトがそのワークスペースにある場合だけ実行する。</li>
</ul>
</li>
</ul>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-07-31T08:13:04Z" title="2022-07-31T08:13:04Z">2022-07-31 08:07:00</time></header><div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fcommands%2Fnpm-set-script" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://docs.npmjs.com/cli/v8/commands/npm-set-script" style="display: none" rel="nofollow">https://docs.npmjs.com/cli/v8/commands/npm-set-script</a></p>
<p>npmのscriptを追加するコマンド</p>
<div class="code-block-container"><pre class=""><code class="">npm set-script [&lt;script&gt;] [&lt;command&gt;]
</code></pre></div></div></section></article></article></div></main><footer class="font-bold border-t-2 border-slate-100"><div class="max-w-6xl mx-auto px-5"><nav class="py-12"><ul class="flex justify-around text-white"><li><a href="/diary">Home</a></li><li><a href="https://ikuma-t.work">Blog</a></li></ul></nav></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"body":"","bodyHTML":"","active_lock_reason":null,"assignee":null,"assignees":[],"author_association":"OWNER","closed_at":null,"comments":0,"comments_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61/comments","created_at":"2022-07-31T02:22:18Z","events_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61/events","html_url":"https://github.com/IkumaTadokoro/diary/issues/61","id":1323342988,"labels":[],"labels_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61/labels{/name}","locked":false,"milestone":null,"node_id":"I_kwDOHWTPVs5O4JyM","number":61,"performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61/reactions"},"repository_url":"https://api.github.com/repos/IkumaTadokoro/diary","state":"open","state_reason":null,"timeline_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61/timeline","title":"2022-07-31","updated_at":"2022-07-31T02:22:18Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},"issueComments":[{"body":"https://lerna.js.org/\n\n- monorepoのためのパッケージ管理ツール\n\nhttps://nx.dev/?utm_source=lerna.js.org\n\n- これはなんでしょう\n","bodyHTML":"\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Flerna.js.org%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://lerna.js.org/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://lerna.js.org/\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emonorepoのためのパッケージ管理ツール\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fnx.dev%2F%3Futm_source%3Dlerna.js.org\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://nx.dev/?utm_source=lerna.js.org\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://nx.dev/?utm_source=lerna.js.org\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eこれはなんでしょう\u003c/li\u003e\n\u003c/ul\u003e\n","author_association":"OWNER","created_at":"2022-07-31T02:23:06Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200333692","id":1200333692,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi6N8","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200333692/reactions"},"updated_at":"2022-07-31T02:23:06Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200333692","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":" esbuildでGASのテンプレートを作るまでは良かったけど、GAS単体でリポジトリ1個作るは重いのと、GASを使う場合は大体同じことをやりたいと思うので、モノレポでのテンプレートを作るべきだったと反省している\n","bodyHTML":"\u003cp\u003eesbuildでGASのテンプレートを作るまでは良かったけど、GAS単体でリポジトリ1個作るは重いのと、GASを使う場合は大体同じことをやりたいと思うので、モノレポでのテンプレートを作るべきだったと反省している\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-31T02:31:24Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200334529","id":1200334529,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi6bB","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200334529/reactions"},"updated_at":"2022-07-31T02:31:24Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200334529","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"monorepoで管理する要件\n\n- clasp.jsonをスクリプトごとに保持する\n- package.jsonをスクリプトごとに保持する（共通部分は共通にできるといいと思うけど）\n- 共通ライブラリ部分を1つにする\n\nhttps://zenn.dev/katsumanarisawa/articles/b98ba340a218af\n\n- lintやformatterの設定を1つに行えるようにする\n\nhttps://dev.classmethod.jp/articles/turborepo-superfast-monorepo-ci/\n\nnpm workspaces対応するのが一番早い気がするな。\n\nhttps://docs.npmjs.com/cli/v8/using-npm/workspaces\n","bodyHTML":"\u003cp\u003emonorepoで管理する要件\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eclasp.jsonをスクリプトごとに保持する\u003c/li\u003e\n\u003cli\u003epackage.jsonをスクリプトごとに保持する（共通部分は共通にできるといいと思うけど）\u003c/li\u003e\n\u003cli\u003e共通ライブラリ部分を1つにする\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fzenn.dev%2Fkatsumanarisawa%2Farticles%2Fb98ba340a218af\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://zenn.dev/katsumanarisawa/articles/b98ba340a218af\" style=\"display: none\"\u003ehttps://zenn.dev/katsumanarisawa/articles/b98ba340a218af\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elintやformatterの設定を1つに行えるようにする\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fdev.classmethod.jp%2Farticles%2Fturborepo-superfast-monorepo-ci%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://dev.classmethod.jp/articles/turborepo-superfast-monorepo-ci/\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://dev.classmethod.jp/articles/turborepo-superfast-monorepo-ci/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003enpm workspaces対応するのが一番早い気がするな。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fworkspaces\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://docs.npmjs.com/cli/v8/using-npm/workspaces\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://docs.npmjs.com/cli/v8/using-npm/workspaces\u003c/a\u003e\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-31T03:18:17Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200339370","id":1200339370,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi7mq","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200339370/reactions"},"updated_at":"2022-07-31T03:18:17Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200339370","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"食べ過ぎで死んでたけど体調戻った。esbuild-gas-templateをmonorepo対応するぞ\n","bodyHTML":"\u003cp\u003e食べ過ぎで死んでたけど体調戻った。esbuild-gas-templateをmonorepo対応するぞ\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-31T04:37:40Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200346621","id":1200346621,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi9X9","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200346621/reactions"},"updated_at":"2022-07-31T04:37:40Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200346621","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"monorepo対応のために、まずはnpm workspacesを入れていきたい\n\nディレクトリ構成的には\n\n- app\n- lib\n\nの2つに分けて、共通的な定義についてはlib配下に配置するようにしたい。lintとかはこれまで同様にルートに配置する構成。\n\nappについては以下のような構成かな？templateの中にはコピー元となるディレクトリを1つ持っておいて、それをコピーする感じにするのが最小コストでいいかもしれない。\n\n```\n- app\n  - projectA\n    - package.json\n    - package-lock.json\n    - node_modules/\n    - .clasp.json\n    - appsscript.json\n    - README.md\n    - src/\n    - test/\n  - projectB\n```\n\nあと問題はbuildコマンドで、今はsrc/index.tsをエントリポイントにしているけど、各ディレクトリごとに対応できるようにしないといけない。\n\nそれからtestがなんかうまくいかないのも既知の問題なのでどうにかしたいけど。とりあえずは大丈夫そう。\n\nとりあえずディレクトリを作ったので、ここからはnpm workspacesを学習していく。\n","bodyHTML":"\u003cp\u003emonorepo対応のために、まずはnpm workspacesを入れていきたい\u003c/p\u003e\n\u003cp\u003eディレクトリ構成的には\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eapp\u003c/li\u003e\n\u003cli\u003elib\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eの2つに分けて、共通的な定義についてはlib配下に配置するようにしたい。lintとかはこれまで同様にルートに配置する構成。\u003c/p\u003e\n\u003cp\u003eappについては以下のような構成かな？templateの中にはコピー元となるディレクトリを1つ持っておいて、それをコピーする感じにするのが最小コストでいいかもしれない。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003e- app\n  - projectA\n    - package.json\n    - package-lock.json\n    - node_modules/\n    - .clasp.json\n    - appsscript.json\n    - README.md\n    - src/\n    - test/\n  - projectB\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eあと問題はbuildコマンドで、今はsrc/index.tsをエントリポイントにしているけど、各ディレクトリごとに対応できるようにしないといけない。\u003c/p\u003e\n\u003cp\u003eそれからtestがなんかうまくいかないのも既知の問題なのでどうにかしたいけど。とりあえずは大丈夫そう。\u003c/p\u003e\n\u003cp\u003eとりあえずディレクトリを作ったので、ここからはnpm workspacesを学習していく。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-07-31T04:50:00Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200347777","id":1200347777,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi9qB","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200347777/reactions"},"updated_at":"2022-07-31T04:50:00Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200347777","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"https://docs.npmjs.com/cli/v8/using-npm/workspaces\n\n\u003e ワークスペースとは、npm cliの機能の総称で、ローカルファイルシステムから複数のパッケージを単一のトップレベル、ルートパッケージの中で管理するためのサポートを提供するものである。\n\nこうやって定義するみたい\n\n```json\n{\n  \"name\": \"my-workspaces-powered-project\",\n  \"workspaces\": [\n    \"packages/a\"\n  ]\n}\n```\n\nこういうディレクトリ構成だそう。\n\n```\n.\n+-- package.json\n`-- packages\n   +-- a\n   |   `-- package.json\n```\n\nトップレベルのpackage.jsonで`name`: プロジェクト名を定義し、`workspaces`で各ディレクトリを定義していく。\n\n### ワークスペースの作成\n\n```\nnpm init -w ./packages/a\n```\n\n- ディレクトリとpackage.jsonが作成される。\n\n### ワークスペースへのdependenciesの追加\n\n`-w \u003cworkspace\u003e`で対象を指定して、いつものコマンドを叩くみたい。\n\n### コマンドの実行\n\n- `npm run hoge --workspace=a`みたいな感じで、特定のワークスペースのコマンドを実行できる\n- ワークスペースのディレクトリで実行すれば、そのワークスペースのコマンドが実行される\n- `npm run hoge --workspaces`で各ワークスペースにあるhogeコマンドを同時に実行する\n  - この時、トップレベルのpackage.jsonで定義された順にコマンドが実行される。\n  - `npm run hoge --workspaces --if-present`とすると、hogeスクリプトがそのワークスペースにある場合だけ実行する。 \n\n","bodyHTML":"\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fworkspaces\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://docs.npmjs.com/cli/v8/using-npm/workspaces\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://docs.npmjs.com/cli/v8/using-npm/workspaces\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eワークスペースとは、npm cliの機能の総称で、ローカルファイルシステムから複数のパッケージを単一のトップレベル、ルートパッケージの中で管理するためのサポートを提供するものである。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eこうやって定義するみたい\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"my-workspaces-powered-project\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"workspaces\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"packages/a\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこういうディレクトリ構成だそう。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003e.\n+-- package.json\n`-- packages\n   +-- a\n   |   `-- package.json\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eトップレベルのpackage.jsonで\u003ccode\u003ename\u003c/code\u003e: プロジェクト名を定義し、\u003ccode\u003eworkspaces\u003c/code\u003eで各ディレクトリを定義していく。\u003c/p\u003e\n\u003ch3 id=\"%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e ワークスペースの作成\u003c/h3\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003enpm init -w ./packages/a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eディレクトリとpackage.jsonが作成される。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AEdependencies%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AEdependencies%E3%81%AE%E8%BF%BD%E5%8A%A0\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e ワークスペースへのdependenciesの追加\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e-w \u0026lt;workspace\u0026gt;\u003c/code\u003eで対象を指定して、いつものコマンドを叩くみたい。\u003c/p\u003e\n\u003ch3 id=\"%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C\" aria-hidden=\"true\" rel=\"nofollow\"\u003e\u003c/a\u003e コマンドの実行\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003enpm run hoge --workspace=a\u003c/code\u003eみたいな感じで、特定のワークスペースのコマンドを実行できる\u003c/li\u003e\n\u003cli\u003eワークスペースのディレクトリで実行すれば、そのワークスペースのコマンドが実行される\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enpm run hoge --workspaces\u003c/code\u003eで各ワークスペースにあるhogeコマンドを同時に実行する\n\u003cul\u003e\n\u003cli\u003eこの時、トップレベルのpackage.jsonで定義された順にコマンドが実行される。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enpm run hoge --workspaces --if-present\u003c/code\u003eとすると、hogeスクリプトがそのワークスペースにある場合だけ実行する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","author_association":"OWNER","created_at":"2022-07-31T05:00:46Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200349085","id":1200349085,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5Hi9-d","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200349085/reactions"},"updated_at":"2022-07-31T05:00:46Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200349085","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"https://docs.npmjs.com/cli/v8/commands/npm-set-script\n\nnpmのscriptを追加するコマンド\n\n```\nnpm set-script [\u003cscript\u003e] [\u003ccommand\u003e]\n```\n","bodyHTML":"\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fcommands%2Fnpm-set-script\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://docs.npmjs.com/cli/v8/commands/npm-set-script\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://docs.npmjs.com/cli/v8/commands/npm-set-script\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003enpmのscriptを追加するコマンド\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"\"\u003e\u003ccode class=\"\"\u003enpm set-script [\u0026lt;script\u0026gt;] [\u0026lt;command\u0026gt;]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","author_association":"OWNER","created_at":"2022-07-31T08:13:04Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/61#issuecomment-1200373821","id":1200373821,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/61","node_id":"IC_kwDOHWTPVs5HjEA9","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200373821/reactions"},"updated_at":"2022-07-31T08:13:04Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1200373821","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}}]},"__N_SSG":true},"page":"/articles/[issueNumber]","query":{"issueNumber":"61"},"buildId":"wULaLBvgKBtqjdNAwYO_2","assetPrefix":"/diary","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>