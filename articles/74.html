<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>2022-08-28</title><meta name="next-head-count" content="3"/><link rel="preload" href="/diary/_next/static/css/d865616645a7b0fe.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/d865616645a7b0fe.css" data-n-g=""/><link rel="preload" href="/diary/_next/static/css/fc9624fd4a486ef2.css" as="style"/><link rel="stylesheet" href="/diary/_next/static/css/fc9624fd4a486ef2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/diary/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/diary/_next/static/chunks/webpack-dc4034d98607b727.js" defer=""></script><script src="/diary/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/diary/_next/static/chunks/main-a03413948affdc5e.js" defer=""></script><script src="/diary/_next/static/chunks/pages/_app-5b4d6b2692b4593b.js" defer=""></script><script src="/diary/_next/static/chunks/582-d79da0492f1f9267.js" defer=""></script><script src="/diary/_next/static/chunks/pages/articles/%5BissueNumber%5D-4584e21e841751ac.js" defer=""></script><script src="/diary/_next/static/mA4vYlTO00MVrCClLpn5p/_buildManifest.js" defer=""></script><script src="/diary/_next/static/mA4vYlTO00MVrCClLpn5p/_ssgManifest.js" defer=""></script><script src="/diary/_next/static/mA4vYlTO00MVrCClLpn5p/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><script>window.twttr=(function(f,b,g){var e,c=f.getElementsByTagName(b)[0],a=window.twttr||{};if(f.getElementById(g)){return a}e=f.createElement(b);e.id=g;e.src="https://platform.twitter.com/widgets.js";c.parentNode.insertBefore(e,c);a._e=[];a.ready=function(d){a._e.push(d)};return a}(document,"script","twitter-wjs"));</script><div class="min-h-screen flex flex-col"><header class="relative bg-gradient-to-r from-blue-700 via-blue-800 to-gray-900 md:mb-8"><div class="max-w-6xl mx-auto px-5"><nav class="py-12 md:mb-20 flex items-center justify-between md:px-12 px-2"><div><h1 class="text-white"><a class="text-2xl md:text-3xl tracking-wide font-bold" href="/diary">ikuma-t/diary</a></h1><p class="mt-4 text-sm text-slate-300">ikuma-tの作業ログです。</p></div><div><a class="text-white text-sm" href="https://github.com/IkumaTadokoro/diary/issues">Show on GitHub</a></div></nav></div><svg class="absolute w-full h-20 md:h-full top-32 left-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" preserveAspectRatio="none"><path d="M0 32L24 37.3C48 43 96 53 144 74.7C192 96 240 128 288 122.7C336 117 384 75 432 80C480 85 528 139 576 133.3C624 128 672 64 720 53.3C768 43 816 85 864 90.7C912 96 960 64 1008 48C1056 32 1104 32 1152 58.7C1200 85 1248 139 1296 133.3C1344 128 1392 64 1416 32L1440 0V171H1416C1392 171 1344 171 1296 171C1248 171 1200 171 1152 171C1104 171 1056 171 1008 171C960 171 912 171 864 171C816 171 768 171 720 171C672 171 624 171 576 171C528 171 480 171 432 171C384 171 336 171 288 171C240 171 192 171 144 171C96 171 48 171 24 171H0V32Z" fill="white"></path></svg></header><main class="z-10 flex-1 py-8"><div class="max-w-2xl mx-auto"><article class="znc markdown"><section class="block py-6 md:px-12 px-8 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T00:38:08Z" title="2022-08-28T00:38:08Z">2022-08-28 00:08:00</time><h1 class="font-bold text-slate-600">2022-08-28</h1></header><aside><p class="text-sm text-slate-400">Posted by <!-- --> at <!-- --><a href="https://github.com/IkumaTadokoro/diary/issues/74">#74</a>.<!-- --></p></aside><div></div></section><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T00:47:54Z" title="2022-08-28T00:47:54Z">2022-08-28 00:08:00</time></header><div><p>一夜明けて、記憶無くなる。再開。</p>
<p>今確認している事象自体はIssueとして上がっているんだけど、だいぶ前。<br>
かつなんか微妙に解決していない。</p>
<p>一方で、cdprotoのリポジトリをみると、ちゃんと定義が生成されているっぽい。<br>
どれを使って更新されているか確認してみる。</p>
<p>kenshawって人が呪王でpushしているっぽい？だとするとそれをどう生成しているかは確認できないな</p>
<p>でもREADMEにはcdproto-genコマンドを使っているってあるから、どうなっているんだよという感じではある。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T02:06:47Z" title="2022-08-28T02:06:47Z">2022-08-28 02:08:00</time></header><div><p>これもしかして、oldブランチに切り替えたらうまくいったりするのか？</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">go <span class="token function">install</span> github.com/chromedp/cdproto-gen@cdproto-gen@old
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ cdproto-gen

easyjson-bootstrap693351085.go:14:3: no required module provides package github.com/chromedp/cdproto/media: go.mod <span class="token function">file</span> not found <span class="token keyword">in</span> current directory or any parent directory<span class="token punctuation">;</span> see <span class="token string">'go help modules'</span>
<span class="token comment"># こんなのがめっちゃでている</span>
</code></pre></div><p>とはいえ、oldブランチに切り替えたら今まで落ちているところも落ちないようになった。<br>
少なくとも</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2Fabc6091f7244e5c70d1a9ef38f70ec9a6b209d39%2Fmain.go%23L283" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/pdlgen/blob/abc6091f7244e5c70d1a9ef38f70ec9a6b209d39/main.go#L283" style="display: none" rel="nofollow">https://github.com/chromedp/pdlgen/blob/abc6091f7244e5c70d1a9ef38f70ec9a6b209d39/main.go#L283</a></p>
<p>ここまで到達するようになった。後一息である。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fmailru%2Feasyjson" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/mailru/easyjson" style="display: none" rel="nofollow">https://github.com/mailru/easyjson</a></p>
<p>Goの構造体とJSONをリフレクションなしに簡潔かつ高速に変換できるパッケージ（リフレクションis何）。標準で<code>encoding/json</code>があるけど、それよりも早い。</p>
<hr>
<p>pdlgenのREADMEに書いてあった</p>
<blockquote>
<p>The -out command-line option should point to the directory into which the github.com/chromedp/cdproto repository is cloned, so that easyjson can find the go.mod file and use it.</p>
</blockquote>
<p>というわけで、このソースも落としてくる。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">ghq get git@github.com:chromedp/cdproto.git
cdproto-gen <span class="token parameter variable">-out</span><span class="token operator">=</span>/Users/ikuma/src/github.com/chromedp/cdproto
</code></pre></div><p>これでやっと動いたよ...</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T05:49:05Z" title="2022-08-28T05:49:05Z">2022-08-28 05:08:00</time></header><div><p>生成物を見ていくけど、これ結局cd-protoができたっていうだけだな？</p>
<p>自動生成のところは大体仕組みを理解したので、次はこれを利用しているchromedp本体の挙動を確かめていく。</p>
<p>今回Olaywrightを実装するにあたって、HTTP→WebSocketの接続開始をどういう風にやるのがいいかのイメージがまだついていないので、ついでに参考にできるといいなという魂胆。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T06:19:34Z" title="2022-08-28T06:19:34Z">2022-08-28 06:08:00</time></header><div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ go <span class="token function">install</span> github.com/spf13/cobra-cli@latest
$ <span class="token function">vim</span> ~/.cobra.yaml
</code></pre></div><div class="code-block-container"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">author</span><span class="token punctuation">:</span> ikuma<span class="token punctuation">-</span>t &lt;tadokorodev@gmail.com<span class="token punctuation">></span>
<span class="token key atrule">license</span><span class="token punctuation">:</span> MIT
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> /path/to/directory
$ go mod init github.com/IkumaTadokoro/helloworld
$ cobra-cli init
</code></pre></div><div class="code-block-container"><pre class="language-bash"><code class="language-bash">$ go <span class="token function">install</span>
$ helloworld

A longer description that spans multiple lines and likely contains
examples and usage of using your application. For example:

Cobra is a CLI library <span class="token keyword">for</span> Go that empowers applications.
This application is a tool to generate the needed files
to quickly create a Cobra application.
</code></pre></div><p>cobraの引数には0番地から渡した引数が格納される。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T06:57:02Z" title="2022-08-28T06:57:02Z">2022-08-28 06:08:00</time></header><div><p>cdprotoがCDPのSDK</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fcdproto" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/cdproto" style="display: none" rel="nofollow">https://github.com/chromedp/cdproto</a></p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token comment">// Message chrome DevTools Protocol message sent/read over websocket</span>
<span class="token comment">// connection.</span>
<span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID        <span class="token builtin">int64</span>               <span class="token string">`json:"id,omitempty"`</span>        <span class="token comment">// Unique message identifier.</span>
	SessionID target<span class="token punctuation">.</span>SessionID    <span class="token string">`json:"sessionId,omitempty"`</span> <span class="token comment">// Session that the message belongs to when using flat access.</span>
	Method    MethodType          <span class="token string">`json:"method,omitempty"`</span>    <span class="token comment">// Event or command type.</span>
	Params    easyjson<span class="token punctuation">.</span>RawMessage <span class="token string">`json:"params,omitempty"`</span>    <span class="token comment">// Event or command parameters.</span>
	Result    easyjson<span class="token punctuation">.</span>RawMessage <span class="token string">`json:"result,omitempty"`</span>    <span class="token comment">// Command return values.</span>
	Error     <span class="token operator">*</span>Error              <span class="token string">`json:"error,omitempty"`</span>     <span class="token comment">// Error message.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>こういうMessageの構造体を持っていて、このMessageをJSONにシリアライズ（これはGoでいうところのMarshalなのかな）してWebSocketで送信する。</p>
<hr>
<p>chromedp</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fchromedp" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/chromedp/chromedp" style="display: none" rel="nofollow">https://github.com/chromedp/chromedp</a></p>
<p>chromedpが本体で、CDPのラッパーに相当する。内部的にはcdprotoを利用している。seleniumがWebDriverをラップしているようなイメージ。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">ghq get git@github.com:chromedp/examples.git
go run text/main.go
</code></pre></div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Ftime" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/time" style="display: none" rel="nofollow">https://pkg.go.dev/time</a></p>
<p>これが表示されるようになっている。</p>
<div class="code-block-container"><pre class="language-bash"><code class="language-bash">go run click/main.go
</code></pre></div><p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Ftime%23After" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://pkg.go.dev/time#After" style="display: none" rel="nofollow">https://pkg.go.dev/time#After</a></p>
<p>ここのExampleをクリックするサンプルケース。</p>
<p>構造を見てみよう。例えば前者の方はこうなっている</p>
<div class="code-block-container"><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// create context</span>
	ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> chromedp<span class="token punctuation">.</span><span class="token function">NewContext</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// run task list</span>
	<span class="token keyword">var</span> res <span class="token builtin">string</span>
	err <span class="token operator">:=</span> chromedp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>
		chromedp<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token string">`https://pkg.go.dev/time`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		chromedp<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">`.Documentation-overview`</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> chromedp<span class="token punctuation">.</span>NodeVisible<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>contextを作成して、コマンドを実行する。contextなんだったっけ...？生でWebSocker叩いてた記録を読み返す。</p>
<p>Playwrightでも同じようにContextを作成していた。意味はわかるんだけど、どのレイヤーで定義されているやつなのかがわからない。これ多分Seleniumの時に見たんだよな。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fja%2Fdocs%2FGlossary%2FBrowsing_context" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://developer.mozilla.org/ja/docs/Glossary/Browsing_context" style="display: none" rel="nofollow">https://developer.mozilla.org/ja/docs/Glossary/Browsing_context</a></p>
<blockquote>
<p>閲覧コンテキストは、ブラウザー が Document (今日では通常タブであり、場合によってはウィンドウまたはページ内のフレーム) を表示する環境です。</p>
</blockquote>
<p>まあタブと思っておけばよさそう。</p>
</div></section></article><article class="mt-4"><section class="block py-6 px-8 md:px-12 bg-white md:rounded-lg border border-gray-200 shadow-md"><header><time class="text-xs text-gray-300 truncate" dateTime="2022-08-28T08:19:28Z" title="2022-08-28T08:19:28Z">2022-08-28 08:08:00</time></header><div><p>このDiary、日付ベースで書くのもいいけど、テーマベースですぐ書けるようにすると良さそうですね。</p>
</div></section></article></article></div></main><footer class="font-bold border-t-2 border-slate-100"><div class="max-w-6xl mx-auto px-5"><nav class="py-12"><ul class="flex justify-around text-white"><li><a href="/diary">Home</a></li><li><a href="https://ikuma-t.work">Blog</a></li></ul></nav></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"body":"","bodyHTML":"","active_lock_reason":null,"assignee":null,"assignees":[],"author_association":"OWNER","closed_at":null,"comments":0,"comments_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74/comments","created_at":"2022-08-28T00:38:08Z","events_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74/events","html_url":"https://github.com/IkumaTadokoro/diary/issues/74","id":1353208969,"labels":[],"labels_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74/labels{/name}","locked":false,"milestone":null,"node_id":"I_kwDOHWTPVs5QqFSJ","number":74,"performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74/reactions"},"repository_url":"https://api.github.com/repos/IkumaTadokoro/diary","state":"open","state_reason":null,"timeline_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74/timeline","title":"2022-08-28","updated_at":"2022-08-28T00:38:08Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},"issueComments":[{"body":"一夜明けて、記憶無くなる。再開。\n\n今確認している事象自体はIssueとして上がっているんだけど、だいぶ前。\nかつなんか微妙に解決していない。\n\n一方で、cdprotoのリポジトリをみると、ちゃんと定義が生成されているっぽい。\nどれを使って更新されているか確認してみる。\n\nkenshawって人が呪王でpushしているっぽい？だとするとそれをどう生成しているかは確認できないな\n\nでもREADMEにはcdproto-genコマンドを使っているってあるから、どうなっているんだよという感じではある。\n","bodyHTML":"\u003cp\u003e一夜明けて、記憶無くなる。再開。\u003c/p\u003e\n\u003cp\u003e今確認している事象自体はIssueとして上がっているんだけど、だいぶ前。\u003cbr\u003e\nかつなんか微妙に解決していない。\u003c/p\u003e\n\u003cp\u003e一方で、cdprotoのリポジトリをみると、ちゃんと定義が生成されているっぽい。\u003cbr\u003e\nどれを使って更新されているか確認してみる。\u003c/p\u003e\n\u003cp\u003ekenshawって人が呪王でpushしているっぽい？だとするとそれをどう生成しているかは確認できないな\u003c/p\u003e\n\u003cp\u003eでもREADMEにはcdproto-genコマンドを使っているってあるから、どうなっているんだよという感じではある。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T00:47:54Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229348326","id":1229348326,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRl3m","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229348326/reactions"},"updated_at":"2022-08-28T00:47:54Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229348326","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"これもしかして、oldブランチに切り替えたらうまくいったりするのか？\n\n```bash\ngo install github.com/chromedp/cdproto-gen@cdproto-gen@old\n```\n\n```bash\n$ cdproto-gen\n\neasyjson-bootstrap693351085.go:14:3: no required module provides package github.com/chromedp/cdproto/media: go.mod file not found in current directory or any parent directory; see 'go help modules'\n# こんなのがめっちゃでている\n```\n\nとはいえ、oldブランチに切り替えたら今まで落ちているところも落ちないようになった。\n少なくとも\n\nhttps://github.com/chromedp/pdlgen/blob/abc6091f7244e5c70d1a9ef38f70ec9a6b209d39/main.go#L283\n\nここまで到達するようになった。後一息である。\n\nhttps://github.com/mailru/easyjson\n\nGoの構造体とJSONをリフレクションなしに簡潔かつ高速に変換できるパッケージ（リフレクションis何）。標準で`encoding/json`があるけど、それよりも早い。\n\n---\n\npdlgenのREADMEに書いてあった\n\n\u003e The -out command-line option should point to the directory into which the github.com/chromedp/cdproto repository is cloned, so that easyjson can find the go.mod file and use it.\n\nというわけで、このソースも落としてくる。\n\n```bash\nghq get git@github.com:chromedp/cdproto.git\ncdproto-gen -out=/Users/ikuma/src/github.com/chromedp/cdproto\n```\n\nこれでやっと動いたよ...\n\n\n","bodyHTML":"\u003cp\u003eこれもしかして、oldブランチに切り替えたらうまくいったりするのか？\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ego \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e github.com/chromedp/cdproto-gen@cdproto-gen@old\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ cdproto-gen\n\neasyjson-bootstrap693351085.go:14:3: no required module provides package github.com/chromedp/cdproto/media: go.mod \u003cspan class=\"token function\"\u003efile\u003c/span\u003e not found \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e current directory or any parent directory\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e see \u003cspan class=\"token string\"\u003e'go help modules'\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# こんなのがめっちゃでている\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eとはいえ、oldブランチに切り替えたら今まで落ちているところも落ちないようになった。\u003cbr\u003e\n少なくとも\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fpdlgen%2Fblob%2Fabc6091f7244e5c70d1a9ef38f70ec9a6b209d39%2Fmain.go%23L283\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/pdlgen/blob/abc6091f7244e5c70d1a9ef38f70ec9a6b209d39/main.go#L283\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/pdlgen/blob/abc6091f7244e5c70d1a9ef38f70ec9a6b209d39/main.go#L283\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eここまで到達するようになった。後一息である。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fmailru%2Feasyjson\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/mailru/easyjson\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/mailru/easyjson\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eGoの構造体とJSONをリフレクションなしに簡潔かつ高速に変換できるパッケージ（リフレクションis何）。標準で\u003ccode\u003eencoding/json\u003c/code\u003eがあるけど、それよりも早い。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003epdlgenのREADMEに書いてあった\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe -out command-line option should point to the directory into which the github.com/chromedp/cdproto repository is cloned, so that easyjson can find the go.mod file and use it.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eというわけで、このソースも落としてくる。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eghq get git@github.com:chromedp/cdproto.git\ncdproto-gen \u003cspan class=\"token parameter variable\"\u003e-out\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e/Users/ikuma/src/github.com/chromedp/cdproto\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこれでやっと動いたよ...\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T02:06:47Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229357137","id":1229357137,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRoBR","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229357137/reactions"},"updated_at":"2022-08-28T02:06:47Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229357137","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"生成物を見ていくけど、これ結局cd-protoができたっていうだけだな？\n\n自動生成のところは大体仕組みを理解したので、次はこれを利用しているchromedp本体の挙動を確かめていく。\n\n今回Olaywrightを実装するにあたって、HTTP→WebSocketの接続開始をどういう風にやるのがいいかのイメージがまだついていないので、ついでに参考にできるといいなという魂胆。\n","bodyHTML":"\u003cp\u003e生成物を見ていくけど、これ結局cd-protoができたっていうだけだな？\u003c/p\u003e\n\u003cp\u003e自動生成のところは大体仕組みを理解したので、次はこれを利用しているchromedp本体の挙動を確かめていく。\u003c/p\u003e\n\u003cp\u003e今回Olaywrightを実装するにあたって、HTTP→WebSocketの接続開始をどういう風にやるのがいいかのイメージがまだついていないので、ついでに参考にできるといいなという魂胆。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T05:49:05Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229382261","id":1229382261,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRuJ1","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229382261/reactions"},"updated_at":"2022-08-28T05:49:05Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229382261","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"```bash\n$ go install github.com/spf13/cobra-cli@latest\n$ vim ~/.cobra.yaml\n```\n\n```yaml\nauthor: ikuma-t \u003ctadokorodev@gmail.com\u003e\nlicense: MIT\n```\n\n```bash\n$ cd /path/to/directory\n$ go mod init github.com/IkumaTadokoro/helloworld\n$ cobra-cli init\n```\n\n```bash\n$ go install\n$ helloworld\n\nA longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\n\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.\n```\n\ncobraの引数には0番地から渡した引数が格納される。\n","bodyHTML":"\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ go \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e github.com/spf13/cobra-cli@latest\n$ \u003cspan class=\"token function\"\u003evim\u003c/span\u003e ~/.cobra.yaml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-yaml\"\u003e\u003ccode class=\"language-yaml\"\u003e\u003cspan class=\"token key atrule\"\u003eauthor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e ikuma\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003et \u0026lt;tadokorodev@gmail.com\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003elicense\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e MIT\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token builtin class-name\"\u003ecd\u003c/span\u003e /path/to/directory\n$ go mod init github.com/IkumaTadokoro/helloworld\n$ cobra-cli init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ go \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e\n$ helloworld\n\nA longer description that spans multiple lines and likely contains\nexamples and usage of using your application. For example:\n\nCobra is a CLI library \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ecobraの引数には0番地から渡した引数が格納される。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T06:19:34Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229385612","id":1229385612,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRu-M","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229385612/reactions"},"updated_at":"2022-08-28T06:19:34Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229385612","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"cdprotoがCDPのSDK\n\nhttps://github.com/chromedp/cdproto\n\n```go\n// Message chrome DevTools Protocol message sent/read over websocket\n// connection.\ntype Message struct {\n\tID        int64               `json:\"id,omitempty\"`        // Unique message identifier.\n\tSessionID target.SessionID    `json:\"sessionId,omitempty\"` // Session that the message belongs to when using flat access.\n\tMethod    MethodType          `json:\"method,omitempty\"`    // Event or command type.\n\tParams    easyjson.RawMessage `json:\"params,omitempty\"`    // Event or command parameters.\n\tResult    easyjson.RawMessage `json:\"result,omitempty\"`    // Command return values.\n\tError     *Error              `json:\"error,omitempty\"`     // Error message.\n}\n```\n\nこういうMessageの構造体を持っていて、このMessageをJSONにシリアライズ（これはGoでいうところのMarshalなのかな）してWebSocketで送信する。\n\n---\n\nchromedp\n\nhttps://github.com/chromedp/chromedp\n\nchromedpが本体で、CDPのラッパーに相当する。内部的にはcdprotoを利用している。seleniumがWebDriverをラップしているようなイメージ。\n\n```bash\nghq get git@github.com:chromedp/examples.git\ngo run text/main.go\n```\n\nhttps://pkg.go.dev/time\n\nこれが表示されるようになっている。\n\n```bash\ngo run click/main.go\n```\n\nhttps://pkg.go.dev/time#After\n\nここのExampleをクリックするサンプルケース。\n\n\n構造を見てみよう。例えば前者の方はこうなっている\n\n```go\nfunc main() {\n\t// create context\n\tctx, cancel := chromedp.NewContext(context.Background())\n\tdefer cancel()\n\n\t// run task list\n\tvar res string\n\terr := chromedp.Run(ctx,\n\t\tchromedp.Navigate(`https://pkg.go.dev/time`),\n\t\tchromedp.Text(`.Documentation-overview`, \u0026res, chromedp.NodeVisible),\n\t)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tlog.Println(strings.TrimSpace(res))\n}\n```\n\ncontextを作成して、コマンドを実行する。contextなんだったっけ...？生でWebSocker叩いてた記録を読み返す。\n\nPlaywrightでも同じようにContextを作成していた。意味はわかるんだけど、どのレイヤーで定義されているやつなのかがわからない。これ多分Seleniumの時に見たんだよな。\n\nhttps://developer.mozilla.org/ja/docs/Glossary/Browsing_context\n\n\u003e 閲覧コンテキストは、ブラウザー が Document (今日では通常タブであり、場合によってはウィンドウまたはページ内のフレーム) を表示する環境です。\n\nまあタブと思っておけばよさそう。\n\n","bodyHTML":"\u003cp\u003ecdprotoがCDPのSDK\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fcdproto\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/cdproto\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/cdproto\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token comment\"\u003e// Message chrome DevTools Protocol message sent/read over websocket\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// connection.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e Message \u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\tID        \u003cspan class=\"token builtin\"\u003eint64\u003c/span\u003e               \u003cspan class=\"token string\"\u003e`json:\"id,omitempty\"`\u003c/span\u003e        \u003cspan class=\"token comment\"\u003e// Unique message identifier.\u003c/span\u003e\n\tSessionID target\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSessionID    \u003cspan class=\"token string\"\u003e`json:\"sessionId,omitempty\"`\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Session that the message belongs to when using flat access.\u003c/span\u003e\n\tMethod    MethodType          \u003cspan class=\"token string\"\u003e`json:\"method,omitempty\"`\u003c/span\u003e    \u003cspan class=\"token comment\"\u003e// Event or command type.\u003c/span\u003e\n\tParams    easyjson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRawMessage \u003cspan class=\"token string\"\u003e`json:\"params,omitempty\"`\u003c/span\u003e    \u003cspan class=\"token comment\"\u003e// Event or command parameters.\u003c/span\u003e\n\tResult    easyjson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRawMessage \u003cspan class=\"token string\"\u003e`json:\"result,omitempty\"`\u003c/span\u003e    \u003cspan class=\"token comment\"\u003e// Command return values.\u003c/span\u003e\n\tError     \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eError              \u003cspan class=\"token string\"\u003e`json:\"error,omitempty\"`\u003c/span\u003e     \u003cspan class=\"token comment\"\u003e// Error message.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eこういうMessageの構造体を持っていて、このMessageをJSONにシリアライズ（これはGoでいうところのMarshalなのかな）してWebSocketで送信する。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003echromedp\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Fchromedp%2Fchromedp\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://github.com/chromedp/chromedp\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://github.com/chromedp/chromedp\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003echromedpが本体で、CDPのラッパーに相当する。内部的にはcdprotoを利用している。seleniumがWebDriverをラップしているようなイメージ。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eghq get git@github.com:chromedp/examples.git\ngo run text/main.go\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Ftime\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/time\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/time\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこれが表示されるようになっている。\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ego run click/main.go\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fpkg.go.dev%2Ftime%23After\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://pkg.go.dev/time#After\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://pkg.go.dev/time#After\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eここのExampleをクリックするサンプルケース。\u003c/p\u003e\n\u003cp\u003e構造を見てみよう。例えば前者の方はこうなっている\u003c/p\u003e\n\u003cdiv class=\"code-block-container\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"token comment\"\u003e// create context\u003c/span\u003e\n\tctx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cancel \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e chromedp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNewContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eBackground\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003edefer\u003c/span\u003e \u003cspan class=\"token function\"\u003ecancel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\t\u003cspan class=\"token comment\"\u003e// run task list\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e res \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\n\terr \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e chromedp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eRun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ectx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\tchromedp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNavigate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e`https://pkg.go.dev/time`\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\tchromedp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eText\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e`.Documentation-overview`\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eres\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e chromedp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eNodeVisible\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\tlog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFatal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\tlog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estrings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eTrimSpace\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eres\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003econtextを作成して、コマンドを実行する。contextなんだったっけ...？生でWebSocker叩いてた記録を読み返す。\u003c/p\u003e\n\u003cp\u003ePlaywrightでも同じようにContextを作成していた。意味はわかるんだけど、どのレイヤーで定義されているやつなのかがわからない。これ多分Seleniumの時に見たんだよな。\u003c/p\u003e\n\u003cp\u003e\u003cdiv class=\"embed-zenn-link\"\u003e\u003ciframe src=\"https://card.zenn.dev/?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fja%2Fdocs%2FGlossary%2FBrowsing_context\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\"\u003e\u003c/iframe\u003e\u003c/div\u003e\u003ca href=\"https://developer.mozilla.org/ja/docs/Glossary/Browsing_context\" style=\"display: none\" rel=\"nofollow\"\u003ehttps://developer.mozilla.org/ja/docs/Glossary/Browsing_context\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e閲覧コンテキストは、ブラウザー が Document (今日では通常タブであり、場合によってはウィンドウまたはページ内のフレーム) を表示する環境です。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eまあタブと思っておけばよさそう。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T06:57:02Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229394090","id":1229394090,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRxCq","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229394090/reactions"},"updated_at":"2022-08-28T06:57:02Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229394090","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}},{"body":"このDiary、日付ベースで書くのもいいけど、テーマベースですぐ書けるようにすると良さそうですね。\n\n","bodyHTML":"\u003cp\u003eこのDiary、日付ベースで書くのもいいけど、テーマベースですぐ書けるようにすると良さそうですね。\u003c/p\u003e\n","author_association":"OWNER","created_at":"2022-08-28T08:19:28Z","html_url":"https://github.com/IkumaTadokoro/diary/issues/74#issuecomment-1229405085","id":1229405085,"issue_url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/74","node_id":"IC_kwDOHWTPVs5JRzud","performed_via_github_app":null,"reactions":{"+1":0,"-1":0,"confused":0,"eyes":0,"heart":0,"hooray":0,"laugh":0,"rocket":0,"total_count":0,"url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229405085/reactions"},"updated_at":"2022-08-28T08:19:28Z","url":"https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1229405085","user":{"avatar_url":"https://avatars.githubusercontent.com/u/61409641?v=4","events_url":"https://api.github.com/users/IkumaTadokoro/events{/privacy}","followers_url":"https://api.github.com/users/IkumaTadokoro/followers","following_url":"https://api.github.com/users/IkumaTadokoro/following{/other_user}","gists_url":"https://api.github.com/users/IkumaTadokoro/gists{/gist_id}","gravatar_id":"","html_url":"https://github.com/IkumaTadokoro","id":61409641,"login":"IkumaTadokoro","node_id":"MDQ6VXNlcjYxNDA5NjQx","organizations_url":"https://api.github.com/users/IkumaTadokoro/orgs","received_events_url":"https://api.github.com/users/IkumaTadokoro/received_events","repos_url":"https://api.github.com/users/IkumaTadokoro/repos","site_admin":false,"starred_url":"https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IkumaTadokoro/subscriptions","type":"User","url":"https://api.github.com/users/IkumaTadokoro"}}]},"__N_SSG":true},"page":"/articles/[issueNumber]","query":{"issueNumber":"74"},"buildId":"mA4vYlTO00MVrCClLpn5p","assetPrefix":"/diary","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>