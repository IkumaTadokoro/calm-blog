---
author_association: OWNER
created_at: '2022-08-21T11:29:29Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221526862
id: 1221526862
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/69
node_id: IC_kwDOHWTPVs5IzwVO
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221526862/reactions
updated_at: '2022-08-21T11:29:29Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221526862
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L133

```go
func loadProtoDefs() (*pdl.PDL, error) {
	var err error

	if *flagPdl != "" {
		util.Logf("PROTOCOL: %s", *flagPdl)
		buf, err := ioutil.ReadFile(*flagPdl)
		if err != nil {
			return nil, err
		}
		return pdl.Parse(buf)
	}

	var protoDefs []*pdl.PDL
	load := func(urlstr, typ, ver string) error {
		buf, err := util.Get(util.Cache{
			URL:    fmt.Sprintf(urlstr+"?format=TEXT", ver),
			Path:   filepath.Join(*flagCache, "pdl", typ, ver+".pdl"),
			TTL:    *flagTTL,
			Decode: true,
		})
		if err != nil {
			return err
		}

		// parse
		protoDef, err := pdl.Parse(buf)
		if err != nil {
			return err
		}
		protoDefs = append(protoDefs, protoDef)
		return nil
	}

	// grab browser + js definition
	if err = load(util.ChromiumURL, "chromium", *flagChromium); err != nil {
		return nil, err
	}
	if err = load(util.V8URL, "v8", *flagV8); err != nil {
		return nil, err
	}

	// grab har definition
	har, err := pdl.Parse([]byte(pdl.HAR))
	if err != nil {
		return nil, err
	}

	return pdl.Combine(append(protoDefs, har)...), nil
}
```

Goには組み込みのerror型がある

```go
type error interface {
    Error() string
}
```

pdlを引数として渡した場合は、渡したpdlをパースして終了。

```go
var protoDefs []*pdl.PDL
```

こういうのもスラスラ読めないの辛いな。え〜と、`var`で変数宣言なので、`protoDefs`という変数を宣言している。後ろにあるのが型なので、`[]*pdl.PDL`型ってことかな。

で、`[]`はスライスで、`*pdl.PDL`はポインタなので、この長さを持ったスライス？

長さは関係なかった。`pdl.PDL`は次の定義となっている

```go
type PDL struct { 
    // Copyright is the file copyright.
    Copyright string

    // Version is the file version information.
    Version *Version

    // Domains are the available domains.
    Domains []*Domain
}
```

あれ、関数の宣言で引数の型を省略したらGoではどうなるの？あ〜、2つ以上の引数の型が同じ梅は、最後の型を省略して記述できる。

---

処理の大枠の流れとしては、

1. 取得したPDLファイルを読み込む
2. 読み込んだPDLをParseして、protoDefという変数に突っ込んであげる

って感じ。ポインタが謎すぎる。で、関数はファーストクラスファンクションなので、この処理を`load`として動的に定義してあげる。そっか、ここで関数として切り出さないんだな。`protoDef`をこの関数全体のコンテキストで共有していて、それに依存するし、関数化したい思ったのは、あくまで2回出てくるからくらいなので、ここで定義しているって感じか。

ソースをみている感じ、PDLの中にHARの定義も書いてあって、これも読み取っている。

で、最終的に

```go
return pdl.Combine(append(protoDefs, har)...), nil
```

ってやっているんだけど、これ何？特に`...`
