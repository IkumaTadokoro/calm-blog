---
author_association: OWNER
created_at: '2022-08-21T06:39:27Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221479502
id: 1221479502
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/69
node_id: IC_kwDOHWTPVs5IzkxO
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221479502/reactions
updated_at: '2022-08-21T06:39:27Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221479502
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
pdlgenの挙動をみていく。

まずは動かしてみて、どういうふうに動くかを確認する。

READMEをちゃんと読んでおこう。いそがば回れだ。

- cdproto-genはChrome DevTools Protocolのコマンド、イベント、型のためのGoコードを生成する。
- cdproto-genはChromiumソースツリーから`browser_protocol.pdl`と`js_protocol.pdl`を取得する。これらは`$GOPATH/pkg/cdproto-gen`にキャッシュされ、定期的に更新される。
- HAR定義は特別なHARドメインを生成するために使用される。
  - HAR定義ってなんだ？
　- http://www.softwareishard.com/blog/har-12-spec/ のことみたい
  - HTTP ARchive 1.2のことだそう。
  - Webブラウザーとサイトとのやりとりに関する詳細なパフォーマンスデータをエクスポートするためのHTTPトランザクションのアーカイブ形式を定義する仕様
- cdproto-gen は browser_protocol.pdl と js_protocol.pdl で定義された CDP ドメインをテンプレートから構成して動作するように調整する。
  - 生成物はchromedp/cdprotoとchromedp/cdproto/<domain>サブパッケージ。循環依存性を持つCDPタイプは`chromedp/cdproto/cdp`パッケージに配置される。

全体構成がほんのりわかったくらい。動かしてみよう

```bash
go get -u github.com/chromedp/cdproto-gen
```

いまって`go get`使うんだっけ?あ〜少なくとも1.17の時点で非推奨になっているので、1.19を使っている自分としては`go install`を使うべき。

https://future-architect.github.io/articles/20210818a/

https://re-engines.com/2021/10/11/go-1-16%E3%81%A7%E3%81%AEgo-get%E3%81%A8go-install%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9/

`go get`は`go.mod`を編集するためのコマンド、`go install`はバイナリのビルド、インストールのためのコマンドになったと。


`-u`オプションはなんだ？

https://qiita.com/tadaken/items/9f8fd9c8e7096b6bffde

> 新しいマイナーリリースまたはパッチリリースが利用可能な場合に、パッケージとその依存パッケージをネットワークから更新する。

なるほど、最新版を取ってくる感じにすればいいのか。Goの公式サイト行って、go installを確認するか。

Goのドキュメント、検索機能ついてないの辛すぎないですか？

https://go.dev/doc/cmd

これがコマンドのドキュメントっぽい。`go install <package>@<version>`

割と最近まで更新されているのに、何で`go get`がREADMEに残っているんだろう。全然Issueにも上がっていない。つまり、これはgo getでやれってことなのかな？

とりあえずやってみよう。

```bash
go get -u github.com/chromedp/cdproto-gen
```

```bash
go: go.mod file not found in current directory or any parent directory.
	'go get' is no longer supported outside a module.
	To build and install a command, use 'go install' with a version,
	like 'go install example.com/cmd@latest'
	For more information, see https://golang.org/doc/go-get-install-deprecation
	or run 'go help get' or 'go help install'.
```

ダメじゃん。というかヘルプコマンドナいと思ったら、helpの引数にコマンドを渡す形式だったんか。go installしてみる。


```bash
$ go install github.com/chromedp/cdproto-gen

go install github.com/chromedp/cdproto-gen
go: 'go install' requires a version when current directory is not in a module
	Try 'go install github.com/chromedp/cdproto-gen@latest' to install the latest version

$ go install github.com/chromedp/cdproto-gen@latest

go: downloading github.com/chromedp/cdproto-gen v0.0.0-20200709115207-99c9ca13bbae
go: downloading github.com/mailru/easyjson v0.7.2-0.20200524104011-8ba3c7bdceed
go: downloading github.com/ryanuber/go-glob v1.0.0
go: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a
go: downloading golang.org/x/tools v0.0.0-20200606014950-c42cb6316fb6
go: downloading github.com/valyala/quicktemplate v1.5.0
go: downloading github.com/client9/misspell v0.3.4
go: downloading github.com/knq/snaker v0.0.0-20181215144011-2bc8a4db4687
go: downloading github.com/Masterminds/semver v1.5.0
go: downloading github.com/PuerkitoBio/goquery v1.5.1
go: downloading golang.org/x/net v0.0.0-20200602114024-627f9648deb9
go: downloading github.com/andybalholm/cascadia v1.2.0
go: downloading github.com/valyala/bytebufferpool v1.0.0
go: downloading golang.org/x/mod v0.2.0
go: downloading golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543
```

これでダウンロード完了した。みたい。次にREADMEのUsingのセクション。

`cdproto-gen`で動くそうな。これも動かしてみるか。

```bash
$ cdproto-gen
zsh: command not found: cdproto-gen
```

まあPATHが通ってないんでしょうね。一旦Goのファイルがどこに落ちているのか調べる。

https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies

> Executables are installed in the directory named by the GOBIN environment variable, which defaults to $GOPATH/bin or $HOME/go/bin if the GOPATH environment variable is not set. Executables in $GOROOT are installed in $GOROOT/bin or $GOTOOLDIR instead of $GOBIN.

```bash
$ echo $GOROOT $GOBIN $GOPATH


$ ls ~/go/bin
cdproto-gen
```

なるほど、ここにあるけどPATHが通ってないので、ということなのか。これGOPATHとか設定した方がいいのかな？もう少し公式ドキュメントを読み進める。

`go install`自体のドキュメントにはなさそうなので、環境年数のドキュメントに飛びたい。

https://pkg.go.dev/cmd/go#hdr-GOPATH_environment_variable

https://pkg.go.dev/cmd/go#hdr-GOPATH_and_Modules

https://pkg.go.dev/cmd/go#hdr-Legacy_GOPATH_go_get

Overviewをみる限りだとここら辺かな？

```bash
$ go env GOPATH
~/go
```

インストール先と挙動はあっていそうなので単純にGOPATHへのPATHを通せば良さそう。

```bash
# .zshrc
export GOPATH=$HOME/go
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOBIN
```

```bash
cdproto-gen --help
Usage of cdproto-gen:
  -cache string
    	protocol cache directory
  -chromium string
    	chromium protocol version
  -debug
    	toggle debug (writes generated files to disk without post-processing)
  -go-pkg string
    	go base package name (default "github.com/chromedp/cdproto")
  -go-wl string
    	comma-separated list of files to whitelist (ignore) (default "LICENSE,README.md,*.pdl,go.mod,go.sum,easyjson.go")
  -latest
    	use latest protocol
  -no-clean
    	toggle not cleaning (removing) existing directories
  -no-dump
    	toggle not dumping generated protocol file to out directory
  -out string
    	package out directory
  -pdl string
    	path to pdl file to use
  -ttl duration
    	file retrieval caching ttl (default 24h0m0s)
  -v8 string
    	v8 protocol version
```

認識されたようだ。一旦休憩
