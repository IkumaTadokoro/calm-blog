---
author_association: OWNER
created_at: '2022-08-21T07:46:56Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/69#issuecomment-1221491767
id: 1221491767
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/69
node_id: IC_kwDOHWTPVs5Iznw3
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221491767/reactions
updated_at: '2022-08-21T07:46:56Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1221491767
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
では実際に動かして、何をしているのかみてみるところから再開。

```bash
$ cdproto-gen

# 一部だけ抜粋
panic: could not resolve type cdp.compatibilitymode in domain cdp
```

なんかとりあえずpanicになってそう笑

コマンドの実行履歴的に、`~/Library/Caches/cdproto-gen`あたりに何かを生成していそうなのでみてみる。

```bash
Library/Caches/cdproto-gen
❯ la
total 0
drwxr-xr-x    6 ikuma  staff   192  8 21 16:02 .
drwx------+ 129 ikuma  staff  4128  8 21 16:02 ..
drwxr-xr-x    3 ikuma  staff    96  8 21 16:02 deps
drwxr-xr-x    3 ikuma  staff    96  8 21 16:02 html
drwxr-xr-x    5 ikuma  staff   160  8 21 16:02 pdl
drwxr-xr-x    3 ikuma  staff    96  8 21 16:02 refs
```

お〜！できてる。

無難にhtmlから開いてみるか。

内容はREADMEにあるとおり、以下のサイトのものっぽい。

https://chromium.googlesource.com/chromium/src.git

このサイト自体は、gitliesというツールで作られているようです。

https://gerrit.googlesource.com/gitiles/

そのほかもみてみるか。次にpdl。

chromium/107.0.5252.1.pdl と同じように、combinedとv8のpdlが格納されている。

ここまでの動作から、grab.goでこの取得処理をしていることがわかる。

https://github.com/chromedp/pdlgen/blob/73b2ad0f16066348aa47151b49d11ec51c7e531a/grab.go

たぶん情報の取得処理自体は完了していて、そこから何か仕様にもなにかがよくなくてエラーになっている。エラーメッセージに戻る。

Panic自体はGoにおける例外処理的な仕組みなのかな？

https://moneyforward.com/engineers_blog/2020/09/09/goroutine-panic-handling/

公式読まないでごめんだけど、雰囲気掴むために日本語ブログ読む。

> panicは、コールされるとプログラムが終了するビルトイン関数の事です。

なるほど。で、実際にpanicを呼び出しているのはここだ。

https://github.com/chromedp/pdlgen/blob/5017836d2c839513555503c7fbbd884daafdf467/gen/gotpl/util.go#L143

大元はここ

https://github.com/chromedp/pdlgen/blob/99c9ca13bbaef6b33dec6d46e232ce22367fc1a7/main.go#L233

めちゃくちゃ一つの関数長いじゃんか...。でも読まなきゃわからんので読む。
