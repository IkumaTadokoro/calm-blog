---
author_association: OWNER
created_at: '2022-05-21T03:33:02Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/7#issuecomment-1133521417
id: 1133521417
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/7
node_id: IC_kwDOHWTPVs5DkCoJ
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1133521417/reactions
updated_at: '2022-05-21T03:33:02Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1133521417
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
新聞

[rails commit log流し読み\(2022/05/20\) \- なるようになるブログ](https://y-yagi.hatenablog.com/entry/2022/05/21/045327)

- [x] readonly-columnに対して、touchを行う
- [x] rails new時のcredentialsのdiff?
- [x] ログローテートの仕組み
- [x] inclusivity/exclusivity validator
- [ ] （難しい）threadの話

### readonlyなcolumnに対して、touchを行う

- readonlyなcolumn:
  - [ActiveRecord::ReadonlyAttributes::ClassMethods](https://api.rubyonrails.org/classes/ActiveRecord/ReadonlyAttributes/ClassMethods.html)
  - ActiveRecordの文脈で、新しい値の設定はできるけど、更新はできなくなるように設定できる。
- `touch`:
  - [ActiveRecord::Persistence](https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-touch)
  - 更新日時だけをupdateするメソッド
- つまり、本来updateができないはずの`attr_readonly`に対して、`touch`による更新日時の更新ができちゃうよ、というのがこのPRの内容。

### rails new時のcredentialsのdiff

- `rails credentials:diff --enroll`というコマンドがそもそもあるのでそこから。
  - `rails credentials`3兄弟、`edit`、`show`、`diff`
  - `diff`は暗号化ファイルのdiffを見れるようにするコマンド（暗号化されているので、そのままgit diffをしても、意味のある内容は表示されない）
  - `rails credentials:diff --enroll`を実行することで、.gitattributesに設定が追記され、その後`bin/rails credentials:edit`を実行すると、`.git/config`にも設定が追記される。これで`git diff`を実行した際に復号化した状態でdiffが参照できるようになる。
  - ...という手順を踏まないといけないので、便利だけど気づいていない人も多いよね、アプリを新規作成した際に（`rails new`した際に）自動でやっておくよ、というのが今回のPR
  - `--skip-decrypted-diffs`でこの設定をスキップして作成もできる。
- 参考：[bin/rails credentials · Linyclar](https://linyclar.github.io/rails_memos/commands/credentials/)

### ログローテートの仕組み

- もともとrails自体にはログローテーションの仕組みがある

```ruby
config.logger = Logger.new("log/production.log", "daily")
```

- 今回はdevelopmentとtestのローテーション設定のデフォルト設定が100MB単位になった。

### inclusivity/exclusivity validator

- [ActiveModel::Validations::HelperMethods](https://api.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html#method-i-validates_inclusion_of)
- [ActiveModel::Validations::HelperMethods](https://api.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html#method-i-validates_inclusion_of)
- inclusionの方は範囲内、exclusionの方は範囲外であるかどうかをチェックする
- 指定するenumerableなオブジェクトに、beginless_rangeが指定できるようになったそう
