---
author_association: OWNER
created_at: '2022-05-20T01:29:04Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/6#issuecomment-1132354474
id: 1132354474
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/6
node_id: IC_kwDOHWTPVs5Dfluq
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1132354474/reactions
updated_at: '2022-05-20T01:29:04Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1132354474
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
新聞

- [x] `content_security_policy`
- [x] `destroy_async_parent`：テストファイル名になっているけど、なんのテストしているんだろう
- [x] bin/rails testでdeclared nameによるテストのフィルターを指定
- [x] コミットに`ci-skip`とあるのはなんだろう？
- [ ] valiatorの引数をrecord引数なしで指定できるとは？

### content_secutiry_policy

- XSSに対する防御策。CSPと略されることも多い。
- Content-Security-Policyレスポンスヘッダを使って、Webブラウザで使える機能を細かく設定できる仕組み
- RailsではCSPを設定するためのDSLが提供されている
- グローバル設定は`config/initializers/content_security_policy.rb`で実施する。`rails new`したタイミングで作成されているが、初期状態では何も設定されていない状態。
- グローバルな設定とは別にControllerでオーバーライドし、リソースごとに設定することも可能
- 今回の修正ではinitializerで定義されているcontent_security_policyでもhelper_methodが使用できるようになっている。もともと`yield`を使っていたが、selfが正しくないので、`insrance_exec`を使用するように変更した。
- 参考
    - [Rails セキュリティガイド \- Railsガイド](https://railsguides.jp/security.html#content-security-policy%EF%BC%88csp%EF%BC%89)
    - [BasicObject\#instance\_exec \(Ruby 3\.1 リファレンスマニュアル\)](https://docs.ruby-lang.org/ja/latest/method/BasicObject/i/instance_exec.html)
    - [Rails アプリケーションのセキュリティ対策（CORS/CSP/HSTS）](https://zenn.dev/cobachie/articles/rails-security)

### dependent: :destroy_async

- 非同期で関連を削除する。連鎖するオブジェクトが多い場合に、サーバタイムアウトするのを防ぐための仕組み
- Rails 6.1で導入
- 参考：[Rails 6\.1: 関連付けをバックグラウンド削除する「dependent: :destroy\_async」（翻訳）｜TechRacho by BPS株式会社](https://techracho.bpsinc.jp/hachi8833/2021_01_18/103016)

### テスト実行時にdeclared nameで実行できるように

```ruby
class MyTest < ActiveSupport::TestCase
  test "does something" do
    # ...
  end
end
```

これを

```bash
$ rails test test/my_test.rb -n "does something"
```

で呼べるようにしたとのこと。もともと、`test_does_something`でないと呼べなかったみたい。

### [ci skip]

- コミットメッセージに特定のキーワードを含めるとciをスキップできる。
- 参考
    - [Gitのpush時にCIのビルドを回避する方法｜TechRacho by BPS株式会社](https://techracho.bpsinc.jp/sugita/2019_12_18/84820)
    - [ワークフロー実行をスキップする \- GitHub Docs](https://docs.github.com/ja/actions/managing-workflow-runs/skipping-workflow-runs)