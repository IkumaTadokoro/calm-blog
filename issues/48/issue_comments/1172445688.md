---
author_association: OWNER
created_at: '2022-07-01T15:07:57Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/48#issuecomment-1172445688
id: 1172445688
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/48
node_id: IC_kwDOHWTPVs5F4hn4
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172445688/reactions
updated_at: '2022-07-01T15:07:57Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1172445688
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
esbuildを使ってpjを作成してみる

https://engineering.mercari.com/blog/entry/20211215-operation-tool-coupon/

https://aloerina01.github.io/blog/2021-09-15-1

```bash
$ mkdir esbuild-gas-sample
$ npm install -D esbuild
$ npm install -D esbuild-gas-plugin
```

たぶんなんか適当に作ればGASっぽい感じになると思われるので、やっている。

```bash
$ mkdir src
$ mkdir dist
$ touch src/index.ts
$ touch bin/build

# index.tsとbin/buildを修正

$ chmod u+x bin/build
$ bin/build
```

```bash
✘ [ERROR] Expected ";" but found "add"

    src/utils.ts:1:5:
      1 │ onst add = (n1: number, n2: number): number =...
        │      ~~~
        ╵      ;

1 error
✘ [ERROR] [plugin gas-plugin] ENOENT: no such file or directory, open 'dist/bundle.js'

    /Users/tadokoroikuma/src/github.com/IkumaTadokoro/esbuild-gas-sample/node_modules/esbuild-gas-plugin/dist/index.js:7:25:
      7 │ ...  const outfile = fs.readFileSync(build.in...
        ╵                         ^
```

ちょっと修正する。`onst`になってた。

```
$ bin/build
```

え！早すぎでは！！

---

ここからclaspを使ってpushできるようにしていく。

```bash
$ touch .clasp.json
```

```json
"scripts": {
  "build": "bin/build",
  "deploy": "bin/build && clasp push",
}
```

あ、appscripts.jsonがないって言われている。これどこに追加すればいいのかな？とりあえずsrcにおいてみる、多分ダメ。

```bash
ENOENT: no such file or directory, open 'dist/appsscript.json'
```

一旦、直接distに配置するappsscript.json。m名前間違いやすい

```
Could not find script.
Did you provide the correct scriptId?
Are you logged in to the correct account with the script?
```

あれ、もしかして.clasp.jsonも移動する必要がある？
そういうことじゃないみたい。移動してもだめだった。

なんかIDが違ったみたい。修正したらとりあえずdeployはできたけど、エディタでみると何もなかった...。

う〜ん、何もデプロイされていないなあ

とりあえずできた。

- global登録は自分でやらないとダメ。グローバルに実行するべき関数がトップにないとエラーになる
- clasp pushしてみても、エディタは変わっていない。でも実行結果は変わっている。更新しても同じで、実行するとローカルのコードを読んでいる。
- クラシックエディタに一度切り替えたら、ちゃんと反映された。どうもpushがオンラインエディタに反映されないのは既知の問題らしい。


