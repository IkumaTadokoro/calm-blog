---
author_association: OWNER
created_at: '2022-06-26T05:43:04Z'
html_url: https://github.com/IkumaTadokoro/diary/issues/43#issuecomment-1166422820
id: 1166422820
issue_url: https://api.github.com/repos/IkumaTadokoro/diary/issues/43
node_id: IC_kwDOHWTPVs5FhjMk
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1166422820/reactions
updated_at: '2022-06-26T05:43:04Z'
url: https://api.github.com/repos/IkumaTadokoro/diary/issues/comments/1166422820
user:
  avatar_url: https://avatars.githubusercontent.com/u/61409641?v=4
  events_url: https://api.github.com/users/IkumaTadokoro/events{/privacy}
  followers_url: https://api.github.com/users/IkumaTadokoro/followers
  following_url: https://api.github.com/users/IkumaTadokoro/following{/other_user}
  gists_url: https://api.github.com/users/IkumaTadokoro/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/IkumaTadokoro
  id: 61409641
  login: IkumaTadokoro
  node_id: MDQ6VXNlcjYxNDA5NjQx
  organizations_url: https://api.github.com/users/IkumaTadokoro/orgs
  received_events_url: https://api.github.com/users/IkumaTadokoro/received_events
  repos_url: https://api.github.com/users/IkumaTadokoro/repos
  site_admin: false
  starred_url: https://api.github.com/users/IkumaTadokoro/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/IkumaTadokoro/subscriptions
  type: User
  url: https://api.github.com/users/IkumaTadokoro

---
## Composition APIにおける型定義

https://vuejs.org/guide/typescript/composition-api.html

### props

`script setup`を使用するのが基本系。

`defineProps`マクロを使用したpropsの定義は

1. runtime declaration
2. type-based declaration

の2種類ある。

どちらを使っても良いが、使用するのはどちらか一方のみ。

一方で単純に型定義としてpropsを定義することもできる。これが一番楽なんでは。

`defineProps`マクロをGenericありで使用する場合（type-based declaration?）、以下の制約がある。

- objectリテラルか、**同じファイルの**objectリテラルもしくはinterfaceへの参照

これはVueのコンポーネントはそれぞれ別々にコンパイルされるから。そのうち撤廃されるそう。

`script setup`を使用しない場合hは、`defineComponent`を使用する必要がある。propsの型はsetup内のpropsオプションで定義される。

### emit

emitも`script setup`を使用していれば、`defineEmits`マクロを使用できる。

```vue
<script setup lang="ts">
// runtime
const emit = defineEmits(['change', 'update'])

// type-based
const emit = defineEmits<{
  (e: 'change', id: number): void
  (e: 'update', value: string): void
}>()
</script>
```

### ref()

- 初期値から型を推論する
- `Ref`型を使用して、もしくは`ref`に型引数をつけることで、複雑な型を表現することができる。

```vue
import { ref } from 'vue'
import type { Ref } from 'vue'

const year: Ref<string | number> = ref('2020')

year.value = 2020 // ok!
```

```vue
// resulting type: Ref<string | number>
const year = ref<string | number>('2020')

year.value = 2020 // ok!
```

初期値が未設定で型引数をつけた場合、`Ref<generic | undefined>`になる

### computed()

getterの戻り値から型を推論する

```vue
import { ref, computed } from 'vue'

const count = ref(0)

// inferred type: ComputedRef<number>
const double = computed(() => count.value * 2)
```

特定の型を型引数に指定することもできる

```vue
const double = computed<number>(() => {
  return count.value * 2
})
```

### イベントハンドラ

ネイティブのDOMイベントを扱っている場合、ハンドラに渡す引数がを正しく定義した方がいいケースがある。

event引数は基本的に暗黙のanyを持っているので`Event`を、内部的な値は適切な型アサーションを定義するのが良い。


### テンプレート参照

テンプレート参照は明示的に型引数と初期値nullで定義するべき。

```vue
const el = ref<HTMLInputElement | null>(null)
```

コンポーネントがマウントされるまでは初期値はnullで、v-ifによって参照されている要素がアンマウントされた場合にも、nullに設定される可能性がある。

そのため、上記elの要素el.valueにアクセスするためには、オプショナルチェーンや型ガードが必要。



